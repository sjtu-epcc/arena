
------------------------------------------------------------------
- (1/3) Profiling wide_resnet_1B with batch size: 256...
------------------------------------------------------------------
[TMP] Existed profiling results in `./jaxpr/prof_log/optimal_no_prof/wide_resnet_1B_256.pkl`, updating/rewriting it...
[I] Alpa's built-in profiling database is disabled.
[I] Ray Cluster & Alpa backend initialization is completed.
[I] Device Info:
    - Devices num per node: 1
    - Nodes num: 4
[I] Loading flax model....
[I] Model 'wide_resnet' loads sucessfully. Model Info: 

WideResNet(
    # attributes
    stage_sizes = [3, 4, 6, 3]
    block_cls = BottleneckResNetBlock
    num_classes = 1024
    num_filters = 320
    width_factor = 2
    dtype = float32
    act = relu
) 

[I] Compiling and executing model with timeout = 1200 s...
[I] Manually construct dummy batch with the shape of (256, 224, 224, 3).
[I] Initialize training state...
[I] Training state initialization is completed.
[I] Constructing Alpa parallelized train step func...
[I] Alpa parallelized train step func construction is completed.
-------------------- Automatic stage clustering --------------------
submesh_choices: ((1, 1), (2, 1), (4, 1))
- Profiling for submesh 2 (4, 1):
- Generate all stage infos (Jaxpr -> HLO)
- Compile all stages
- Profile all stages
result[(0, 15, 2, 0), 0] = ModuleProfileResult(compute_cost=0.212, peak_memory=5.272 GB, invar_size=3.749 GB, outvar_size=0.389 GB, temp_buffer_size=1.134 GB, available_memory=35.242 GB)
result[(0, 15, 2, 0), 1] = ModuleProfileResult(compute_cost=0.641, peak_memory=13.481 GB, invar_size=7.884 GB, outvar_size=3.746 GB, temp_buffer_size=5.598 GB, available_memory=35.242 GB)
result[(0, 15, 2, 1), 0] = ModuleProfileResult(compute_cost=0.345, peak_memory=2.270 GB, invar_size=1.293 GB, outvar_size=0.434 GB, temp_buffer_size=0.543 GB, available_memory=35.242 GB)
result[(0, 15, 2, 1), 1] = ModuleProfileResult(compute_cost=0.744, peak_memory=3.829 GB, invar_size=3.017 GB, outvar_size=1.290 GB, temp_buffer_size=0.813 GB, available_memory=35.242 GB)
Profiling for submesh 2 (4, 1) takes 71.10 seconds
--------------------------------------------------
- Profiling for submesh 1 (2, 1):
[TMP] Skip profiling of 2 due to legacy error in tensorflow...
- Profiling for submesh 0 (1, 1):
- Generate all stage infos (Jaxpr -> HLO)
- Compile all stages
- Profile all stages
result[(0, 3, 0, 0), 0] = ModuleProfileResult(compute_cost=0.050, peak_memory=1.772 GB, invar_size=0.099 GB, outvar_size=0.778 GB, temp_buffer_size=0.895 GB, available_memory=35.446 GB)
result[(0, 3, 0, 1), 0] = ModuleProfileResult(compute_cost=0.050, peak_memory=1.772 GB, invar_size=0.099 GB, outvar_size=0.778 GB, temp_buffer_size=0.895 GB, available_memory=35.446 GB)
result[(1, 3, 0, 0), 0] = ModuleProfileResult(compute_cost=0.043, peak_memory=1.756 GB, invar_size=0.262 GB, outvar_size=0.598 GB, temp_buffer_size=0.895 GB, available_memory=35.446 GB)
result[(1, 3, 0, 1), 0] = ModuleProfileResult(compute_cost=0.043, peak_memory=1.756 GB, invar_size=0.262 GB, outvar_size=0.598 GB, temp_buffer_size=0.895 GB, available_memory=35.446 GB)
result[(0, 3, 0, 1), 1] = ModuleProfileResult(compute_cost=0.159, peak_memory=3.140 GB, invar_size=0.966 GB, outvar_size=0.090 GB, temp_buffer_size=2.173 GB, available_memory=35.242 GB)
result[(0, 3, 0, 0), 1] = ModuleProfileResult(compute_cost=0.157, peak_memory=3.140 GB, invar_size=0.966 GB, outvar_size=0.090 GB, temp_buffer_size=2.173 GB, available_memory=35.446 GB)
result[(1, 3, 0, 0), 1] = ModuleProfileResult(compute_cost=0.133, peak_memory=3.116 GB, invar_size=0.943 GB, outvar_size=0.262 GB, temp_buffer_size=1.994 GB, available_memory=35.446 GB)
result[(1, 4, 0, 0), 0] = ModuleProfileResult(compute_cost=0.053, peak_memory=1.857 GB, invar_size=0.308 GB, outvar_size=0.718 GB, temp_buffer_size=0.831 GB, available_memory=35.242 GB)
result[(1, 4, 0, 1), 0] = ModuleProfileResult(compute_cost=0.053, peak_memory=1.857 GB, invar_size=0.308 GB, outvar_size=0.718 GB, temp_buffer_size=0.831 GB, available_memory=35.446 GB)
result[(2, 4, 0, 0), 0] = ModuleProfileResult(compute_cost=0.037, peak_memory=1.560 GB, invar_size=0.352 GB, outvar_size=0.479 GB, temp_buffer_size=0.730 GB, available_memory=35.446 GB)
result[(1, 3, 0, 1), 1] = ModuleProfileResult(compute_cost=0.134, peak_memory=3.049 GB, invar_size=0.943 GB, outvar_size=0.262 GB, temp_buffer_size=1.927 GB, available_memory=35.446 GB)
result[(2, 4, 0, 1), 0] = ModuleProfileResult(compute_cost=0.037, peak_memory=1.560 GB, invar_size=0.352 GB, outvar_size=0.479 GB, temp_buffer_size=0.730 GB, available_memory=35.446 GB)
result[(1, 4, 0, 0), 1] = ModuleProfileResult(compute_cost=0.161, peak_memory=3.327 GB, invar_size=1.154 GB, outvar_size=0.308 GB, temp_buffer_size=1.994 GB, available_memory=35.446 GB)
result[(1, 4, 0, 1), 1] = ModuleProfileResult(compute_cost=0.162, peak_memory=3.327 GB, invar_size=1.154 GB, outvar_size=0.308 GB, temp_buffer_size=1.994 GB, available_memory=35.242 GB)
result[(2, 5, 0, 0), 0] = ModuleProfileResult(compute_cost=0.046, peak_memory=1.710 GB, invar_size=0.398 GB, outvar_size=0.598 GB, temp_buffer_size=0.714 GB, available_memory=35.446 GB)
result[(2, 4, 0, 0), 1] = ModuleProfileResult(compute_cost=0.111, peak_memory=2.926 GB, invar_size=0.942 GB, outvar_size=0.352 GB, temp_buffer_size=1.745 GB, available_memory=35.446 GB)
result[(2, 5, 0, 1), 0] = ModuleProfileResult(compute_cost=0.046, peak_memory=1.710 GB, invar_size=0.398 GB, outvar_size=0.598 GB, temp_buffer_size=0.714 GB, available_memory=35.446 GB)
result[(2, 4, 0, 1), 1] = ModuleProfileResult(compute_cost=0.112, peak_memory=2.867 GB, invar_size=0.942 GB, outvar_size=0.352 GB, temp_buffer_size=1.685 GB, available_memory=35.446 GB)
result[(3, 5, 0, 0), 0] = ModuleProfileResult(compute_cost=0.035, peak_memory=1.459 GB, invar_size=0.386 GB, outvar_size=0.359 GB, temp_buffer_size=0.714 GB, available_memory=35.446 GB)
result[(2, 5, 0, 0), 1] = ModuleProfileResult(compute_cost=0.140, peak_memory=3.148 GB, invar_size=1.154 GB, outvar_size=0.397 GB, temp_buffer_size=1.755 GB, available_memory=35.242 GB)
result[(3, 5, 0, 1), 0] = ModuleProfileResult(compute_cost=0.035, peak_memory=1.459 GB, invar_size=0.386 GB, outvar_size=0.359 GB, temp_buffer_size=0.714 GB, available_memory=35.446 GB)
result[(2, 5, 0, 1), 1] = ModuleProfileResult(compute_cost=0.139, peak_memory=3.148 GB, invar_size=1.154 GB, outvar_size=0.397 GB, temp_buffer_size=1.755 GB, available_memory=35.446 GB)
result[(3, 5, 0, 0), 1] = ModuleProfileResult(compute_cost=0.106, peak_memory=2.503 GB, invar_size=0.891 GB, outvar_size=0.386 GB, temp_buffer_size=1.373 GB, available_memory=35.446 GB)
result[(3, 6, 0, 0), 0] = ModuleProfileResult(compute_cost=0.044, peak_memory=1.581 GB, invar_size=0.432 GB, outvar_size=0.479 GB, temp_buffer_size=0.670 GB, available_memory=35.446 GB)
result[(3, 5, 0, 1), 1] = ModuleProfileResult(compute_cost=0.107, peak_memory=2.503 GB, invar_size=0.891 GB, outvar_size=0.386 GB, temp_buffer_size=1.373 GB, available_memory=35.242 GB)
result[(3, 6, 0, 1), 0] = ModuleProfileResult(compute_cost=0.045, peak_memory=1.581 GB, invar_size=0.432 GB, outvar_size=0.479 GB, temp_buffer_size=0.670 GB, available_memory=35.446 GB)
result[(4, 7, 0, 0), 0] = ModuleProfileResult(compute_cost=0.049, peak_memory=1.463 GB, invar_size=0.477 GB, outvar_size=0.419 GB, temp_buffer_size=0.567 GB, available_memory=35.242 GB)
result[(3, 6, 0, 0), 1] = ModuleProfileResult(compute_cost=0.132, peak_memory=2.715 GB, invar_size=1.103 GB, outvar_size=0.432 GB, temp_buffer_size=1.373 GB, available_memory=35.446 GB)
result[(3, 6, 0, 1), 1] = ModuleProfileResult(compute_cost=0.132, peak_memory=2.715 GB, invar_size=1.103 GB, outvar_size=0.432 GB, temp_buffer_size=1.373 GB, available_memory=35.446 GB)
result[(4, 7, 0, 1), 0] = ModuleProfileResult(compute_cost=0.049, peak_memory=1.463 GB, invar_size=0.477 GB, outvar_size=0.419 GB, temp_buffer_size=0.567 GB, available_memory=35.242 GB)
result[(5, 7, 0, 0), 0] = ModuleProfileResult(compute_cost=0.038, peak_memory=1.198 GB, invar_size=0.431 GB, outvar_size=0.299 GB, temp_buffer_size=0.468 GB, available_memory=35.446 GB)
result[(5, 7, 0, 1), 0] = ModuleProfileResult(compute_cost=0.038, peak_memory=1.198 GB, invar_size=0.431 GB, outvar_size=0.299 GB, temp_buffer_size=0.468 GB, available_memory=35.446 GB)
