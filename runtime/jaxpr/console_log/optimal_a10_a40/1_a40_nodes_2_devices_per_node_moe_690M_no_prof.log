
------------------------------------------------------------------
- (1/3) Profiling moe_690M with batch size: 256...
------------------------------------------------------------------
[TMP] Existed profiling results in `./jaxpr/prof_log/optimal_no_prof/moe_690M_256.pkl`, updating/rewriting it...
[I] Alpa's built-in profiling database is disabled.
[I] Ray Cluster & Alpa backend initialization is completed.
[I] Device Info:
    - Devices num per node: 2
    - Nodes num: 1
[I] Loading flax model....
[I] Model 'moe' loads sucessfully. Model Info: 

FlaxMoEForLMModule(
    # attributes
    config = <model.moe_model.MoEConfig object at 0x7fe2803e0d00>
    dtype = float16
    bias_init = zeros
) 

[I] Compiling and executing model with timeout = 1200 s...
[I] Manually constructing dummy batch...
[I] Initialize training state...
[I] Training state initialization is completed.
[I] Constructing Alpa parallelized train step func...
[I] Alpa parallelized train step func construction is completed.
-------------------- Automatic stage clustering --------------------
submesh_choices: ((1, 1), (1, 2))
- Profiling for submesh 1 (1, 2):
- Generate all stage infos (Jaxpr -> HLO)
- Compile all stages
- Profile all stages
result[(0, 15, 1, 0), 0] = ModuleProfileResult(compute_cost=0.075, peak_memory=2.222 GB, invar_size=1.260 GB, outvar_size=0.474 GB, temp_buffer_size=0.488 GB, available_memory=35.242 GB)
result[(0, 15, 1, 0), 1] = ModuleProfileResult(compute_cost=0.226, peak_memory=4.522 GB, invar_size=3.121 GB, outvar_size=1.324 GB, temp_buffer_size=1.401 GB, available_memory=35.242 GB)
result[(0, 15, 1, 1), 0] = ModuleProfileResult(compute_cost=0.104, peak_memory=1.972 GB, invar_size=0.630 GB, outvar_size=0.853 GB, temp_buffer_size=0.488 GB, available_memory=35.242 GB)
result[(0, 15, 1, 1), 1] = ModuleProfileResult(compute_cost=0.271, peak_memory=4.026 GB, invar_size=2.177 GB, outvar_size=0.662 GB, temp_buffer_size=1.849 GB, available_memory=35.242 GB)
result[(0, 15, 1, 2), 0] = ModuleProfileResult(compute_cost=0.093, peak_memory=1.911 GB, invar_size=0.698 GB, outvar_size=0.724 GB, temp_buffer_size=0.488 GB, available_memory=35.242 GB)
result[(0, 15, 1, 2), 1] = ModuleProfileResult(compute_cost=0.214, peak_memory=3.660 GB, invar_size=2.247 GB, outvar_size=0.761 GB, temp_buffer_size=1.413 GB, available_memory=35.242 GB)
Profiling for submesh 1 (1, 2) takes 66.47 seconds
--------------------------------------------------
- Profiling for submesh 0 (1, 1):
- Generate all stage infos (Jaxpr -> HLO)
- Compile all stages
- Profile all stages
result[(0, 5, 0, 0), 0] = ModuleProfileResult(compute_cost=0.058, peak_memory=2.102 GB, invar_size=0.641 GB, outvar_size=0.484 GB, temp_buffer_size=0.977 GB, available_memory=35.242 GB)
result[(0, 5, 0, 1), 0] = ModuleProfileResult(compute_cost=0.077, peak_memory=2.102 GB, invar_size=0.641 GB, outvar_size=0.484 GB, temp_buffer_size=0.977 GB, available_memory=35.242 GB)
result[(0, 5, 0, 0), 1] = ModuleProfileResult(compute_cost=0.158, peak_memory=3.707 GB, invar_size=1.766 GB, outvar_size=0.641 GB, temp_buffer_size=1.941 GB, available_memory=35.242 GB)
result[(0, 6, 0, 0), 0] = ModuleProfileResult(compute_cost=0.090, peak_memory=2.176 GB, invar_size=0.667 GB, outvar_size=0.532 GB, temp_buffer_size=0.977 GB, available_memory=35.242 GB)
result[(0, 5, 0, 1), 1] = ModuleProfileResult(compute_cost=0.157, peak_memory=3.707 GB, invar_size=1.766 GB, outvar_size=0.641 GB, temp_buffer_size=1.941 GB, available_memory=35.242 GB)
result[(0, 6, 0, 1), 0] = ModuleProfileResult(compute_cost=0.091, peak_memory=2.176 GB, invar_size=0.667 GB, outvar_size=0.532 GB, temp_buffer_size=0.977 GB, available_memory=35.242 GB)
result[(0, 6, 0, 0), 1] = ModuleProfileResult(compute_cost=0.218, peak_memory=4.645 GB, invar_size=1.866 GB, outvar_size=0.667 GB, temp_buffer_size=2.779 GB, available_memory=35.242 GB)
result[(0, 7, 0, 0), 0] = ModuleProfileResult(compute_cost=0.078, peak_memory=2.176 GB, invar_size=0.667 GB, outvar_size=0.532 GB, temp_buffer_size=0.977 GB, available_memory=35.242 GB)
result[(0, 6, 0, 1), 1] = ModuleProfileResult(compute_cost=0.206, peak_memory=4.645 GB, invar_size=1.866 GB, outvar_size=0.667 GB, temp_buffer_size=2.779 GB, available_memory=35.242 GB)
result[(0, 7, 0, 1), 0] = ModuleProfileResult(compute_cost=0.081, peak_memory=2.176 GB, invar_size=0.667 GB, outvar_size=0.532 GB, temp_buffer_size=0.977 GB, available_memory=35.242 GB)
result[(0, 7, 0, 0), 1] = ModuleProfileResult(compute_cost=0.210, peak_memory=4.644 GB, invar_size=1.866 GB, outvar_size=0.667 GB, temp_buffer_size=2.778 GB, available_memory=35.242 GB)
result[(0, 7, 0, 1), 1] = ModuleProfileResult(compute_cost=0.222, peak_memory=4.644 GB, invar_size=1.866 GB, outvar_size=0.667 GB, temp_buffer_size=2.778 GB, available_memory=35.242 GB)
result[(0, 8, 0, 0), 0] = ModuleProfileResult(compute_cost=0.084, peak_memory=2.324 GB, invar_size=0.667 GB, outvar_size=0.681 GB, temp_buffer_size=0.977 GB, available_memory=35.242 GB)
result[(0, 8, 0, 1), 0] = ModuleProfileResult(compute_cost=0.091, peak_memory=2.324 GB, invar_size=0.667 GB, outvar_size=0.681 GB, temp_buffer_size=0.977 GB, available_memory=35.242 GB)
result[(0, 8, 0, 0), 1] = ModuleProfileResult(compute_cost=0.211, peak_memory=4.793 GB, invar_size=2.015 GB, outvar_size=0.667 GB, temp_buffer_size=2.778 GB, available_memory=35.242 GB)
result[(0, 8, 0, 1), 1] = ModuleProfileResult(compute_cost=0.220, peak_memory=4.793 GB, invar_size=2.015 GB, outvar_size=0.667 GB, temp_buffer_size=2.778 GB, available_memory=35.242 GB)
result[(1, 6, 0, 0), 0] = ModuleProfileResult(compute_cost=0.086, peak_memory=1.902 GB, invar_size=0.643 GB, outvar_size=0.508 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(1, 6, 0, 1), 0] = ModuleProfileResult(compute_cost=0.070, peak_memory=1.902 GB, invar_size=0.643 GB, outvar_size=0.508 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(1, 6, 0, 0), 1] = ModuleProfileResult(compute_cost=0.200, peak_memory=4.573 GB, invar_size=1.771 GB, outvar_size=0.643 GB, temp_buffer_size=2.778 GB, available_memory=35.242 GB)
result[(1, 6, 0, 1), 1] = ModuleProfileResult(compute_cost=0.201, peak_memory=4.573 GB, invar_size=1.771 GB, outvar_size=0.643 GB, temp_buffer_size=2.778 GB, available_memory=35.242 GB)
result[(1, 7, 0, 0), 0] = ModuleProfileResult(compute_cost=0.080, peak_memory=1.902 GB, invar_size=0.643 GB, outvar_size=0.509 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(1, 7, 0, 1), 0] = ModuleProfileResult(compute_cost=0.081, peak_memory=1.902 GB, invar_size=0.643 GB, outvar_size=0.509 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(1, 7, 0, 0), 1] = ModuleProfileResult(compute_cost=0.194, peak_memory=4.572 GB, invar_size=1.771 GB, outvar_size=0.643 GB, temp_buffer_size=2.777 GB, available_memory=35.242 GB)
result[(1, 8, 0, 0), 0] = ModuleProfileResult(compute_cost=0.078, peak_memory=2.050 GB, invar_size=0.643 GB, outvar_size=0.657 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(1, 7, 0, 1), 1] = ModuleProfileResult(compute_cost=0.202, peak_memory=4.572 GB, invar_size=1.771 GB, outvar_size=0.643 GB, temp_buffer_size=2.777 GB, available_memory=35.242 GB)
result[(1, 8, 0, 1), 0] = ModuleProfileResult(compute_cost=0.078, peak_memory=2.050 GB, invar_size=0.643 GB, outvar_size=0.657 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(1, 8, 0, 0), 1] = ModuleProfileResult(compute_cost=0.200, peak_memory=4.721 GB, invar_size=1.920 GB, outvar_size=0.643 GB, temp_buffer_size=2.777 GB, available_memory=35.242 GB)
result[(1, 9, 0, 0), 0] = ModuleProfileResult(compute_cost=0.080, peak_memory=2.355 GB, invar_size=0.925 GB, outvar_size=0.681 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(1, 8, 0, 1), 1] = ModuleProfileResult(compute_cost=0.208, peak_memory=4.721 GB, invar_size=1.920 GB, outvar_size=0.643 GB, temp_buffer_size=2.777 GB, available_memory=35.242 GB)
result[(1, 9, 0, 1), 0] = ModuleProfileResult(compute_cost=0.080, peak_memory=2.355 GB, invar_size=0.925 GB, outvar_size=0.681 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(1, 9, 0, 0), 1] = ModuleProfileResult(compute_cost=0.237, peak_memory=5.307 GB, invar_size=2.506 GB, outvar_size=0.924 GB, temp_buffer_size=2.777 GB, available_memory=35.242 GB)
result[(2, 6, 0, 0), 0] = ModuleProfileResult(compute_cost=0.060, peak_memory=1.874 GB, invar_size=0.811 GB, outvar_size=0.313 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(1, 9, 0, 1), 1] = ModuleProfileResult(compute_cost=0.237, peak_memory=5.307 GB, invar_size=2.506 GB, outvar_size=0.924 GB, temp_buffer_size=2.777 GB, available_memory=35.242 GB)
result[(2, 6, 0, 1), 0] = ModuleProfileResult(compute_cost=0.060, peak_memory=1.874 GB, invar_size=0.811 GB, outvar_size=0.313 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(2, 6, 0, 0), 1] = ModuleProfileResult(compute_cost=0.174, peak_memory=4.666 GB, invar_size=1.739 GB, outvar_size=0.811 GB, temp_buffer_size=2.732 GB, available_memory=35.242 GB)
result[(2, 7, 0, 0), 0] = ModuleProfileResult(compute_cost=0.060, peak_memory=1.874 GB, invar_size=0.811 GB, outvar_size=0.313 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(2, 6, 0, 1), 1] = ModuleProfileResult(compute_cost=0.173, peak_memory=4.666 GB, invar_size=1.739 GB, outvar_size=0.811 GB, temp_buffer_size=2.732 GB, available_memory=35.242 GB)
result[(2, 7, 0, 1), 0] = ModuleProfileResult(compute_cost=0.073, peak_memory=1.874 GB, invar_size=0.811 GB, outvar_size=0.313 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(2, 7, 0, 0), 1] = ModuleProfileResult(compute_cost=0.180, peak_memory=4.665 GB, invar_size=1.739 GB, outvar_size=0.811 GB, temp_buffer_size=2.731 GB, available_memory=35.242 GB)
result[(2, 8, 0, 0), 0] = ModuleProfileResult(compute_cost=0.079, peak_memory=2.023 GB, invar_size=0.811 GB, outvar_size=0.462 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(2, 7, 0, 1), 1] = ModuleProfileResult(compute_cost=0.183, peak_memory=4.665 GB, invar_size=1.739 GB, outvar_size=0.811 GB, temp_buffer_size=2.731 GB, available_memory=35.242 GB)
result[(2, 8, 0, 1), 0] = ModuleProfileResult(compute_cost=0.070, peak_memory=2.023 GB, invar_size=0.811 GB, outvar_size=0.462 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(2, 8, 0, 0), 1] = ModuleProfileResult(compute_cost=0.174, peak_memory=4.814 GB, invar_size=1.888 GB, outvar_size=0.811 GB, temp_buffer_size=2.731 GB, available_memory=35.242 GB)
result[(2, 9, 0, 0), 0] = ModuleProfileResult(compute_cost=0.074, peak_memory=2.327 GB, invar_size=1.092 GB, outvar_size=0.485 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(2, 8, 0, 1), 1] = ModuleProfileResult(compute_cost=0.176, peak_memory=4.814 GB, invar_size=1.888 GB, outvar_size=0.811 GB, temp_buffer_size=2.731 GB, available_memory=35.242 GB)
result[(2, 9, 0, 1), 0] = ModuleProfileResult(compute_cost=0.073, peak_memory=2.327 GB, invar_size=1.092 GB, outvar_size=0.485 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(2, 9, 0, 0), 1] = ModuleProfileResult(compute_cost=0.204, peak_memory=5.400 GB, invar_size=2.474 GB, outvar_size=1.092 GB, temp_buffer_size=2.731 GB, available_memory=35.242 GB)
result[(2, 10, 0, 0), 0] = ModuleProfileResult(compute_cost=0.102, peak_memory=2.401 GB, invar_size=1.118 GB, outvar_size=0.533 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(2, 9, 0, 1), 1] = ModuleProfileResult(compute_cost=0.198, peak_memory=5.400 GB, invar_size=2.474 GB, outvar_size=1.092 GB, temp_buffer_size=2.731 GB, available_memory=35.242 GB)
result[(2, 10, 0, 1), 0] = ModuleProfileResult(compute_cost=0.095, peak_memory=2.401 GB, invar_size=1.118 GB, outvar_size=0.533 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(2, 10, 0, 0), 1] = ModuleProfileResult(compute_cost=0.253, peak_memory=5.925 GB, invar_size=2.574 GB, outvar_size=1.118 GB, temp_buffer_size=3.156 GB, available_memory=35.242 GB)
result[(2, 11, 0, 0), 0] = ModuleProfileResult(compute_cost=0.092, peak_memory=2.401 GB, invar_size=1.118 GB, outvar_size=0.533 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(2, 10, 0, 1), 1] = ModuleProfileResult(compute_cost=0.265, peak_memory=5.925 GB, invar_size=2.574 GB, outvar_size=1.118 GB, temp_buffer_size=3.156 GB, available_memory=35.242 GB)
result[(2, 11, 0, 1), 0] = ModuleProfileResult(compute_cost=0.101, peak_memory=2.401 GB, invar_size=1.118 GB, outvar_size=0.533 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(2, 11, 0, 0), 1] = ModuleProfileResult(compute_cost=0.257, peak_memory=5.925 GB, invar_size=2.574 GB, outvar_size=1.118 GB, temp_buffer_size=3.156 GB, available_memory=35.242 GB)
result[(2, 12, 0, 0), 0] = ModuleProfileResult(compute_cost=0.100, peak_memory=2.550 GB, invar_size=1.118 GB, outvar_size=0.681 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(2, 11, 0, 1), 1] = ModuleProfileResult(compute_cost=0.250, peak_memory=5.925 GB, invar_size=2.574 GB, outvar_size=1.118 GB, temp_buffer_size=3.156 GB, available_memory=35.242 GB)
result[(2, 12, 0, 1), 0] = ModuleProfileResult(compute_cost=0.092, peak_memory=2.550 GB, invar_size=1.118 GB, outvar_size=0.681 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(2, 12, 0, 0), 1] = ModuleProfileResult(compute_cost=0.259, peak_memory=6.074 GB, invar_size=2.723 GB, outvar_size=1.118 GB, temp_buffer_size=3.156 GB, available_memory=35.242 GB)
result[(3, 9, 0, 0), 0] = ModuleProfileResult(compute_cost=0.066, peak_memory=1.874 GB, invar_size=0.662 GB, outvar_size=0.462 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(2, 12, 0, 1), 1] = ModuleProfileResult(compute_cost=0.251, peak_memory=6.074 GB, invar_size=2.723 GB, outvar_size=1.118 GB, temp_buffer_size=3.156 GB, available_memory=35.242 GB)
result[(3, 9, 0, 1), 0] = ModuleProfileResult(compute_cost=0.061, peak_memory=1.874 GB, invar_size=0.662 GB, outvar_size=0.462 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(3, 9, 0, 0), 1] = ModuleProfileResult(compute_cost=0.181, peak_memory=4.540 GB, invar_size=1.739 GB, outvar_size=0.662 GB, temp_buffer_size=2.754 GB, available_memory=35.242 GB)
result[(3, 10, 0, 0), 0] = ModuleProfileResult(compute_cost=0.094, peak_memory=1.948 GB, invar_size=0.689 GB, outvar_size=0.509 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(3, 9, 0, 1), 1] = ModuleProfileResult(compute_cost=0.172, peak_memory=4.540 GB, invar_size=1.739 GB, outvar_size=0.662 GB, temp_buffer_size=2.754 GB, available_memory=35.242 GB)
result[(3, 10, 0, 1), 0] = ModuleProfileResult(compute_cost=0.094, peak_memory=1.948 GB, invar_size=0.689 GB, outvar_size=0.509 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(3, 10, 0, 0), 1] = ModuleProfileResult(compute_cost=0.229, peak_memory=5.065 GB, invar_size=1.840 GB, outvar_size=0.689 GB, temp_buffer_size=3.179 GB, available_memory=35.242 GB)
result[(3, 11, 0, 0), 0] = ModuleProfileResult(compute_cost=0.089, peak_memory=1.948 GB, invar_size=0.689 GB, outvar_size=0.510 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(3, 10, 0, 1), 1] = ModuleProfileResult(compute_cost=0.230, peak_memory=5.065 GB, invar_size=1.840 GB, outvar_size=0.689 GB, temp_buffer_size=3.179 GB, available_memory=35.242 GB)
result[(3, 11, 0, 1), 0] = ModuleProfileResult(compute_cost=0.082, peak_memory=1.948 GB, invar_size=0.689 GB, outvar_size=0.510 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(3, 11, 0, 0), 1] = ModuleProfileResult(compute_cost=0.233, peak_memory=5.065 GB, invar_size=1.840 GB, outvar_size=0.689 GB, temp_buffer_size=3.179 GB, available_memory=35.242 GB)
result[(3, 12, 0, 0), 0] = ModuleProfileResult(compute_cost=0.090, peak_memory=2.097 GB, invar_size=0.689 GB, outvar_size=0.658 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(3, 11, 0, 1), 1] = ModuleProfileResult(compute_cost=0.230, peak_memory=5.065 GB, invar_size=1.840 GB, outvar_size=0.689 GB, temp_buffer_size=3.179 GB, available_memory=35.242 GB)
result[(3, 12, 0, 1), 0] = ModuleProfileResult(compute_cost=0.094, peak_memory=2.097 GB, invar_size=0.689 GB, outvar_size=0.658 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(3, 12, 0, 0), 1] = ModuleProfileResult(compute_cost=0.238, peak_memory=5.214 GB, invar_size=1.988 GB, outvar_size=0.689 GB, temp_buffer_size=3.179 GB, available_memory=35.242 GB)
result[(3, 13, 0, 0), 0] = ModuleProfileResult(compute_cost=0.099, peak_memory=2.401 GB, invar_size=0.970 GB, outvar_size=0.681 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(3, 12, 0, 1), 1] = ModuleProfileResult(compute_cost=0.228, peak_memory=5.214 GB, invar_size=1.988 GB, outvar_size=0.689 GB, temp_buffer_size=3.179 GB, available_memory=35.242 GB)
result[(3, 13, 0, 1), 0] = ModuleProfileResult(compute_cost=0.096, peak_memory=2.401 GB, invar_size=0.970 GB, outvar_size=0.681 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(3, 13, 0, 0), 1] = ModuleProfileResult(compute_cost=0.251, peak_memory=5.800 GB, invar_size=2.574 GB, outvar_size=0.970 GB, temp_buffer_size=3.179 GB, available_memory=35.242 GB)
result[(4, 10, 0, 0), 0] = ModuleProfileResult(compute_cost=0.081, peak_memory=1.879 GB, invar_size=0.643 GB, outvar_size=0.486 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(3, 13, 0, 1), 1] = ModuleProfileResult(compute_cost=0.251, peak_memory=5.800 GB, invar_size=2.574 GB, outvar_size=0.970 GB, temp_buffer_size=3.179 GB, available_memory=35.242 GB)
result[(4, 10, 0, 1), 0] = ModuleProfileResult(compute_cost=0.082, peak_memory=1.879 GB, invar_size=0.643 GB, outvar_size=0.486 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(4, 10, 0, 0), 1] = ModuleProfileResult(compute_cost=0.196, peak_memory=4.952 GB, invar_size=1.749 GB, outvar_size=0.643 GB, temp_buffer_size=3.180 GB, available_memory=35.242 GB)
result[(4, 11, 0, 0), 0] = ModuleProfileResult(compute_cost=0.086, peak_memory=1.879 GB, invar_size=0.643 GB, outvar_size=0.486 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(4, 10, 0, 1), 1] = ModuleProfileResult(compute_cost=0.197, peak_memory=4.952 GB, invar_size=1.749 GB, outvar_size=0.643 GB, temp_buffer_size=3.180 GB, available_memory=35.242 GB)
result[(4, 11, 0, 1), 0] = ModuleProfileResult(compute_cost=0.084, peak_memory=1.879 GB, invar_size=0.643 GB, outvar_size=0.486 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(4, 11, 0, 0), 1] = ModuleProfileResult(compute_cost=0.197, peak_memory=4.952 GB, invar_size=1.749 GB, outvar_size=0.643 GB, temp_buffer_size=3.180 GB, available_memory=35.242 GB)
result[(4, 12, 0, 0), 0] = ModuleProfileResult(compute_cost=0.076, peak_memory=2.028 GB, invar_size=0.643 GB, outvar_size=0.635 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(4, 11, 0, 1), 1] = ModuleProfileResult(compute_cost=0.193, peak_memory=4.952 GB, invar_size=1.749 GB, outvar_size=0.643 GB, temp_buffer_size=3.180 GB, available_memory=35.242 GB)
result[(4, 12, 0, 1), 0] = ModuleProfileResult(compute_cost=0.071, peak_memory=2.028 GB, invar_size=0.643 GB, outvar_size=0.635 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(4, 12, 0, 0), 1] = ModuleProfileResult(compute_cost=0.193, peak_memory=5.101 GB, invar_size=1.898 GB, outvar_size=0.643 GB, temp_buffer_size=3.180 GB, available_memory=35.242 GB)
result[(4, 13, 0, 0), 0] = ModuleProfileResult(compute_cost=0.081, peak_memory=2.332 GB, invar_size=0.925 GB, outvar_size=0.658 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(4, 12, 0, 1), 1] = ModuleProfileResult(compute_cost=0.201, peak_memory=5.101 GB, invar_size=1.898 GB, outvar_size=0.643 GB, temp_buffer_size=3.180 GB, available_memory=35.242 GB)
result[(4, 13, 0, 1), 0] = ModuleProfileResult(compute_cost=0.095, peak_memory=2.332 GB, invar_size=0.925 GB, outvar_size=0.658 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(4, 13, 0, 0), 1] = ModuleProfileResult(compute_cost=0.225, peak_memory=5.687 GB, invar_size=2.484 GB, outvar_size=0.924 GB, temp_buffer_size=3.180 GB, available_memory=35.242 GB)
result[(4, 14, 0, 0), 0] = ModuleProfileResult(compute_cost=0.088, peak_memory=2.360 GB, invar_size=0.929 GB, outvar_size=0.681 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(4, 13, 0, 1), 1] = ModuleProfileResult(compute_cost=0.228, peak_memory=5.687 GB, invar_size=2.484 GB, outvar_size=0.924 GB, temp_buffer_size=3.180 GB, available_memory=35.242 GB)
result[(4, 14, 0, 1), 0] = ModuleProfileResult(compute_cost=0.088, peak_memory=2.360 GB, invar_size=0.929 GB, outvar_size=0.681 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(4, 14, 0, 0), 1] = ModuleProfileResult(compute_cost=0.254, peak_memory=5.810 GB, invar_size=2.516 GB, outvar_size=0.929 GB, temp_buffer_size=3.271 GB, available_memory=35.242 GB)
result[(5, 10, 0, 0), 0] = ModuleProfileResult(compute_cost=0.078, peak_memory=1.851 GB, invar_size=0.811 GB, outvar_size=0.290 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(4, 14, 0, 1), 1] = ModuleProfileResult(compute_cost=0.255, peak_memory=5.810 GB, invar_size=2.516 GB, outvar_size=0.929 GB, temp_buffer_size=3.271 GB, available_memory=35.242 GB)
result[(5, 10, 0, 0), 1] = ModuleProfileResult(compute_cost=0.168, peak_memory=5.042 GB, invar_size=1.716 GB, outvar_size=0.811 GB, temp_buffer_size=3.131 GB, available_memory=35.242 GB)
result[(5, 10, 0, 1), 0] = ModuleProfileResult(compute_cost=0.073, peak_memory=1.851 GB, invar_size=0.811 GB, outvar_size=0.290 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(5, 11, 0, 0), 0] = ModuleProfileResult(compute_cost=0.060, peak_memory=1.852 GB, invar_size=0.811 GB, outvar_size=0.291 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(5, 10, 0, 1), 1] = ModuleProfileResult(compute_cost=0.174, peak_memory=5.042 GB, invar_size=1.716 GB, outvar_size=0.811 GB, temp_buffer_size=3.131 GB, available_memory=35.242 GB)
result[(5, 11, 0, 1), 0] = ModuleProfileResult(compute_cost=0.060, peak_memory=1.852 GB, invar_size=0.811 GB, outvar_size=0.291 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(5, 11, 0, 0), 1] = ModuleProfileResult(compute_cost=0.169, peak_memory=5.042 GB, invar_size=1.717 GB, outvar_size=0.811 GB, temp_buffer_size=3.131 GB, available_memory=35.242 GB)
result[(5, 12, 0, 0), 0] = ModuleProfileResult(compute_cost=0.076, peak_memory=2.000 GB, invar_size=0.811 GB, outvar_size=0.439 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(5, 11, 0, 1), 1] = ModuleProfileResult(compute_cost=0.171, peak_memory=5.042 GB, invar_size=1.717 GB, outvar_size=0.811 GB, temp_buffer_size=3.131 GB, available_memory=35.242 GB)
result[(5, 12, 0, 1), 0] = ModuleProfileResult(compute_cost=0.077, peak_memory=2.000 GB, invar_size=0.811 GB, outvar_size=0.439 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(5, 12, 0, 0), 1] = ModuleProfileResult(compute_cost=0.176, peak_memory=5.191 GB, invar_size=1.865 GB, outvar_size=0.811 GB, temp_buffer_size=3.131 GB, available_memory=35.242 GB)
result[(5, 13, 0, 0), 0] = ModuleProfileResult(compute_cost=0.070, peak_memory=2.305 GB, invar_size=1.092 GB, outvar_size=0.463 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(5, 12, 0, 1), 1] = ModuleProfileResult(compute_cost=0.172, peak_memory=5.191 GB, invar_size=1.865 GB, outvar_size=0.811 GB, temp_buffer_size=3.131 GB, available_memory=35.242 GB)
result[(5, 13, 0, 1), 0] = ModuleProfileResult(compute_cost=0.070, peak_memory=2.305 GB, invar_size=1.092 GB, outvar_size=0.463 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(5, 13, 0, 0), 1] = ModuleProfileResult(compute_cost=0.200, peak_memory=5.777 GB, invar_size=2.451 GB, outvar_size=1.092 GB, temp_buffer_size=3.131 GB, available_memory=35.242 GB)
result[(5, 14, 0, 0), 0] = ModuleProfileResult(compute_cost=0.078, peak_memory=2.333 GB, invar_size=1.096 GB, outvar_size=0.486 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(5, 13, 0, 1), 1] = ModuleProfileResult(compute_cost=0.202, peak_memory=5.777 GB, invar_size=2.451 GB, outvar_size=1.092 GB, temp_buffer_size=3.131 GB, available_memory=35.242 GB)
result[(5, 14, 0, 1), 0] = ModuleProfileResult(compute_cost=0.078, peak_memory=2.333 GB, invar_size=1.096 GB, outvar_size=0.486 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(5, 14, 0, 0), 1] = ModuleProfileResult(compute_cost=0.224, peak_memory=5.973 GB, invar_size=2.483 GB, outvar_size=1.096 GB, temp_buffer_size=3.294 GB, available_memory=35.242 GB)
result[(6, 13, 0, 0), 0] = ModuleProfileResult(compute_cost=0.061, peak_memory=1.852 GB, invar_size=0.662 GB, outvar_size=0.439 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(5, 14, 0, 1), 1] = ModuleProfileResult(compute_cost=0.224, peak_memory=5.973 GB, invar_size=2.483 GB, outvar_size=1.096 GB, temp_buffer_size=3.294 GB, available_memory=35.242 GB)
result[(6, 13, 0, 1), 0] = ModuleProfileResult(compute_cost=0.062, peak_memory=1.852 GB, invar_size=0.662 GB, outvar_size=0.439 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(6, 13, 0, 0), 1] = ModuleProfileResult(compute_cost=0.176, peak_memory=4.918 GB, invar_size=1.717 GB, outvar_size=0.662 GB, temp_buffer_size=3.154 GB, available_memory=35.242 GB)
result[(6, 14, 0, 0), 0] = ModuleProfileResult(compute_cost=0.083, peak_memory=1.879 GB, invar_size=0.667 GB, outvar_size=0.463 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(6, 13, 0, 1), 1] = ModuleProfileResult(compute_cost=0.175, peak_memory=4.918 GB, invar_size=1.717 GB, outvar_size=0.662 GB, temp_buffer_size=3.154 GB, available_memory=35.242 GB)
result[(6, 14, 0, 1), 0] = ModuleProfileResult(compute_cost=0.086, peak_memory=1.879 GB, invar_size=0.667 GB, outvar_size=0.463 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(6, 14, 0, 0), 1] = ModuleProfileResult(compute_cost=0.199, peak_memory=5.090 GB, invar_size=1.749 GB, outvar_size=0.667 GB, temp_buffer_size=3.294 GB, available_memory=35.242 GB)
result[(6, 15, 0, 0), 0] = ModuleProfileResult(compute_cost=0.070, peak_memory=1.879 GB, invar_size=0.667 GB, outvar_size=0.463 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(6, 14, 0, 1), 1] = ModuleProfileResult(compute_cost=0.197, peak_memory=5.090 GB, invar_size=1.749 GB, outvar_size=0.667 GB, temp_buffer_size=3.294 GB, available_memory=35.242 GB)
result[(6, 15, 0, 1), 0] = ModuleProfileResult(compute_cost=0.071, peak_memory=1.879 GB, invar_size=0.667 GB, outvar_size=0.463 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(6, 15, 0, 0), 1] = ModuleProfileResult(compute_cost=0.244, peak_memory=5.428 GB, invar_size=1.876 GB, outvar_size=0.730 GB, temp_buffer_size=3.505 GB, available_memory=35.242 GB)
result[(7, 15, 0, 0), 0] = ModuleProfileResult(compute_cost=0.049, peak_memory=1.829 GB, invar_size=0.641 GB, outvar_size=0.439 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(6, 15, 0, 1), 1] = ModuleProfileResult(compute_cost=0.247, peak_memory=5.428 GB, invar_size=1.876 GB, outvar_size=0.730 GB, temp_buffer_size=3.505 GB, available_memory=35.242 GB)
result[(7, 15, 0, 1), 0] = ModuleProfileResult(compute_cost=0.050, peak_memory=1.829 GB, invar_size=0.641 GB, outvar_size=0.439 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(7, 15, 0, 0), 1] = ModuleProfileResult(compute_cost=0.193, peak_memory=4.976 GB, invar_size=1.776 GB, outvar_size=0.704 GB, temp_buffer_size=3.152 GB, available_memory=35.242 GB)
result[(8, 15, 0, 0), 0] = ModuleProfileResult(compute_cost=0.050, peak_memory=1.829 GB, invar_size=0.641 GB, outvar_size=0.438 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(7, 15, 0, 1), 1] = ModuleProfileResult(compute_cost=0.195, peak_memory=4.976 GB, invar_size=1.776 GB, outvar_size=0.704 GB, temp_buffer_size=3.152 GB, available_memory=35.242 GB)
result[(8, 15, 0, 1), 0] = ModuleProfileResult(compute_cost=0.049, peak_memory=1.829 GB, invar_size=0.641 GB, outvar_size=0.438 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(8, 15, 0, 0), 1] = ModuleProfileResult(compute_cost=0.189, peak_memory=5.023 GB, invar_size=1.776 GB, outvar_size=0.704 GB, temp_buffer_size=3.200 GB, available_memory=35.242 GB)
result[(9, 15, 0, 0), 0] = ModuleProfileResult(compute_cost=0.060, peak_memory=1.805 GB, invar_size=0.789 GB, outvar_size=0.266 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(8, 15, 0, 1), 1] = ModuleProfileResult(compute_cost=0.194, peak_memory=5.023 GB, invar_size=1.776 GB, outvar_size=0.704 GB, temp_buffer_size=3.200 GB, available_memory=35.242 GB)
result[(9, 15, 0, 1), 0] = ModuleProfileResult(compute_cost=0.053, peak_memory=1.805 GB, invar_size=0.789 GB, outvar_size=0.266 GB, temp_buffer_size=0.750 GB, available_memory=35.242 GB)
result[(9, 15, 0, 0), 1] = ModuleProfileResult(compute_cost=0.188, peak_memory=5.123 GB, invar_size=1.775 GB, outvar_size=0.852 GB, temp_buffer_size=3.153 GB, available_memory=35.242 GB)
result[(9, 15, 0, 1), 1] = ModuleProfileResult(compute_cost=0.192, peak_memory=5.123 GB, invar_size=1.775 GB, outvar_size=0.852 GB, temp_buffer_size=3.153 GB, available_memory=35.242 GB)
Profiling for submesh 0 (1, 1) takes 393.89 seconds
--------------------------------------------------
----------------------------------------------------------------------
Result forward_stage_layer_ids: [[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15]]
Result mesh_shapes: [(1, 2)]
Result logical_mesh_shapes: [(2, 1)]
Result autosharding_option_dicts: [{'force_batch_dim_to_mesh_dim': 0}]
 - Compile (driver): 487.19 s
compilation time breakdown: {'stage-construction': '463.47', 'stage-construction-dp': '1.37', 'stage-construction-compilation': '38.27', 'stage-construction-profiling': '328.48'}
 - Compile (worker): 16.77 s
[I] Training process warmup (2 rounds) with dummy input batch...
    - Warmup iteration: 1/2
    - Warmup iteration: 2/2
[I] Ready to perform training process.
[I] Benchmark the training process with entire dataset and profile with driver overhead...
    - Iteration 1 / 5 is performed...
    - Iteration 2 / 5 is performed...
    - Iteration 3 / 5 is performed...
    - Iteration 4 / 5 is performed...
 - Benchmark: 37.70 s

[7.47741174697876, 4.544267892837524, 4.542052268981934, 4.547613620758057, 4.547185182571411, 4.5453040599823, 4.546479940414429]


[I] Performance metrics:
 - Iteration count: 5.
 - Total e2e training time : 23.423 s.
 - Average e2e iteration time: 4.685000419616699 s.
 - Total local training time: 22.729001998901367 s.
 - Average local iteration time: 4.546000003814697 s.
 - Max allocated memory among devices: 12.955 GB.
 - Compilation times:  {'stage-construction': 463.4684464931488, 'stage-construction-dp': 1.3694777488708496, 'stage-construction-compilation': 38.2689483165741, 'stage-construction-profiling': 328.47897601127625}
 - Metadata:  []
 - Is need save result:  True

[TMP] Current profiling results of key `1_a40_1_n_2_d`: 4.545727252960205
[TMP] Updated profiling results stored in `./jaxpr/prof_log/optimal_no_prof/moe_690M_256.pkl`...

------------------------------------------------------------------
- (2/3) Profiling moe_690M with batch size: 512...
------------------------------------------------------------------
