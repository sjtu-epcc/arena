
------------------------------------------------------------------
- (1/3) Profiling bert_2.6B with batch size: 128...
------------------------------------------------------------------
[TMP] Existed profiling results in `./jaxpr/prof_log/optimal/bert_2.6B_128.pkl`, updating/rewriting it...
[I] Ray Cluster & Alpa backend initialization is completed.
[I] Device Info:
    - Devices num per node: 2
    - Nodes num: 2
[I] Loading flax model....
[I] Model 'bert' loads sucessfully. Model Info: 

FlaxBertForMaskedLMModule(
    # attributes
    config = <model.bert_model.BertConfig object at 0x7f10b905fc10>
    dtype = float16
) 

[I] Manually constructing dummy batch...
[I] Initialize training state...
[I] Training state initialization is completed.
[I] Constructing Alpa parallelized train step func...
[I] Alpa parallelized train step func construction is completed.
-------------------- Automatic stage clustering --------------------
submesh_choices: ((1, 1), (1, 2), (2, 2))
- Profiling for submesh 2 (2, 2):
- Generate all stage infos (Jaxpr -> HLO)
- Compile all stages
- Profile all stages
result[(0, 5, 2, 0), 0] = ModuleProfileResult(compute_cost=0.114, peak_memory=4.448 GB, invar_size=4.203 GB, outvar_size=0.049 GB, temp_buffer_size=0.195 GB, available_memory=17.402 GB)
result[(0, 5, 2, 1), 0] = ModuleProfileResult(compute_cost=0.276, peak_memory=2.395 GB, invar_size=2.102 GB, outvar_size=0.098 GB, temp_buffer_size=0.195 GB, available_memory=17.402 GB)
result[(0, 5, 2, 2), 0] = ModuleProfileResult(compute_cost=0.145, peak_memory=4.302 GB, invar_size=4.018 GB, outvar_size=0.049 GB, temp_buffer_size=0.234 GB, available_memory=17.402 GB)
result[(0, 5, 2, 0), 1] = ModuleProfileResult(compute_cost=0.667, peak_memory=15.627 GB, invar_size=10.434 GB, outvar_size=5.193 GB, temp_buffer_size=5.193 GB, available_memory=17.402 GB)
result[(0, 5, 2, 1), 1] = ModuleProfileResult(compute_cost=0.999, peak_memory=7.952 GB, invar_size=5.291 GB, outvar_size=2.597 GB, temp_buffer_size=2.661 GB, available_memory=17.402 GB)
result[(0, 5, 2, 2), 1] = ModuleProfileResult(compute_cost=0.712, peak_memory=14.607 GB, invar_size=9.698 GB, outvar_size=4.824 GB, temp_buffer_size=4.909 GB, available_memory=17.402 GB)
Profiling for submesh 2 (2, 2) takes 244.73 seconds
--------------------------------------------------
- Profiling for submesh 1 (1, 2):
- Generate all stage infos (Jaxpr -> HLO)
- Compile all stages
- Profile all stages
result[(0, 2, 1, 0), 0] = ModuleProfileResult(compute_cost=0.135, peak_memory=3.041 GB, invar_size=2.591 GB, outvar_size=0.059 GB, temp_buffer_size=0.391 GB, available_memory=17.580 GB)
result[(0, 2, 1, 1), 0] = ModuleProfileResult(compute_cost=0.331, peak_memory=1.804 GB, invar_size=1.296 GB, outvar_size=0.117 GB, temp_buffer_size=0.391 GB, available_memory=17.580 GB)
result[(0, 2, 1, 2), 0] = ModuleProfileResult(compute_cost=0.141, peak_memory=2.956 GB, invar_size=2.468 GB, outvar_size=0.059 GB, temp_buffer_size=0.430 GB, available_memory=17.580 GB)
result[(1, 3, 1, 2), 0] = ModuleProfileResult(compute_cost=0.127, peak_memory=2.780 GB, invar_size=2.413 GB, outvar_size=0.059 GB, temp_buffer_size=0.309 GB, available_memory=17.580 GB)
result[(1, 3, 1, 0), 0] = ModuleProfileResult(compute_cost=0.127, peak_memory=2.780 GB, invar_size=2.413 GB, outvar_size=0.059 GB, temp_buffer_size=0.309 GB, available_memory=17.580 GB)
result[(1, 3, 1, 1), 0] = ModuleProfileResult(compute_cost=0.319, peak_memory=1.662 GB, invar_size=1.236 GB, outvar_size=0.098 GB, temp_buffer_size=0.328 GB, available_memory=17.580 GB)
result[(2, 4, 1, 0), 0] = ModuleProfileResult(compute_cost=0.129, peak_memory=2.829 GB, invar_size=2.462 GB, outvar_size=0.059 GB, temp_buffer_size=0.309 GB, available_memory=17.580 GB)
result[(2, 4, 1, 1), 0] = ModuleProfileResult(compute_cost=0.325, peak_memory=1.706 GB, invar_size=1.261 GB, outvar_size=0.117 GB, temp_buffer_size=0.328 GB, available_memory=17.580 GB)
result[(2, 4, 1, 2), 0] = ModuleProfileResult(compute_cost=0.129, peak_memory=2.829 GB, invar_size=2.462 GB, outvar_size=0.059 GB, temp_buffer_size=0.309 GB, available_memory=17.580 GB)
result[(3, 5, 1, 0), 0] = ModuleProfileResult(compute_cost=0.085, peak_memory=1.979 GB, invar_size=1.632 GB, outvar_size=0.039 GB, temp_buffer_size=0.309 GB, available_memory=17.580 GB)
result[(3, 5, 1, 1), 0] = ModuleProfileResult(compute_cost=0.216, peak_memory=1.252 GB, invar_size=0.845 GB, outvar_size=0.078 GB, temp_buffer_size=0.328 GB, available_memory=17.580 GB)
result[(0, 2, 1, 0), 1] = ModuleProfileResult(compute_cost=0.418, peak_memory=9.965 GB, invar_size=5.241 GB, outvar_size=2.591 GB, temp_buffer_size=4.723 GB, available_memory=17.580 GB)
result[(0, 2, 1, 1), 1] = ModuleProfileResult(compute_cost=0.774, peak_memory=9.241 GB, invar_size=2.709 GB, outvar_size=1.296 GB, temp_buffer_size=6.532 GB, available_memory=17.580 GB)
result[(1, 3, 1, 2), 1] = ModuleProfileResult(compute_cost=0.402, peak_memory=9.608 GB, invar_size=4.885 GB, outvar_size=2.413 GB, temp_buffer_size=4.704 GB, available_memory=17.580 GB)
result[(1, 3, 1, 0), 1] = ModuleProfileResult(compute_cost=0.402, peak_memory=9.589 GB, invar_size=4.865 GB, outvar_size=2.413 GB, temp_buffer_size=4.704 GB, available_memory=17.580 GB)
result[(0, 2, 1, 2), 1] = ModuleProfileResult(compute_cost=0.423, peak_memory=9.718 GB, invar_size=4.995 GB, outvar_size=2.468 GB, temp_buffer_size=4.723 GB, available_memory=17.580 GB)
result[(3, 5, 1, 2), 0] = ModuleProfileResult(compute_cost=0.085, peak_memory=1.979 GB, invar_size=1.632 GB, outvar_size=0.039 GB, temp_buffer_size=0.309 GB, available_memory=17.580 GB)
result[(1, 3, 1, 1), 1] = ModuleProfileResult(compute_cost=0.759, peak_memory=9.048 GB, invar_size=2.550 GB, outvar_size=1.236 GB, temp_buffer_size=6.459 GB, available_memory=17.580 GB)
result[(2, 4, 1, 0), 1] = ModuleProfileResult(compute_cost=0.408, peak_memory=9.686 GB, invar_size=4.963 GB, outvar_size=2.462 GB, temp_buffer_size=4.704 GB, available_memory=17.580 GB)
result[(2, 4, 1, 1), 1] = ModuleProfileResult(compute_cost=0.771, peak_memory=8.762 GB, invar_size=2.599 GB, outvar_size=1.261 GB, temp_buffer_size=6.123 GB, available_memory=17.580 GB)
result[(2, 4, 1, 2), 1] = ModuleProfileResult(compute_cost=0.408, peak_memory=9.686 GB, invar_size=4.963 GB, outvar_size=2.462 GB, temp_buffer_size=4.704 GB, available_memory=17.580 GB)
result[(3, 5, 1, 0), 1] = ModuleProfileResult(compute_cost=0.431, peak_memory=10.148 GB, invar_size=5.261 GB, outvar_size=2.621 GB, temp_buffer_size=4.867 GB, available_memory=17.580 GB)
result[(3, 5, 1, 1), 1] = ModuleProfileResult(compute_cost=0.795, peak_memory=9.306 GB, invar_size=2.719 GB, outvar_size=1.340 GB, temp_buffer_size=6.548 GB, available_memory=17.580 GB)
result[(3, 5, 1, 2), 1] = ModuleProfileResult(compute_cost=0.436, peak_memory=9.923 GB, invar_size=5.017 GB, outvar_size=2.499 GB, temp_buffer_size=4.887 GB, available_memory=17.580 GB)
Profiling for submesh 1 (1, 2) takes 63.71 seconds
--------------------------------------------------
- Profiling for submesh 0 (1, 1):
- Generate all stage infos (Jaxpr -> HLO)
Profiling for submesh 0 (1, 1) takes 0.15 seconds
--------------------------------------------------
Profile result saved to: profile-results-2023-11-17-10-54-40.npy
----------------------------------------------------------------------
[E] Meet unexpected error in compiling executables...

[E] Unexpected error occurred in compiling or profiling executables...
[TMP] Current profiling results of key `2_a10_2_n_2_d`: none
[TMP] Updated profiling results stored in `./jaxpr/prof_log/optimal/bert_2.6B_128.pkl`...

------------------------------------------------------------------
- (2/3) Profiling bert_2.6B with batch size: 256...
------------------------------------------------------------------
