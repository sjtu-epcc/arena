
[I] Loading Crius kernel-level profiler...
[TMP] Profiling results not found in `None`, creating it...

[I] Loading model and generating sharded HLO module...
[I] Initializing XLA devices takes 0.6353857517242432 s.
[I] Loading flax model....
[I] Model 'wide_resnet' loads sucessfully. Model Info: 

WideResNet(
    # attributes
    stage_sizes = [3, 4, 6, 3]
    block_cls = BottleneckResNetBlock
    num_classes = 1024
    num_filters = 640
    width_factor = 2
    dtype = float32
    act = relu
) 

[I] Initialize training state...
[I] Training state initialization is completed.
[I] Constructing general train step func...
[I] General train step func construction is completed.
[I] Model has been loaded, begin Jaxpr transformation...

[I] Pipeline partition mode: forced | Layer-to-stage partition: [[0, 1], [2, 3], [4, 5], [6, 7], [8, 9], [10, 11], [12, 13], [14, 15]]
[I] Pipeline partition mode: auto | Cell-generated physical mesh shapes: [(1, 2), (1, 2), (1, 2), (1, 2), (1, 2), (1, 2), (1, 2), (1, 2)]
[I] Loading model and transform to Jaxpr stages takes 14.624909162521362 s.
[I] The GPU sharding of pipeline stages is: [2, 2, 2, 2, 2, 2, 2, 2]
[I] Pipeline partition mode: auto | Parallel enum mode: auto | Parallel plans: [[StageShape(type='single', stage_shape=(1, 2), layer_shape=None), StageShape(type='single', stage_shape=(1, 2), layer_shape=None), StageShape(type='single', stage_shape=(1, 2), layer_shape=None), StageShape(type='single', stage_shape=(1, 2), layer_shape=None), StageShape(type='single', stage_shape=(1, 2), layer_shape=None), StageShape(type='single', stage_shape=(1, 2), layer_shape=None), StageShape(type='single', stage_shape=(1, 2), layer_shape=None), StageShape(type='single', stage_shape=(1, 2), layer_shape=None)]]

[I] (Parallel plan idx: 0) Sharding stages...
[I] Sharding stages takes 8.390274286270142 s.
[I] (Parallel plan idx: 0) SPMD partitioning and compiling (kernel fusing) HLO stages...
[I] SPMD partitioning and pre-compiling HLO modules concurrently takes 3.329153299331665 s.

[I] All parallel plans in the cell have been sharded and compiled.
[TMP] Writing only-sharded HLO text to '/home/cyxue/Projects/crius/Crius/runtime/jaxpr/tmp/wide_resnet_4B_256_sharded_stages.pkl'...
[TMP] Writing optimized HLO text to '/home/cyxue/Projects/crius/Crius/runtime/jaxpr/tmp/wide_resnet_4B_256_optimized_stages.pkl'...
[TMP] Writing inter-stages communicated vars to '/home/cyxue/Projects/crius/Crius/runtime/jaxpr/tmp/wide_resnet_4B_256_inter_stages_comm_vars.pkl'

[I] Parallel plan idx: 0 | Parallelism: [(1, 2), (1, 2), (1, 2), (1, 2), (1, 2), (1, 2), (1, 2), (1, 2)]

[I] (Parallel plan idx: 0) Parsing HLO texts and profiling XLA operators...
[I] Pipeline partition mode: auto | Preset physical mesh shapes: [(1, 2), (1, 2), (1, 2), (1, 2), (1, 2), (1, 2), (1, 2), (1, 2)]
[TMP] Loading offline profiled communication data: `1_a40_1_n_2_d_ib.pkl`...
[TMP] Loading offline profiled communication data: `2_a40_2_n_1_d_ib.pkl`...
\Time of module 0 (stage 0):
Intra-stage comm time: 0.04816402653232217
Grad sync time: 0

[I] Optimized module 0 for stage 0, comm time has been statically analyzed.
\Time of module 1 (stage 1):
Intra-stage comm time: 0.057498734910041094
Grad sync time: 0

[I] Optimized module 1 for stage 1, comm time has been statically analyzed.
\Time of module 2 (stage 2):
Intra-stage comm time: 0.022961602732539173
Grad sync time: 0

[I] Optimized module 2 for stage 2, comm time has been statically analyzed.
\Time of module 3 (stage 3):
Intra-stage comm time: 0.03253108970820904
Grad sync time: 0

[I] Optimized module 3 for stage 3, comm time has been statically analyzed.
\Time of module 4 (stage 4):
Intra-stage comm time: 0.013578391913324595
Grad sync time: 0

[I] Optimized module 4 for stage 4, comm time has been statically analyzed.
\Time of module 5 (stage 5):
Intra-stage comm time: 0.013578391913324595
Grad sync time: 0

[I] Optimized module 5 for stage 5, comm time has been statically analyzed.
\Time of module 6 (stage 6):
Intra-stage comm time: 0.01945804348215461
Grad sync time: 0

[I] Optimized module 6 for stage 6, comm time has been statically analyzed.
\Time of module 7 (stage 7):
Intra-stage comm time: 0.007966617587953806
Grad sync time: 0

[I] Optimized module 7 for stage 7, comm time has been statically analyzed.
\Time of module 8 (stage 7):
Intra-stage comm time: 0.01476860653433505
Grad sync time: 0

[I] Optimized module 8 for stage 7, comm time has been statically analyzed.
\Time of module 9 (stage 6):
Intra-stage comm time: 0.034559381194412715
Grad sync time: 0

[I] Optimized module 9 for stage 6, comm time has been statically analyzed.
\Time of module 10 (stage 5):
Intra-stage comm time: 0.03008424649015069
Grad sync time: 0

[I] Optimized module 10 for stage 5, comm time has been statically analyzed.
\Time of module 11 (stage 4):
Intra-stage comm time: 0.03008424649015069
Grad sync time: 0

[I] Optimized module 11 for stage 4, comm time has been statically analyzed.
\Time of module 12 (stage 3):
Intra-stage comm time: 0.053827217780053616
Grad sync time: 0

[I] Optimized module 12 for stage 3, comm time has been statically analyzed.
\Time of module 13 (stage 2):
Intra-stage comm time: 0.05338655654340982
Grad sync time: 0

[I] Optimized module 13 for stage 2, comm time has been statically analyzed.
\Time of module 14 (stage 1):
Intra-stage comm time: 0.09035358615219592
Grad sync time: 0

[I] Optimized module 14 for stage 1, comm time has been statically analyzed.
\Time of module 15 (stage 0):
Intra-stage comm time: 0.11107181720435619
Grad sync time: 0

[I] Optimized module 15 for stage 0, comm time has been statically analyzed.
\Time of module 16 (stage 0):
Intra-stage comm time: 0.00019350349903106688
Grad sync time: 0

[I] Optimized module 16 for stage 0, comm time has been statically analyzed.
\Time of module 17 (stage 1):
Intra-stage comm time: 0.00013055279850959778
Grad sync time: 0

[I] Optimized module 17 for stage 1, comm time has been statically analyzed.
\Time of module 18 (stage 2):
Intra-stage comm time: 0.00013055279850959778
Grad sync time: 0

[I] Optimized module 18 for stage 2, comm time has been statically analyzed.
\Time of module 19 (stage 3):
Intra-stage comm time: 0.00013184249401092528
Grad sync time: 0

[I] Optimized module 19 for stage 3, comm time has been statically analyzed.
\Time of module 20 (stage 4):
Intra-stage comm time: 0.0001316666603088379
Grad sync time: 0

[I] Optimized module 20 for stage 4, comm time has been statically analyzed.
\Time of module 21 (stage 5):
Intra-stage comm time: 0.0001316666603088379
Grad sync time: 0

[I] Optimized module 21 for stage 5, comm time has been statically analyzed.
\Time of module 22 (stage 6):
Intra-stage comm time: 0.00013191029429435728
Grad sync time: 0

[I] Optimized module 22 for stage 6, comm time has been statically analyzed.
\Time of module 23 (stage 7):
Intra-stage comm time: 0.00013201832771301267
Grad sync time: 0

[I] Optimized module 23 for stage 7, comm time has been statically analyzed.
[TMP] Memory footprint of the stage 0 is 0.8370564021170139 GB, while the available memory of the XLA device is 35.33237304631621 GB.
[TMP] Memory footprint of the stage 1 is 2.3524642027914524 GB, while the available memory of the XLA device is 35.33237304631621 GB.
[TMP] Memory footprint of the stage 2 is 1.8171715773642063 GB, while the available memory of the XLA device is 35.33237304631621 GB.
[TMP] Memory footprint of the stage 3 is 3.9651823081076145 GB, while the available memory of the XLA device is 35.33237304631621 GB.
[TMP] Memory footprint of the stage 4 is 4.755020145326853 GB, while the available memory of the XLA device is 35.33237304631621 GB.
[TMP] Memory footprint of the stage 5 is 4.755039218813181 GB, while the available memory of the XLA device is 35.33237304631621 GB.
[TMP] Memory footprint of the stage 6 is 13.10704231634736 GB, while the available memory of the XLA device is 35.33237304631621 GB.
[TMP] Memory footprint of the stage 7 is 17.90554443374276 GB, while the available memory of the XLA device is 35.33237304631621 GB.
[I] Only-sharded module 0 for stage 0, constructing entry XLA computation...
[I] Compiling HLO module...
[I] Profiling HLO modules...
    - Iteration 0/5: Kernel execution time: 0.076348797 s.
    - Iteration 1/5: Kernel execution time: 0.07695078699999999 s.
    - Iteration 2/5: Kernel execution time: 0.078176846 s.
    - Iteration 3/5: Kernel execution time: 0.078790607 s.
    - Iteration 4/5: Kernel execution time: 0.07808308099999998 s.
[I] Only-sharded module 1 for stage 1, constructing entry XLA computation...
[I] Compiling HLO module...
[I] Profiling HLO modules...
    - Iteration 0/5: Kernel execution time: 0.093297511 s.
    - Iteration 1/5: Kernel execution time: 0.093683114 s.
    - Iteration 2/5: Kernel execution time: 0.09329137 s.
    - Iteration 3/5: Kernel execution time: 0.093502313 s.
    - Iteration 4/5: Kernel execution time: 0.09379610599999999 s.
[I] Only-sharded module 2 for stage 2, constructing entry XLA computation...
[I] Compiling HLO module...
[I] Profiling HLO modules...
    - Iteration 0/5: Kernel execution time: 0.067231525 s.
    - Iteration 1/5: Kernel execution time: 0.067259681 s.
    - Iteration 2/5: Kernel execution time: 0.065598778 s.
    - Iteration 3/5: Kernel execution time: 0.066878723 s.
    - Iteration 4/5: Kernel execution time: 0.06620275 s.
[I] Only-sharded module 3 for stage 3, constructing entry XLA computation...
[I] Compiling HLO module...
[I] Profiling HLO modules...
    - Iteration 0/5: Kernel execution time: 0.08811898299999998 s.
    - Iteration 1/5: Kernel execution time: 0.087701065 s.
    - Iteration 2/5: Kernel execution time: 0.086711556 s.
    - Iteration 3/5: Kernel execution time: 0.087730759 s.
    - Iteration 4/5: Kernel execution time: 0.087624865 s.
[I] Only-sharded module 4 for stage 4, constructing entry XLA computation...
[I] Compiling HLO module...
[I] Profiling HLO modules...
    - Iteration 0/5: Kernel execution time: 0.081317183 s.
    - Iteration 1/5: Kernel execution time: 0.08118290999999998 s.
    - Iteration 2/5: Kernel execution time: 0.082522181 s.
    - Iteration 3/5: Kernel execution time: 0.08154397399999998 s.
    - Iteration 4/5: Kernel execution time: 0.08129270400000001 s.
[I] Only-sharded module 5 for stage 5, constructing entry XLA computation...
[I] Compiling HLO module...
[I] Profiling HLO modules...
    - Iteration 0/5: Kernel execution time: 0.08150028899999999 s.
    - Iteration 1/5: Kernel execution time: 0.08055135100000003 s.
    - Iteration 2/5: Kernel execution time: 0.080820569 s.
    - Iteration 3/5: Kernel execution time: 0.08069670000000001 s.
    - Iteration 4/5: Kernel execution time: 0.07992239200000004 s.
[I] Only-sharded module 6 for stage 6, constructing entry XLA computation...
[I] Compiling HLO module...
[I] Profiling HLO modules...
    - Iteration 0/5: Kernel execution time: 0.14133564200000007 s.
    - Iteration 1/5: Kernel execution time: 0.140803414 s.
    - Iteration 2/5: Kernel execution time: 0.14071291100000002 s.
    - Iteration 3/5: Kernel execution time: 0.140940212 s.
    - Iteration 4/5: Kernel execution time: 0.14109467900000003 s.
[I] Only-sharded module 7 for stage 7, constructing entry XLA computation...
[I] Compiling HLO module...
[I] Profiling HLO modules...
    - Iteration 0/5: Kernel execution time: 0.16025455499999994 s.
    - Iteration 1/5: Kernel execution time: 0.16090560000000007 s.
    - Iteration 2/5: Kernel execution time: 0.16058963100000004 s.
    - Iteration 3/5: Kernel execution time: 0.16103459499999997 s.
    - Iteration 4/5: Kernel execution time: 0.160754275 s.
[I] Only-sharded module 8 for stage 7, constructing entry XLA computation...
[I] Compiling HLO module...
[I] Profiling HLO modules...
    - Iteration 0/5: Kernel execution time: 0.7322264359999997 s.
    - Iteration 1/5: Kernel execution time: 0.7317858580000002 s.
    - Iteration 2/5: Kernel execution time: 0.7327551420000002 s.
    - Iteration 3/5: Kernel execution time: 0.7317660189999998 s.
    - Iteration 4/5: Kernel execution time: 0.7302323789999999 s.
[I] Only-sharded module 9 for stage 6, constructing entry XLA computation...
[I] Compiling HLO module...
[I] Profiling HLO modules...
    - Iteration 0/5: Kernel execution time: 0.5838527269999999 s.
    - Iteration 1/5: Kernel execution time: 0.5828222890000003 s.
    - Iteration 2/5: Kernel execution time: 0.5823830869999999 s.
    - Iteration 3/5: Kernel execution time: 0.5824921780000001 s.
    - Iteration 4/5: Kernel execution time: 0.5832604960000002 s.
[I] Only-sharded module 10 for stage 5, constructing entry XLA computation...
[I] Compiling HLO module...
[I] Profiling HLO modules...
    - Iteration 0/5: Kernel execution time: 0.281844984 s.
    - Iteration 1/5: Kernel execution time: 0.28258543799999997 s.
    - Iteration 2/5: Kernel execution time: 0.28173071400000005 s.
    - Iteration 3/5: Kernel execution time: 0.28357723099999993 s.
    - Iteration 4/5: Kernel execution time: 0.282146533 s.
[I] Only-sharded module 11 for stage 4, constructing entry XLA computation...
[I] Compiling HLO module...
[I] Profiling HLO modules...
    - Iteration 0/5: Kernel execution time: 0.28330932999999997 s.
    - Iteration 1/5: Kernel execution time: 0.2828364909999999 s.
    - Iteration 2/5: Kernel execution time: 0.28427423100000004 s.
    - Iteration 3/5: Kernel execution time: 0.283013389 s.
    - Iteration 4/5: Kernel execution time: 0.283610965 s.
[I] Only-sharded module 12 for stage 3, constructing entry XLA computation...
[I] Compiling HLO module...
[I] Profiling HLO modules...
    - Iteration 0/5: Kernel execution time: 0.34273619900000013 s.
    - Iteration 1/5: Kernel execution time: 0.34107589400000027 s.
    - Iteration 2/5: Kernel execution time: 0.34001658900000004 s.
    - Iteration 3/5: Kernel execution time: 0.34078305600000025 s.
    - Iteration 4/5: Kernel execution time: 0.34034398600000015 s.
[I] Only-sharded module 13 for stage 2, constructing entry XLA computation...
[I] Compiling HLO module...
[I] Profiling HLO modules...
    - Iteration 0/5: Kernel execution time: 0.22521175199999993 s.
    - Iteration 1/5: Kernel execution time: 0.22317948499999998 s.
    - Iteration 2/5: Kernel execution time: 0.2249612930000001 s.
    - Iteration 3/5: Kernel execution time: 0.22298623399999992 s.
    - Iteration 4/5: Kernel execution time: 0.22190352899999993 s.
[I] Only-sharded module 14 for stage 1, constructing entry XLA computation...
[I] Compiling HLO module...
[I] Profiling HLO modules...
    - Iteration 0/5: Kernel execution time: 0.2936712289999998 s.
    - Iteration 1/5: Kernel execution time: 0.295086692 s.
    - Iteration 2/5: Kernel execution time: 0.29372979099999996 s.
    - Iteration 3/5: Kernel execution time: 0.2940848909999999 s.
    - Iteration 4/5: Kernel execution time: 0.29629677799999987 s.
[I] Only-sharded module 15 for stage 0, constructing entry XLA computation...
[I] Compiling HLO module...
[I] Profiling HLO modules...
    - Iteration 0/5: Kernel execution time: 0.24531196900000005 s.
    - Iteration 1/5: Kernel execution time: 0.24414319500000006 s.
    - Iteration 2/5: Kernel execution time: 0.24543987199999998 s.
    - Iteration 3/5: Kernel execution time: 0.24553149199999996 s.
    - Iteration 4/5: Kernel execution time: 0.24471922999999998 s.
[I] Only-sharded module 16 for stage 0, constructing entry XLA computation...
[I] Compiling HLO module...
[I] Profiling HLO modules...
    - Iteration 0/5: Kernel execution time: 0.00050794 s.
    - Iteration 1/5: Kernel execution time: 0.000512229 s.
    - Iteration 2/5: Kernel execution time: 0.000511845 s.
    - Iteration 3/5: Kernel execution time: 0.000508965 s.
    - Iteration 4/5: Kernel execution time: 0.000508102 s.
[I] Only-sharded module 17 for stage 1, constructing entry XLA computation...
[I] Compiling HLO module...
[I] Profiling HLO modules...
    - Iteration 0/5: Kernel execution time: 0.001383178 s.
    - Iteration 1/5: Kernel execution time: 0.0013847780000000001 s.
    - Iteration 2/5: Kernel execution time: 0.001386186 s.
    - Iteration 3/5: Kernel execution time: 0.0013853860000000002 s.
    - Iteration 4/5: Kernel execution time: 0.0013854800000000001 s.
[I] Only-sharded module 18 for stage 2, constructing entry XLA computation...
[I] Compiling HLO module...
[I] Profiling HLO modules...
    - Iteration 0/5: Kernel execution time: 0.0018927790000000002 s.
    - Iteration 1/5: Kernel execution time: 0.0018927479999999999 s.
    - Iteration 2/5: Kernel execution time: 0.001886989 s.
    - Iteration 3/5: Kernel execution time: 0.0018889749999999998 s.
    - Iteration 4/5: Kernel execution time: 0.001892334 s.
[I] Only-sharded module 19 for stage 3, constructing entry XLA computation...
[I] Compiling HLO module...
[I] Profiling HLO modules...
    - Iteration 0/5: Kernel execution time: 0.005502219000000001 s.
    - Iteration 1/5: Kernel execution time: 0.0054929060000000005 s.
    - Iteration 2/5: Kernel execution time: 0.005498792000000001 s.
    - Iteration 3/5: Kernel execution time: 0.005499144000000001 s.
    - Iteration 4/5: Kernel execution time: 0.005495848 s.
[I] Only-sharded module 20 for stage 4, constructing entry XLA computation...
[I] Compiling HLO module...
[I] Profiling HLO modules...
    - Iteration 0/5: Kernel execution time: 0.007648826 s.
    - Iteration 1/5: Kernel execution time: 0.007655128 s.
    - Iteration 2/5: Kernel execution time: 0.007656086 s.
    - Iteration 3/5: Kernel execution time: 0.00765004 s.
    - Iteration 4/5: Kernel execution time: 0.007645433 s.
[I] Only-sharded module 21 for stage 5, constructing entry XLA computation...
[I] Compiling HLO module...
[I] Profiling HLO modules...
    - Iteration 0/5: Kernel execution time: 0.007650840000000001 s.
    - Iteration 1/5: Kernel execution time: 0.007652600000000001 s.
    - Iteration 2/5: Kernel execution time: 0.007662137 s.
    - Iteration 3/5: Kernel execution time: 0.007653144000000001 s.
    - Iteration 4/5: Kernel execution time: 0.00764332 s.
[I] Only-sharded module 22 for stage 6, constructing entry XLA computation...
[I] Compiling HLO module...
[I] Profiling HLO modules...
    - Iteration 0/5: Kernel execution time: 0.022010848 s.
    - Iteration 1/5: Kernel execution time: 0.022003811 s.
    - Iteration 2/5: Kernel execution time: 0.022006562 s.
    - Iteration 3/5: Kernel execution time: 0.022032482 s.
    - Iteration 4/5: Kernel execution time: 0.022023426 s.
[I] Only-sharded module 23 for stage 7, constructing entry XLA computation...
[I] Compiling HLO module...
[I] Profiling HLO modules...
    - Iteration 0/5: Kernel execution time: 0.031164330000000004 s.
    - Iteration 1/5: Kernel execution time: 0.031176234000000004 s.
    - Iteration 2/5: Kernel execution time: 0.031135882000000004 s.
    - Iteration 3/5: Kernel execution time: 0.031164714000000003 s.
    - Iteration 4/5: Kernel execution time: 0.031169066000000002 s.
[I] Constructing single-device HLO modules concurrently takes 0.010350465774536133 s.
[I] Compile single-device HLO modules concurrently takes 1.1054809093475342 s.
[I] Profile all compiled sequentially on one GPU takes 42.76334810256958 s.
[I] Estimated e2e pipeline iteration time is: 24.664755740754313 s.
    - Kernel computation time is: -1.0 s.
    - Communication time is: -1.0 s.
    - Cross-stages communication time is: -1.0 s.
