
[I] Loading Crius kernel-level profiler...
[TMP] Profiling results not found in `None`, creating it...

[I] Loading model and generating sharded HLO module...
[I] Initializing XLA devices takes 0.6419093608856201 s.
[I] Loading flax model....
[I] Model 'wide_resnet' loads sucessfully. Model Info: 

WideResNet(
    # attributes
    stage_sizes = [3, 4, 6, 3]
    block_cls = BottleneckResNetBlock
    num_classes = 1024
    num_filters = 640
    width_factor = 2
    dtype = float32
    act = relu
) 

[I] Initialize training state...
[I] Training state initialization is completed.
[I] Constructing general train step func...
[I] General train step func construction is completed.
[I] Model has been loaded, begin Jaxpr transformation...

[I] Pipeline partition mode: forced | Layer-to-stage partition: [[0, 1], [2, 3], [4, 5], [6, 7], [8, 9], [10, 11], [12, 13], [14, 15]]
[I] Pipeline partition mode: auto | Cell-generated physical mesh shapes: [(1, 2), (1, 2), (1, 2), (1, 2), (1, 2), (1, 2), (1, 2), (1, 2)]
[I] Loading model and transform to Jaxpr stages takes 14.392078876495361 s.
[I] The GPU sharding of pipeline stages is: [2, 2, 2, 2, 2, 2, 2, 2]
[I] Pipeline partition mode: auto | Parallel enum mode: auto | Parallel plans: [[StageShape(type='single', stage_shape=(2, 1), layer_shape=None), StageShape(type='single', stage_shape=(2, 1), layer_shape=None), StageShape(type='single', stage_shape=(2, 1), layer_shape=None), StageShape(type='single', stage_shape=(2, 1), layer_shape=None), StageShape(type='single', stage_shape=(1, 2), layer_shape=None), StageShape(type='single', stage_shape=(1, 2), layer_shape=None), StageShape(type='single', stage_shape=(1, 2), layer_shape=None), StageShape(type='single', stage_shape=(1, 2), layer_shape=None)]]

[I] (Parallel plan idx: 0) Sharding stages...
[I] Sharding stages takes 7.410125494003296 s.
[I] (Parallel plan idx: 0) SPMD partitioning and compiling (kernel fusing) HLO stages...
[I] SPMD partitioning and pre-compiling HLO modules concurrently takes 3.091963529586792 s.

[I] All parallel plans in the cell have been sharded and compiled.
[TMP] Writing only-sharded HLO text to '/home/cyxue/Projects/crius/Crius/runtime/jaxpr/tmp/wide_resnet_4B_256_sharded_stages.pkl'...
[TMP] Writing optimized HLO text to '/home/cyxue/Projects/crius/Crius/runtime/jaxpr/tmp/wide_resnet_4B_256_optimized_stages.pkl'...
[TMP] Writing inter-stages communicated vars to '/home/cyxue/Projects/crius/Crius/runtime/jaxpr/tmp/wide_resnet_4B_256_inter_stages_comm_vars.pkl'

[I] Parallel plan idx: 0 | Parallelism: [(2, 1), (2, 1), (2, 1), (2, 1), (1, 2), (1, 2), (1, 2), (1, 2)]

[I] (Parallel plan idx: 0) Parsing HLO texts and profiling XLA operators...
[I] Pipeline partition mode: auto | Preset physical mesh shapes: [(1, 2), (1, 2), (1, 2), (1, 2), (1, 2), (1, 2), (1, 2), (1, 2)]
[TMP] Loading offline profiled communication data: `1_a40_1_n_2_d_ib.pkl`...
[TMP] Loading offline profiled communication data: `2_a40_2_n_1_d_ib.pkl`...
\Time of module 0 (stage 0):
Intra-stage comm time: 0.0007580183446407318
Grad sync time: 0

[I] Optimized module 0 for stage 0, comm time has been statically analyzed.
\Time of module 1 (stage 1):
Intra-stage comm time: 0.0006677791476249695
Grad sync time: 0

[I] Optimized module 1 for stage 1, comm time has been statically analyzed.
\Time of module 2 (stage 2):
Intra-stage comm time: 0.0006656631827354431
Grad sync time: 0

[I] Optimized module 2 for stage 2, comm time has been statically analyzed.
\Time of module 3 (stage 3):
Intra-stage comm time: 0.0006955355405807494
Grad sync time: 0

[I] Optimized module 3 for stage 3, comm time has been statically analyzed.
\Time of module 4 (stage 4):
Intra-stage comm time: 0.013578391913324595
Grad sync time: 0

[I] Optimized module 4 for stage 4, comm time has been statically analyzed.
\Time of module 5 (stage 5):
Intra-stage comm time: 0.013578391913324595
Grad sync time: 0

[I] Optimized module 5 for stage 5, comm time has been statically analyzed.
\Time of module 6 (stage 6):
Intra-stage comm time: 0.01945804348215461
Grad sync time: 0

[I] Optimized module 6 for stage 6, comm time has been statically analyzed.
\Time of module 7 (stage 7):
Intra-stage comm time: 0.007966617587953806
Grad sync time: 0

[I] Optimized module 7 for stage 7, comm time has been statically analyzed.
\Time of module 8 (stage 7):
Intra-stage comm time: 0.01476860653433505
Grad sync time: 0

[I] Optimized module 8 for stage 7, comm time has been statically analyzed.
\Time of module 9 (stage 6):
Intra-stage comm time: 0.034559381194412715
Grad sync time: 0

[I] Optimized module 9 for stage 6, comm time has been statically analyzed.
\Time of module 10 (stage 5):
Intra-stage comm time: 0.03008424649015069
Grad sync time: 0

[I] Optimized module 10 for stage 5, comm time has been statically analyzed.
\Time of module 11 (stage 4):
Intra-stage comm time: 0.03008424649015069
Grad sync time: 0

[I] Optimized module 11 for stage 4, comm time has been statically analyzed.
[WARN] Communication size of 'all-reduce' excceeds the maximum profiled size. Linear scaling is applied.
       - Communication size of the operator: 285135360 | Estimated comm time: 0.09779390051748488
       - Max profiled communication size: 267386880 | Comm time: 0.08228549003601074
\Time of module 12 (stage 3):
Intra-stage comm time: 0.0013669651001691763
Grad sync time: 0.09779390051748488

[I] Optimized module 12 for stage 3, comm time has been statically analyzed.
\Time of module 13 (stage 2):
Intra-stage comm time: 0.001308351755142212
Grad sync time: 0.030452021535231986

[I] Optimized module 13 for stage 2, comm time has been statically analyzed.
\Time of module 14 (stage 1):
Intra-stage comm time: 0.001316172070801258
Grad sync time: 0.022064089264410235

[I] Optimized module 14 for stage 1, comm time has been statically analyzed.
\Time of module 15 (stage 0):
Intra-stage comm time: 0.001507845148444176
Grad sync time: 0.008554695884959074

[I] Optimized module 15 for stage 0, comm time has been statically analyzed.
\Time of module 16 (stage 0):
Intra-stage comm time: 0.004880981147289276
Grad sync time: 0

[I] Optimized module 16 for stage 0, comm time has been statically analyzed.
\Time of module 17 (stage 1):
Intra-stage comm time: 0.01288060247898102
Grad sync time: 0

[I] Optimized module 17 for stage 1, comm time has been statically analyzed.
\Time of module 18 (stage 2):
Intra-stage comm time: 0.017891987413167956
Grad sync time: 0

[I] Optimized module 18 for stage 2, comm time has been statically analyzed.
\Time of module 19 (stage 3):
Intra-stage comm time: 0.048361211477054494
Grad sync time: 0

[I] Optimized module 19 for stage 3, comm time has been statically analyzed.
\Time of module 20 (stage 4):
Intra-stage comm time: 0.0001316666603088379
Grad sync time: 0

[I] Optimized module 20 for stage 4, comm time has been statically analyzed.
\Time of module 21 (stage 5):
Intra-stage comm time: 0.0001316666603088379
Grad sync time: 0

[I] Optimized module 21 for stage 5, comm time has been statically analyzed.
\Time of module 22 (stage 6):
Intra-stage comm time: 0.00013191029429435728
Grad sync time: 0

[I] Optimized module 22 for stage 6, comm time has been statically analyzed.
\Time of module 23 (stage 7):
Intra-stage comm time: 0.00013201832771301267
Grad sync time: 0

[I] Optimized module 23 for stage 7, comm time has been statically analyzed.
[TMP] Memory footprint of the stage 0 is 0.9424107111990452 GB, while the available memory of the XLA device is 35.33237304631621 GB.
[TMP] Memory footprint of the stage 1 is 2.2987210787832737 GB, while the available memory of the XLA device is 35.33237304631621 GB.
[TMP] Memory footprint of the stage 2 is 2.493691448122263 GB, while the available memory of the XLA device is 35.33237304631621 GB.
[TMP] Memory footprint of the stage 3 is 6.261870864778757 GB, while the available memory of the XLA device is 35.33237304631621 GB.
[TMP] Memory footprint of the stage 4 is 4.755020145326853 GB, while the available memory of the XLA device is 35.33237304631621 GB.
[TMP] Memory footprint of the stage 5 is 4.755039218813181 GB, while the available memory of the XLA device is 35.33237304631621 GB.
[TMP] Memory footprint of the stage 6 is 13.10704231634736 GB, while the available memory of the XLA device is 35.33237304631621 GB.
[TMP] Memory footprint of the stage 7 is 17.90554443374276 GB, while the available memory of the XLA device is 35.33237304631621 GB.
[I] Only-sharded module 0 for stage 0, constructing entry XLA computation...
[I] Compiling HLO module...
[I] Profiling HLO modules...
    - Iteration 0/5: Kernel execution time: 0.08185187399999999 s.
    - Iteration 1/5: Kernel execution time: 0.08092430900000001 s.
    - Iteration 2/5: Kernel execution time: 0.08324961300000001 s.
    - Iteration 3/5: Kernel execution time: 0.08188169599999999 s.
    - Iteration 4/5: Kernel execution time: 0.08242531800000001 s.
[I] Only-sharded module 1 for stage 1, constructing entry XLA computation...
[I] Compiling HLO module...
[I] Profiling HLO modules...
    - Iteration 0/5: Kernel execution time: 0.092141917 s.
    - Iteration 1/5: Kernel execution time: 0.09168341400000002 s.
    - Iteration 2/5: Kernel execution time: 0.091973529 s.
    - Iteration 3/5: Kernel execution time: 0.09205276799999998 s.
    - Iteration 4/5: Kernel execution time: 0.09228598199999997 s.
[I] Only-sharded module 2 for stage 2, constructing entry XLA computation...
[I] Compiling HLO module...
[I] Profiling HLO modules...
    - Iteration 0/5: Kernel execution time: 0.07564707899999999 s.
    - Iteration 1/5: Kernel execution time: 0.07579693700000001 s.
    - Iteration 2/5: Kernel execution time: 0.075260678 s.
    - Iteration 3/5: Kernel execution time: 0.075619144 s.
    - Iteration 4/5: Kernel execution time: 0.07631815800000001 s.
[I] Only-sharded module 3 for stage 3, constructing entry XLA computation...
[I] Compiling HLO module...
[I] Profiling HLO modules...
    - Iteration 0/5: Kernel execution time: 0.11263534900000001 s.
    - Iteration 1/5: Kernel execution time: 0.113031964 s.
    - Iteration 2/5: Kernel execution time: 0.113554078 s.
    - Iteration 3/5: Kernel execution time: 0.11373832899999999 s.
    - Iteration 4/5: Kernel execution time: 0.11329400799999999 s.
[I] Only-sharded module 4 for stage 4, constructing entry XLA computation...
[I] Compiling HLO module...
[I] Profiling HLO modules...
    - Iteration 0/5: Kernel execution time: 0.080133804 s.
    - Iteration 1/5: Kernel execution time: 0.081942366 s.
    - Iteration 2/5: Kernel execution time: 0.08152732100000001 s.
    - Iteration 3/5: Kernel execution time: 0.08207321399999998 s.
    - Iteration 4/5: Kernel execution time: 0.08214316500000002 s.
[I] Only-sharded module 5 for stage 5, constructing entry XLA computation...
[I] Compiling HLO module...
[I] Profiling HLO modules...
    - Iteration 0/5: Kernel execution time: 0.07994372500000001 s.
    - Iteration 1/5: Kernel execution time: 0.08060881500000003 s.
    - Iteration 2/5: Kernel execution time: 0.08176258899999997 s.
    - Iteration 3/5: Kernel execution time: 0.08159442600000001 s.
    - Iteration 4/5: Kernel execution time: 0.08100536299999998 s.
[I] Only-sharded module 6 for stage 6, constructing entry XLA computation...
[I] Compiling HLO module...
[I] Profiling HLO modules...
    - Iteration 0/5: Kernel execution time: 0.14157583200000004 s.
    - Iteration 1/5: Kernel execution time: 0.14112814499999998 s.
    - Iteration 2/5: Kernel execution time: 0.14133153399999998 s.
    - Iteration 3/5: Kernel execution time: 0.14093374000000006 s.
    - Iteration 4/5: Kernel execution time: 0.140752908 s.
[I] Only-sharded module 7 for stage 7, constructing entry XLA computation...
[I] Compiling HLO module...
[I] Profiling HLO modules...
    - Iteration 0/5: Kernel execution time: 0.16097308700000004 s.
    - Iteration 1/5: Kernel execution time: 0.16083827199999995 s.
    - Iteration 2/5: Kernel execution time: 0.16107468699999994 s.
    - Iteration 3/5: Kernel execution time: 0.160784831 s.
    - Iteration 4/5: Kernel execution time: 0.16103382300000002 s.
[I] Only-sharded module 8 for stage 7, constructing entry XLA computation...
[I] Compiling HLO module...
[I] Profiling HLO modules...
    - Iteration 0/5: Kernel execution time: 0.732142699 s.
    - Iteration 1/5: Kernel execution time: 0.732344425 s.
    - Iteration 2/5: Kernel execution time: 0.7316117770000001 s.
    - Iteration 3/5: Kernel execution time: 0.7349778640000001 s.
    - Iteration 4/5: Kernel execution time: 0.7322082620000002 s.
[I] Only-sharded module 9 for stage 6, constructing entry XLA computation...
[I] Compiling HLO module...
[I] Profiling HLO modules...
    - Iteration 0/5: Kernel execution time: 0.583375851 s.
    - Iteration 1/5: Kernel execution time: 0.5825972280000001 s.
    - Iteration 2/5: Kernel execution time: 0.5835589919999999 s.
    - Iteration 3/5: Kernel execution time: 0.5829541570000001 s.
    - Iteration 4/5: Kernel execution time: 0.5846943960000001 s.
[I] Only-sharded module 10 for stage 5, constructing entry XLA computation...
[I] Compiling HLO module...
[I] Profiling HLO modules...
    - Iteration 0/5: Kernel execution time: 0.28284322500000003 s.
    - Iteration 1/5: Kernel execution time: 0.2823247840000001 s.
    - Iteration 2/5: Kernel execution time: 0.282177491 s.
    - Iteration 3/5: Kernel execution time: 0.2840233300000001 s.
    - Iteration 4/5: Kernel execution time: 0.28253921400000004 s.
[I] Only-sharded module 11 for stage 4, constructing entry XLA computation...
[I] Compiling HLO module...
[I] Profiling HLO modules...
    - Iteration 0/5: Kernel execution time: 0.2821758750000001 s.
    - Iteration 1/5: Kernel execution time: 0.2850790089999999 s.
    - Iteration 2/5: Kernel execution time: 0.284714371 s.
    - Iteration 3/5: Kernel execution time: 0.28521619099999995 s.
    - Iteration 4/5: Kernel execution time: 0.2844949099999999 s.
[I] Only-sharded module 12 for stage 3, constructing entry XLA computation...
[I] Compiling HLO module...
[I] Profiling HLO modules...
    - Iteration 0/5: Kernel execution time: 0.37517491000000003 s.
    - Iteration 1/5: Kernel execution time: 0.37440724999999997 s.
    - Iteration 2/5: Kernel execution time: 0.376153214 s.
    - Iteration 3/5: Kernel execution time: 0.37495356700000015 s.
    - Iteration 4/5: Kernel execution time: 0.37629860100000007 s.
[I] Only-sharded module 13 for stage 2, constructing entry XLA computation...
[I] Compiling HLO module...
[I] Profiling HLO modules...
    - Iteration 0/5: Kernel execution time: 0.2365514920000001 s.
    - Iteration 1/5: Kernel execution time: 0.23523182900000003 s.
    - Iteration 2/5: Kernel execution time: 0.23769793000000006 s.
    - Iteration 3/5: Kernel execution time: 0.240494339 s.
    - Iteration 4/5: Kernel execution time: 0.23734042099999997 s.
[I] Only-sharded module 14 for stage 1, constructing entry XLA computation...
[I] Compiling HLO module...
[I] Profiling HLO modules...
    - Iteration 0/5: Kernel execution time: 0.299118694 s.
    - Iteration 1/5: Kernel execution time: 0.29746815100000007 s.
    - Iteration 2/5: Kernel execution time: 0.297780185 s.
    - Iteration 3/5: Kernel execution time: 0.29829657200000004 s.
    - Iteration 4/5: Kernel execution time: 0.29892211 s.
[I] Only-sharded module 15 for stage 0, constructing entry XLA computation...
[I] Compiling HLO module...
[I] Profiling HLO modules...
    - Iteration 0/5: Kernel execution time: 0.23939631099999992 s.
    - Iteration 1/5: Kernel execution time: 0.23760816600000007 s.
    - Iteration 2/5: Kernel execution time: 0.24002377200000008 s.
    - Iteration 3/5: Kernel execution time: 0.24063357200000007 s.
    - Iteration 4/5: Kernel execution time: 0.23921205499999998 s.
[I] Only-sharded module 16 for stage 0, constructing entry XLA computation...
[I] Compiling HLO module...
[I] Profiling HLO modules...
    - Iteration 0/5: Kernel execution time: 0.000760999 s.
    - Iteration 1/5: Kernel execution time: 0.0007673980000000001 s.
    - Iteration 2/5: Kernel execution time: 0.0007626 s.
    - Iteration 3/5: Kernel execution time: 0.0007656100000000001 s.
    - Iteration 4/5: Kernel execution time: 0.0007643890000000001 s.
[I] Only-sharded module 17 for stage 1, constructing entry XLA computation...
[I] Compiling HLO module...
[I] Profiling HLO modules...
    - Iteration 0/5: Kernel execution time: 0.002018642 s.
    - Iteration 1/5: Kernel execution time: 0.0020202099999999997 s.
    - Iteration 2/5: Kernel execution time: 0.002014739 s.
    - Iteration 3/5: Kernel execution time: 0.002022676 s.
    - Iteration 4/5: Kernel execution time: 0.00201896 s.
[I] Only-sharded module 18 for stage 2, constructing entry XLA computation...
[I] Compiling HLO module...
[I] Profiling HLO modules...
    - Iteration 0/5: Kernel execution time: 0.002755611 s.
    - Iteration 1/5: Kernel execution time: 0.002761852 s.
    - Iteration 2/5: Kernel execution time: 0.002769433 s.
    - Iteration 3/5: Kernel execution time: 0.002774073 s.
    - Iteration 4/5: Kernel execution time: 0.002758554 s.
[I] Only-sharded module 19 for stage 3, constructing entry XLA computation...
[I] Compiling HLO module...
[I] Profiling HLO modules...
    - Iteration 0/5: Kernel execution time: 0.007843981 s.
    - Iteration 1/5: Kernel execution time: 0.007839178 s.
    - Iteration 2/5: Kernel execution time: 0.007834055 s.
    - Iteration 3/5: Kernel execution time: 0.007824042000000002 s.
    - Iteration 4/5: Kernel execution time: 0.007822856 s.
[I] Only-sharded module 20 for stage 4, constructing entry XLA computation...
[I] Compiling HLO module...
[I] Profiling HLO modules...
    - Iteration 0/5: Kernel execution time: 0.007649320000000001 s.
    - Iteration 1/5: Kernel execution time: 0.007650312000000001 s.
    - Iteration 2/5: Kernel execution time: 0.007668136000000001 s.
    - Iteration 3/5: Kernel execution time: 0.007651433000000001 s.
    - Iteration 4/5: Kernel execution time: 0.007646377 s.
[I] Only-sharded module 21 for stage 5, constructing entry XLA computation...
[I] Compiling HLO module...
[I] Profiling HLO modules...
    - Iteration 0/5: Kernel execution time: 0.007648648000000001 s.
    - Iteration 1/5: Kernel execution time: 0.00765332 s.
    - Iteration 2/5: Kernel execution time: 0.007660264000000001 s.
    - Iteration 3/5: Kernel execution time: 0.007648009000000001 s.
    - Iteration 4/5: Kernel execution time: 0.007648328 s.
[I] Only-sharded module 22 for stage 6, constructing entry XLA computation...
[I] Compiling HLO module...
[I] Profiling HLO modules...
    - Iteration 0/5: Kernel execution time: 0.022009455000000004 s.
    - Iteration 1/5: Kernel execution time: 0.022013648 s.
    - Iteration 2/5: Kernel execution time: 0.022022703 s.
    - Iteration 3/5: Kernel execution time: 0.021977167000000002 s.
    - Iteration 4/5: Kernel execution time: 0.022013071000000002 s.
[I] Only-sharded module 23 for stage 7, constructing entry XLA computation...
[I] Compiling HLO module...
[I] Profiling HLO modules...
    - Iteration 0/5: Kernel execution time: 0.03116452 s.
    - Iteration 1/5: Kernel execution time: 0.031171209000000002 s.
    - Iteration 2/5: Kernel execution time: 0.031170569000000002 s.
    - Iteration 3/5: Kernel execution time: 0.031159113000000002 s.
    - Iteration 4/5: Kernel execution time: 0.031200844000000002 s.
[I] Constructing single-device HLO modules concurrently takes 0.011152267456054688 s.
[I] Compile single-device HLO modules concurrently takes 1.1599195003509521 s.
[I] Profile all compiled sequentially on one GPU takes 45.072062969207764 s.
[I] Estimated e2e pipeline iteration time is: 22.469970137326758 s.
    - Kernel computation time is: -1.0 s.
    - Communication time is: -1.0 s.
    - Cross-stages communication time is: -1.0 s.
