
------------------------------------------------------------------
- (1/3) Profiling moe_1.3B with batch size: 256...
------------------------------------------------------------------
[TMP] Existed profiling results in `./jaxpr/prof_log/optimal/moe_1.3B_256.pkl`, updating/rewriting it...
[I] Ray Cluster & Alpa backend initialization is completed.
[I] Device Info:
    - Devices num per node: 2
    - Nodes num: 4
[I] Loading flax model....
[I] Model 'moe' loads sucessfully. Model Info: 

FlaxMoEForLMModule(
    # attributes
    config = <model.moe_model.MoEConfig object at 0x7f6e161e6f70>
    dtype = float16
    bias_init = zeros
) 

[I] Manually constructing dummy batch...
[I] Initialize training state...
[I] Training state initialization is completed.
[I] Constructing Alpa parallelized train step func...
[I] Alpa parallelized train step func construction is completed.
-------------------- Automatic stage clustering --------------------
submesh_choices: ((1, 1), (1, 2), (2, 2), (4, 2))
- Profiling for submesh 3 (4, 2):
- Generate all stage infos (Jaxpr -> HLO)
- Compile all stages
- Profile all stages
result[(0, 7, 3, 0), 0] = ModuleProfileResult(compute_cost=0.018, peak_memory=2.348 GB, invar_size=2.201 GB, outvar_size=0.021 GB, temp_buffer_size=0.126 GB, available_memory=17.402 GB)
result[(0, 7, 3, 1), 0] = ModuleProfileResult(compute_cost=0.040, peak_memory=1.252 GB, invar_size=1.101 GB, outvar_size=0.029 GB, temp_buffer_size=0.122 GB, available_memory=17.402 GB)
result[(0, 7, 3, 2), 0] = ModuleProfileResult(compute_cost=0.048, peak_memory=0.625 GB, invar_size=0.478 GB, outvar_size=0.021 GB, temp_buffer_size=0.126 GB, available_memory=17.402 GB)
result[(0, 7, 3, 0), 1] = ModuleProfileResult(compute_cost=0.223, peak_memory=7.684 GB, invar_size=5.130 GB, outvar_size=2.554 GB, temp_buffer_size=2.555 GB, available_memory=17.402 GB)
result[(0, 7, 3, 1), 1] = ModuleProfileResult(compute_cost=0.246, peak_memory=3.862 GB, invar_size=2.584 GB, outvar_size=1.277 GB, temp_buffer_size=1.277 GB, available_memory=17.402 GB)
result[(0, 7, 3, 2), 1] = ModuleProfileResult(compute_cost=0.149, peak_memory=1.917 GB, invar_size=1.192 GB, outvar_size=0.586 GB, temp_buffer_size=0.725 GB, available_memory=17.402 GB)
Profiling for submesh 3 (4, 2) takes 80.81 seconds
--------------------------------------------------
- Profiling for submesh 2 (2, 2):
- Generate all stage infos (Jaxpr -> HLO)
- Compile all stages
- Profile all stages
result[(1, 4, 2, 2), 0] = ModuleProfileResult(compute_cost=0.037, peak_memory=0.627 GB, invar_size=0.410 GB, outvar_size=0.023 GB, temp_buffer_size=0.193 GB, available_memory=17.580 GB)
result[(0, 3, 2, 2), 0] = ModuleProfileResult(compute_cost=0.038, peak_memory=0.692 GB, invar_size=0.417 GB, outvar_size=0.023 GB, temp_buffer_size=0.252 GB, available_memory=17.580 GB)
result[(1, 4, 2, 0), 0] = ModuleProfileResult(compute_cost=0.019, peak_memory=1.471 GB, invar_size=1.254 GB, outvar_size=0.023 GB, temp_buffer_size=0.193 GB, available_memory=17.580 GB)
result[(0, 3, 2, 1), 0] = ModuleProfileResult(compute_cost=0.031, peak_memory=0.973 GB, invar_size=0.630 GB, outvar_size=0.023 GB, temp_buffer_size=0.319 GB, available_memory=17.580 GB)
result[(1, 4, 2, 1), 0] = ModuleProfileResult(compute_cost=0.030, peak_memory=0.948 GB, invar_size=0.636 GB, outvar_size=0.023 GB, temp_buffer_size=0.289 GB, available_memory=17.580 GB)
result[(0, 3, 2, 0), 0] = ModuleProfileResult(compute_cost=0.019, peak_memory=1.536 GB, invar_size=1.260 GB, outvar_size=0.023 GB, temp_buffer_size=0.252 GB, available_memory=17.580 GB)
result[(1, 5, 2, 0), 0] = ModuleProfileResult(compute_cost=0.023, peak_memory=1.785 GB, invar_size=1.562 GB, outvar_size=0.029 GB, temp_buffer_size=0.194 GB, available_memory=17.580 GB)
result[(0, 3, 2, 0), 1] = ModuleProfileResult(compute_cost=0.120, peak_memory=3.805 GB, invar_size=2.544 GB, outvar_size=1.260 GB, temp_buffer_size=1.260 GB, available_memory=17.580 GB)
result[(1, 4, 2, 0), 1] = ModuleProfileResult(compute_cost=0.119, peak_memory=3.780 GB, invar_size=2.526 GB, outvar_size=1.254 GB, temp_buffer_size=1.248 GB, available_memory=17.580 GB)
result[(0, 3, 2, 2), 1] = ModuleProfileResult(compute_cost=0.098, peak_memory=1.989 GB, invar_size=0.857 GB, outvar_size=0.417 GB, temp_buffer_size=1.132 GB, available_memory=17.580 GB)
result[(1, 4, 2, 2), 1] = ModuleProfileResult(compute_cost=0.098, peak_memory=1.970 GB, invar_size=0.856 GB, outvar_size=0.410 GB, temp_buffer_size=1.109 GB, available_memory=17.580 GB)
result[(2, 5, 2, 0), 0] = ModuleProfileResult(compute_cost=0.019, peak_memory=1.471 GB, invar_size=1.254 GB, outvar_size=0.023 GB, temp_buffer_size=0.193 GB, available_memory=17.580 GB)
result[(0, 3, 2, 1), 1] = ModuleProfileResult(compute_cost=0.153, peak_memory=2.688 GB, invar_size=1.284 GB, outvar_size=0.630 GB, temp_buffer_size=1.404 GB, available_memory=17.580 GB)
result[(1, 5, 2, 1), 0] = ModuleProfileResult(compute_cost=0.037, peak_memory=1.134 GB, invar_size=0.790 GB, outvar_size=0.029 GB, temp_buffer_size=0.315 GB, available_memory=17.580 GB)
result[(2, 5, 2, 1), 0] = ModuleProfileResult(compute_cost=0.030, peak_memory=0.948 GB, invar_size=0.636 GB, outvar_size=0.023 GB, temp_buffer_size=0.289 GB, available_memory=17.580 GB)
result[(1, 5, 2, 2), 0] = ModuleProfileResult(compute_cost=0.046, peak_memory=0.730 GB, invar_size=0.507 GB, outvar_size=0.029 GB, temp_buffer_size=0.194 GB, available_memory=17.580 GB)
result[(1, 5, 2, 0), 1] = ModuleProfileResult(compute_cost=0.148, peak_memory=4.709 GB, invar_size=3.147 GB, outvar_size=1.562 GB, temp_buffer_size=1.556 GB, available_memory=17.580 GB)
result[(1, 4, 2, 1), 1] = ModuleProfileResult(compute_cost=0.159, peak_memory=2.509 GB, invar_size=1.290 GB, outvar_size=0.636 GB, temp_buffer_size=1.208 GB, available_memory=17.580 GB)
result[(2, 5, 2, 2), 0] = ModuleProfileResult(compute_cost=0.037, peak_memory=0.627 GB, invar_size=0.410 GB, outvar_size=0.023 GB, temp_buffer_size=0.194 GB, available_memory=17.580 GB)
result[(2, 5, 2, 0), 1] = ModuleProfileResult(compute_cost=0.119, peak_memory=3.780 GB, invar_size=2.526 GB, outvar_size=1.254 GB, temp_buffer_size=1.248 GB, available_memory=17.580 GB)
result[(2, 6, 2, 0), 0] = ModuleProfileResult(compute_cost=0.023, peak_memory=1.785 GB, invar_size=1.562 GB, outvar_size=0.029 GB, temp_buffer_size=0.194 GB, available_memory=17.580 GB)
result[(3, 6, 2, 0), 0] = ModuleProfileResult(compute_cost=0.019, peak_memory=1.471 GB, invar_size=1.254 GB, outvar_size=0.023 GB, temp_buffer_size=0.193 GB, available_memory=17.580 GB)
result[(2, 6, 2, 1), 0] = ModuleProfileResult(compute_cost=0.037, peak_memory=1.134 GB, invar_size=0.790 GB, outvar_size=0.029 GB, temp_buffer_size=0.315 GB, available_memory=17.580 GB)
result[(2, 6, 2, 2), 0] = ModuleProfileResult(compute_cost=0.046, peak_memory=0.730 GB, invar_size=0.507 GB, outvar_size=0.029 GB, temp_buffer_size=0.194 GB, available_memory=17.580 GB)
result[(1, 5, 2, 2), 1] = ModuleProfileResult(compute_cost=0.122, peak_memory=2.152 GB, invar_size=1.038 GB, outvar_size=0.507 GB, temp_buffer_size=1.109 GB, available_memory=17.580 GB)
result[(3, 6, 2, 1), 0] = ModuleProfileResult(compute_cost=0.030, peak_memory=0.948 GB, invar_size=0.636 GB, outvar_size=0.023 GB, temp_buffer_size=0.289 GB, available_memory=17.580 GB)
result[(2, 5, 2, 2), 1] = ModuleProfileResult(compute_cost=0.098, peak_memory=1.953 GB, invar_size=0.838 GB, outvar_size=0.410 GB, temp_buffer_size=1.109 GB, available_memory=17.580 GB)
result[(1, 5, 2, 1), 1] = ModuleProfileResult(compute_cost=0.196, peak_memory=2.899 GB, invar_size=1.603 GB, outvar_size=0.790 GB, temp_buffer_size=1.284 GB, available_memory=17.580 GB)
result[(2, 5, 2, 1), 1] = ModuleProfileResult(compute_cost=0.158, peak_memory=2.512 GB, invar_size=1.290 GB, outvar_size=0.636 GB, temp_buffer_size=1.211 GB, available_memory=17.580 GB)
result[(4, 7, 2, 0), 0] = ModuleProfileResult(compute_cost=0.014, peak_memory=1.158 GB, invar_size=0.946 GB, outvar_size=0.018 GB, temp_buffer_size=0.193 GB, available_memory=17.580 GB)
result[(3, 6, 2, 2), 0] = ModuleProfileResult(compute_cost=0.037, peak_memory=0.627 GB, invar_size=0.410 GB, outvar_size=0.023 GB, temp_buffer_size=0.194 GB, available_memory=17.580 GB)
result[(4, 7, 2, 1), 0] = ModuleProfileResult(compute_cost=0.023, peak_memory=0.762 GB, invar_size=0.482 GB, outvar_size=0.018 GB, temp_buffer_size=0.262 GB, available_memory=17.580 GB)
result[(3, 6, 2, 0), 1] = ModuleProfileResult(compute_cost=0.119, peak_memory=3.780 GB, invar_size=2.526 GB, outvar_size=1.254 GB, temp_buffer_size=1.248 GB, available_memory=17.580 GB)
result[(2, 6, 2, 0), 1] = ModuleProfileResult(compute_cost=0.148, peak_memory=4.709 GB, invar_size=3.147 GB, outvar_size=1.562 GB, temp_buffer_size=1.556 GB, available_memory=17.580 GB)
result[(2, 6, 2, 2), 1] = ModuleProfileResult(compute_cost=0.122, peak_memory=2.152 GB, invar_size=1.038 GB, outvar_size=0.507 GB, temp_buffer_size=1.109 GB, available_memory=17.580 GB)
result[(4, 7, 2, 2), 0] = ModuleProfileResult(compute_cost=0.028, peak_memory=0.525 GB, invar_size=0.314 GB, outvar_size=0.018 GB, temp_buffer_size=0.193 GB, available_memory=17.580 GB)
result[(2, 6, 2, 1), 1] = ModuleProfileResult(compute_cost=0.197, peak_memory=2.902 GB, invar_size=1.603 GB, outvar_size=0.790 GB, temp_buffer_size=1.287 GB, available_memory=17.580 GB)
result[(3, 6, 2, 1), 1] = ModuleProfileResult(compute_cost=0.158, peak_memory=2.562 GB, invar_size=1.290 GB, outvar_size=0.636 GB, temp_buffer_size=1.261 GB, available_memory=17.580 GB)
result[(3, 6, 2, 2), 1] = ModuleProfileResult(compute_cost=0.098, peak_memory=1.953 GB, invar_size=0.838 GB, outvar_size=0.410 GB, temp_buffer_size=1.109 GB, available_memory=17.580 GB)
result[(4, 7, 2, 0), 1] = ModuleProfileResult(compute_cost=0.129, peak_memory=4.062 GB, invar_size=2.612 GB, outvar_size=1.300 GB, temp_buffer_size=1.445 GB, available_memory=17.580 GB)
result[(4, 7, 2, 2), 1] = ModuleProfileResult(compute_cost=0.128, peak_memory=2.324 GB, invar_size=0.856 GB, outvar_size=0.422 GB, temp_buffer_size=1.462 GB, available_memory=17.580 GB)
result[(4, 7, 2, 1), 1] = ModuleProfileResult(compute_cost=0.169, peak_memory=2.820 GB, invar_size=1.324 GB, outvar_size=0.659 GB, temp_buffer_size=1.484 GB, available_memory=17.580 GB)
Profiling for submesh 2 (2, 2) takes 79.98 seconds
--------------------------------------------------
- Profiling for submesh 1 (1, 2):
- Generate all stage infos (Jaxpr -> HLO)
- Compile all stages
- Profile all stages
result[(0, 1, 1, 0), 0] = ModuleProfileResult(compute_cost=0.020, peak_memory=1.172 GB, invar_size=0.645 GB, outvar_size=0.023 GB, temp_buffer_size=0.504 GB, available_memory=17.580 GB)
result[(2, 3, 1, 0), 0] = ModuleProfileResult(compute_cost=0.017, peak_memory=1.038 GB, invar_size=0.627 GB, outvar_size=0.023 GB, temp_buffer_size=0.387 GB, available_memory=17.580 GB)
result[(1, 2, 1, 0), 0] = ModuleProfileResult(compute_cost=0.017, peak_memory=1.038 GB, invar_size=0.627 GB, outvar_size=0.023 GB, temp_buffer_size=0.387 GB, available_memory=17.580 GB)
result[(1, 2, 1, 2), 0] = ModuleProfileResult(compute_cost=0.022, peak_memory=0.756 GB, invar_size=0.346 GB, outvar_size=0.023 GB, temp_buffer_size=0.387 GB, available_memory=17.580 GB)
result[(0, 1, 1, 2), 0] = ModuleProfileResult(compute_cost=0.025, peak_memory=0.891 GB, invar_size=0.364 GB, outvar_size=0.023 GB, temp_buffer_size=0.504 GB, available_memory=17.580 GB)
result[(1, 2, 1, 1), 0] = ModuleProfileResult(compute_cost=0.042, peak_memory=0.765 GB, invar_size=0.331 GB, outvar_size=0.035 GB, temp_buffer_size=0.399 GB, available_memory=17.580 GB)
result[(0, 1, 1, 1), 0] = ModuleProfileResult(compute_cost=0.045, peak_memory=0.862 GB, invar_size=0.323 GB, outvar_size=0.035 GB, temp_buffer_size=0.504 GB, available_memory=17.580 GB)
result[(0, 1, 1, 0), 1] = ModuleProfileResult(compute_cost=0.059, peak_memory=3.578 GB, invar_size=1.314 GB, outvar_size=0.645 GB, temp_buffer_size=2.264 GB, available_memory=17.580 GB)
result[(1, 2, 1, 2), 1] = ModuleProfileResult(compute_cost=0.059, peak_memory=2.651 GB, invar_size=0.703 GB, outvar_size=0.346 GB, temp_buffer_size=1.936 GB, available_memory=17.580 GB)
result[(2, 3, 1, 0), 1] = ModuleProfileResult(compute_cost=0.055, peak_memory=3.213 GB, invar_size=1.266 GB, outvar_size=0.627 GB, temp_buffer_size=1.935 GB, available_memory=17.580 GB)
result[(0, 1, 1, 2), 1] = ModuleProfileResult(compute_cost=0.064, peak_memory=3.015 GB, invar_size=0.751 GB, outvar_size=0.364 GB, temp_buffer_size=2.264 GB, available_memory=17.580 GB)
result[(1, 2, 1, 0), 1] = ModuleProfileResult(compute_cost=0.055, peak_memory=3.213 GB, invar_size=1.266 GB, outvar_size=0.627 GB, temp_buffer_size=1.935 GB, available_memory=17.580 GB)
result[(1, 2, 1, 1), 1] = ModuleProfileResult(compute_cost=0.107, peak_memory=2.943 GB, invar_size=0.686 GB, outvar_size=0.331 GB, temp_buffer_size=2.234 GB, available_memory=17.580 GB)
result[(2, 3, 1, 1), 0] = ModuleProfileResult(compute_cost=0.042, peak_memory=0.765 GB, invar_size=0.331 GB, outvar_size=0.035 GB, temp_buffer_size=0.399 GB, available_memory=17.580 GB)
result[(2, 3, 1, 2), 0] = ModuleProfileResult(compute_cost=0.022, peak_memory=0.756 GB, invar_size=0.346 GB, outvar_size=0.023 GB, temp_buffer_size=0.387 GB, available_memory=17.580 GB)
result[(0, 1, 1, 1), 1] = ModuleProfileResult(compute_cost=0.107, peak_memory=3.147 GB, invar_size=0.692 GB, outvar_size=0.323 GB, temp_buffer_size=2.455 GB, available_memory=17.580 GB)
result[(3, 4, 1, 0), 0] = ModuleProfileResult(compute_cost=0.019, peak_memory=1.055 GB, invar_size=0.645 GB, outvar_size=0.023 GB, temp_buffer_size=0.387 GB, available_memory=17.580 GB)
result[(3, 4, 1, 1), 0] = ModuleProfileResult(compute_cost=0.051, peak_memory=0.786 GB, invar_size=0.340 GB, outvar_size=0.047 GB, temp_buffer_size=0.399 GB, available_memory=17.580 GB)
result[(2, 3, 1, 1), 1] = ModuleProfileResult(compute_cost=0.107, peak_memory=2.943 GB, invar_size=0.686 GB, outvar_size=0.331 GB, temp_buffer_size=2.234 GB, available_memory=17.580 GB)
result[(2, 3, 1, 2), 1] = ModuleProfileResult(compute_cost=0.059, peak_memory=2.651 GB, invar_size=0.703 GB, outvar_size=0.346 GB, temp_buffer_size=1.936 GB, available_memory=17.580 GB)
result[(4, 5, 1, 0), 0] = ModuleProfileResult(compute_cost=0.019, peak_memory=1.055 GB, invar_size=0.645 GB, outvar_size=0.023 GB, temp_buffer_size=0.387 GB, available_memory=17.580 GB)
result[(3, 4, 1, 2), 0] = ModuleProfileResult(compute_cost=0.023, peak_memory=0.774 GB, invar_size=0.363 GB, outvar_size=0.023 GB, temp_buffer_size=0.387 GB, available_memory=17.580 GB)
result[(4, 5, 1, 2), 0] = ModuleProfileResult(compute_cost=0.023, peak_memory=0.774 GB, invar_size=0.363 GB, outvar_size=0.023 GB, temp_buffer_size=0.387 GB, available_memory=17.580 GB)
result[(4, 5, 1, 1), 0] = ModuleProfileResult(compute_cost=0.051, peak_memory=0.786 GB, invar_size=0.340 GB, outvar_size=0.047 GB, temp_buffer_size=0.399 GB, available_memory=17.580 GB)
result[(3, 4, 1, 0), 1] = ModuleProfileResult(compute_cost=0.060, peak_memory=3.518 GB, invar_size=1.301 GB, outvar_size=0.645 GB, temp_buffer_size=2.205 GB, available_memory=17.580 GB)
result[(5, 6, 1, 0), 0] = ModuleProfileResult(compute_cost=0.017, peak_memory=1.038 GB, invar_size=0.627 GB, outvar_size=0.023 GB, temp_buffer_size=0.387 GB, available_memory=17.580 GB)
result[(3, 4, 1, 1), 1] = ModuleProfileResult(compute_cost=0.115, peak_memory=3.053 GB, invar_size=0.703 GB, outvar_size=0.340 GB, temp_buffer_size=2.326 GB, available_memory=17.580 GB)
result[(6, 7, 1, 0), 0] = ModuleProfileResult(compute_cost=0.008, peak_memory=0.718 GB, invar_size=0.319 GB, outvar_size=0.012 GB, temp_buffer_size=0.387 GB, available_memory=17.580 GB)
result[(6, 7, 1, 1), 0] = ModuleProfileResult(compute_cost=0.023, peak_memory=0.600 GB, invar_size=0.177 GB, outvar_size=0.023 GB, temp_buffer_size=0.399 GB, available_memory=17.580 GB)
result[(5, 6, 1, 1), 0] = ModuleProfileResult(compute_cost=0.046, peak_memory=0.777 GB, invar_size=0.331 GB, outvar_size=0.047 GB, temp_buffer_size=0.399 GB, available_memory=17.580 GB)
result[(4, 5, 1, 1), 1] = ModuleProfileResult(compute_cost=0.115, peak_memory=3.217 GB, invar_size=0.703 GB, outvar_size=0.340 GB, temp_buffer_size=2.490 GB, available_memory=17.580 GB)
result[(5, 6, 1, 2), 0] = ModuleProfileResult(compute_cost=0.022, peak_memory=0.756 GB, invar_size=0.346 GB, outvar_size=0.023 GB, temp_buffer_size=0.387 GB, available_memory=17.580 GB)
result[(3, 4, 1, 2), 1] = ModuleProfileResult(compute_cost=0.064, peak_memory=2.979 GB, invar_size=0.750 GB, outvar_size=0.363 GB, temp_buffer_size=2.217 GB, available_memory=17.580 GB)
result[(4, 5, 1, 0), 1] = ModuleProfileResult(compute_cost=0.060, peak_memory=3.530 GB, invar_size=1.301 GB, outvar_size=0.645 GB, temp_buffer_size=2.217 GB, available_memory=17.580 GB)
result[(4, 5, 1, 2), 1] = ModuleProfileResult(compute_cost=0.064, peak_memory=2.967 GB, invar_size=0.739 GB, outvar_size=0.363 GB, temp_buffer_size=2.217 GB, available_memory=17.580 GB)
result[(6, 7, 1, 2), 0] = ModuleProfileResult(compute_cost=0.011, peak_memory=0.577 GB, invar_size=0.179 GB, outvar_size=0.012 GB, temp_buffer_size=0.387 GB, available_memory=17.580 GB)
result[(5, 6, 1, 0), 1] = ModuleProfileResult(compute_cost=0.055, peak_memory=3.296 GB, invar_size=1.266 GB, outvar_size=0.627 GB, temp_buffer_size=2.018 GB, available_memory=17.580 GB)
result[(5, 6, 1, 1), 1] = ModuleProfileResult(compute_cost=0.107, peak_memory=3.014 GB, invar_size=0.686 GB, outvar_size=0.331 GB, temp_buffer_size=2.305 GB, available_memory=17.580 GB)
result[(6, 7, 1, 0), 1] = ModuleProfileResult(compute_cost=0.069, peak_memory=4.247 GB, invar_size=1.346 GB, outvar_size=0.673 GB, temp_buffer_size=2.889 GB, available_memory=17.580 GB)
result[(5, 6, 1, 2), 1] = ModuleProfileResult(compute_cost=0.059, peak_memory=2.733 GB, invar_size=0.703 GB, outvar_size=0.346 GB, temp_buffer_size=2.018 GB, available_memory=17.580 GB)
result[(6, 7, 1, 1), 1] = ModuleProfileResult(compute_cost=0.124, peak_memory=3.727 GB, invar_size=0.708 GB, outvar_size=0.354 GB, temp_buffer_size=2.996 GB, available_memory=17.580 GB)
result[(6, 7, 1, 2), 1] = ModuleProfileResult(compute_cost=0.078, peak_memory=3.650 GB, invar_size=0.738 GB, outvar_size=0.369 GB, temp_buffer_size=2.901 GB, available_memory=17.580 GB)
Profiling for submesh 1 (1, 2) takes 33.20 seconds
--------------------------------------------------
- Profiling for submesh 0 (1, 1):
- Generate all stage infos (Jaxpr -> HLO)
- Compile all stages
- Profile all stages
result[(1, 1, 0, 0), 0] = ModuleProfileResult(compute_cost=0.016, peak_memory=1.129 GB, invar_size=0.331 GB, outvar_size=0.023 GB, temp_buffer_size=0.774 GB, available_memory=17.580 GB)
result[(2, 2, 0, 1), 0] = ModuleProfileResult(compute_cost=0.016, peak_memory=1.129 GB, invar_size=0.331 GB, outvar_size=0.023 GB, temp_buffer_size=0.774 GB, available_memory=17.580 GB)
result[(0, 0, 0, 1), 0] = ModuleProfileResult(compute_cost=0.021, peak_memory=1.369 GB, invar_size=0.338 GB, outvar_size=0.023 GB, temp_buffer_size=1.008 GB, available_memory=17.580 GB)
result[(3, 3, 0, 0), 0] = ModuleProfileResult(compute_cost=0.016, peak_memory=1.129 GB, invar_size=0.331 GB, outvar_size=0.023 GB, temp_buffer_size=0.774 GB, available_memory=17.580 GB)
result[(1, 1, 0, 1), 0] = ModuleProfileResult(compute_cost=0.016, peak_memory=1.129 GB, invar_size=0.331 GB, outvar_size=0.023 GB, temp_buffer_size=0.774 GB, available_memory=17.580 GB)
result[(2, 2, 0, 0), 0] = ModuleProfileResult(compute_cost=0.016, peak_memory=1.129 GB, invar_size=0.331 GB, outvar_size=0.023 GB, temp_buffer_size=0.774 GB, available_memory=17.580 GB)
result[(0, 0, 0, 0), 0] = ModuleProfileResult(compute_cost=0.021, peak_memory=1.369 GB, invar_size=0.338 GB, outvar_size=0.023 GB, temp_buffer_size=1.008 GB, available_memory=17.580 GB)
result[(0, 0, 0, 1), 1] = ModuleProfileResult(compute_cost=0.054, peak_memory=5.203 GB, invar_size=0.698 GB, outvar_size=0.337 GB, temp_buffer_size=4.505 GB, available_memory=17.580 GB)
result[(1, 1, 0, 0), 1] = ModuleProfileResult(compute_cost=0.047, peak_memory=4.535 GB, invar_size=0.662 GB, outvar_size=0.331 GB, temp_buffer_size=3.849 GB, available_memory=17.580 GB)
result[(3, 3, 0, 0), 1] = ModuleProfileResult(compute_cost=0.047, peak_memory=4.535 GB, invar_size=0.662 GB, outvar_size=0.331 GB, temp_buffer_size=3.849 GB, available_memory=17.580 GB)
result[(2, 2, 0, 1), 1] = ModuleProfileResult(compute_cost=0.047, peak_memory=4.535 GB, invar_size=0.662 GB, outvar_size=0.331 GB, temp_buffer_size=3.849 GB, available_memory=17.580 GB)
result[(2, 2, 0, 0), 1] = ModuleProfileResult(compute_cost=0.047, peak_memory=4.535 GB, invar_size=0.662 GB, outvar_size=0.331 GB, temp_buffer_size=3.849 GB, available_memory=17.580 GB)
result[(1, 1, 0, 1), 1] = ModuleProfileResult(compute_cost=0.047, peak_memory=4.535 GB, invar_size=0.662 GB, outvar_size=0.331 GB, temp_buffer_size=3.849 GB, available_memory=17.580 GB)
result[(3, 3, 0, 1), 0] = ModuleProfileResult(compute_cost=0.016, peak_memory=1.129 GB, invar_size=0.331 GB, outvar_size=0.023 GB, temp_buffer_size=0.774 GB, available_memory=17.580 GB)
result[(0, 0, 0, 0), 1] = ModuleProfileResult(compute_cost=0.054, peak_memory=5.203 GB, invar_size=0.698 GB, outvar_size=0.337 GB, temp_buffer_size=4.505 GB, available_memory=17.580 GB)
result[(7, 7, 0, 0), 0] = ModuleProfileResult(compute_cost=0.000, peak_memory=0.000 GB, invar_size=0.000 GB, outvar_size=0.000 GB, temp_buffer_size=0.000 GB, available_memory=17.580 GB)
result[(4, 4, 0, 0), 0] = ModuleProfileResult(compute_cost=0.020, peak_memory=1.146 GB, invar_size=0.349 GB, outvar_size=0.023 GB, temp_buffer_size=0.774 GB, available_memory=17.580 GB)
result[(7, 7, 0, 1), 0] = ModuleProfileResult(compute_cost=0.000, peak_memory=0.000 GB, invar_size=0.000 GB, outvar_size=0.000 GB, temp_buffer_size=0.000 GB, available_memory=17.580 GB)
result[(4, 4, 0, 1), 0] = ModuleProfileResult(compute_cost=0.020, peak_memory=1.146 GB, invar_size=0.349 GB, outvar_size=0.023 GB, temp_buffer_size=0.774 GB, available_memory=17.580 GB)
result[(5, 5, 0, 0), 0] = ModuleProfileResult(compute_cost=0.016, peak_memory=1.129 GB, invar_size=0.331 GB, outvar_size=0.023 GB, temp_buffer_size=0.774 GB, available_memory=17.580 GB)
result[(5, 5, 0, 1), 0] = ModuleProfileResult(compute_cost=0.016, peak_memory=1.129 GB, invar_size=0.331 GB, outvar_size=0.023 GB, temp_buffer_size=0.774 GB, available_memory=17.580 GB)
result[(3, 3, 0, 1), 1] = ModuleProfileResult(compute_cost=0.047, peak_memory=4.535 GB, invar_size=0.662 GB, outvar_size=0.331 GB, temp_buffer_size=3.849 GB, available_memory=17.580 GB)
result[(6, 6, 0, 0), 0] = ModuleProfileResult(compute_cost=0.016, peak_memory=1.129 GB, invar_size=0.331 GB, outvar_size=0.023 GB, temp_buffer_size=0.774 GB, available_memory=17.580 GB)
result[(6, 6, 0, 1), 0] = ModuleProfileResult(compute_cost=0.016, peak_memory=1.129 GB, invar_size=0.331 GB, outvar_size=0.023 GB, temp_buffer_size=0.774 GB, available_memory=17.580 GB)
result[(4, 4, 0, 0), 1] = ModuleProfileResult(compute_cost=0.056, peak_memory=5.124 GB, invar_size=0.697 GB, outvar_size=0.349 GB, temp_buffer_size=4.403 GB, available_memory=17.580 GB)
result[(4, 4, 0, 1), 1] = ModuleProfileResult(compute_cost=0.056, peak_memory=5.124 GB, invar_size=0.697 GB, outvar_size=0.349 GB, temp_buffer_size=4.403 GB, available_memory=17.580 GB)
result[(5, 5, 0, 0), 1] = ModuleProfileResult(compute_cost=0.047, peak_memory=4.745 GB, invar_size=0.662 GB, outvar_size=0.331 GB, temp_buffer_size=4.059 GB, available_memory=17.580 GB)
result[(6, 6, 0, 0), 1] = ModuleProfileResult(compute_cost=0.047, peak_memory=4.699 GB, invar_size=0.662 GB, outvar_size=0.331 GB, temp_buffer_size=4.013 GB, available_memory=17.580 GB)
result[(5, 5, 0, 1), 1] = ModuleProfileResult(compute_cost=0.047, peak_memory=4.745 GB, invar_size=0.662 GB, outvar_size=0.331 GB, temp_buffer_size=4.059 GB, available_memory=17.580 GB)
result[(6, 6, 0, 1), 1] = ModuleProfileResult(compute_cost=0.047, peak_memory=4.699 GB, invar_size=0.662 GB, outvar_size=0.331 GB, temp_buffer_size=4.013 GB, available_memory=17.580 GB)
result[(7, 7, 0, 0), 1] = ModuleProfileResult(compute_cost=0.073, peak_memory=6.782 GB, invar_size=0.731 GB, outvar_size=0.377 GB, temp_buffer_size=6.028 GB, available_memory=17.580 GB)
result[(7, 7, 0, 1), 1] = ModuleProfileResult(compute_cost=0.073, peak_memory=6.782 GB, invar_size=0.731 GB, outvar_size=0.377 GB, temp_buffer_size=6.028 GB, available_memory=17.580 GB)
Profiling for submesh 0 (1, 1) takes 15.24 seconds
--------------------------------------------------
Profile result saved to: profile-results-2023-11-18-16-58-24.npy
----------------------------------------------------------------------
Result forward_stage_layer_ids: [[0, 1], [2, 3], [4, 5], [6, 7]]
Result mesh_shapes: [(1, 2), (1, 2), (1, 2), (1, 2)]
Result logical_mesh_shapes: [(2, 1), (2, 1), (2, 1), (2, 1)]
Result autosharding_option_dicts: [{'force_batch_dim_to_mesh_dim': 0}, {'force_batch_dim_to_mesh_dim': 0}, {'force_batch_dim_to_mesh_dim': 0}, {'force_batch_dim_to_mesh_dim': 0}]
 - Compile (driver): 255.35 s
compilation time breakdown: {'stage-construction': '212.64', 'stage-construction-dp': '1.13', 'stage-construction-compilation': '110.49', 'stage-construction-profiling': '48.12'}
 - Compile (worker): 7.58 s
[I] Training process warmup (2 rounds) with dummy input batch...
    - Warmup iteration: 1/2
    - Warmup iteration: 2/2
[I] Ready to perform training process.
[I] Benchmark the training process with entire dataset and profile with driver overhead...
    - Iteration 1 / 5 is performed...
    - Iteration 2 / 5 is performed...
    - Iteration 3 / 5 is performed...
    - Iteration 4 / 5 is performed...
 - Benchmark: 38.26 s

[10.379854917526245, 4.054430961608887, 4.076250076293945, 4.2172276973724365, 4.149061441421509, 4.187215805053711, 3.947357177734375]


[I] Performance metrics:
 - Iteration count: 5.
 - Total e2e training time : 22.158 s.
 - Average e2e iteration time: 4.432000160217285 s.
 - Total local training time: 20.577001571655273 s.
 - Average local iteration time: 4.115000247955322 s.
 - Max allocated memory among devices: 5.262 GB.
 - Compilation times:  {'stage-construction': 212.64047503471375, 'stage-construction-dp': 1.1311252117156982, 'stage-construction-compilation': 110.49210381507874, 'stage-construction-profiling': 48.11517143249512}
 - Metadata:  []
 - Is need save result:  True

[TMP] Current profiling results of key `4_a10_4_n_2_d`: 4.11542272567749
[TMP] Updated profiling results stored in `./jaxpr/prof_log/optimal/moe_1.3B_256.pkl`...

------------------------------------------------------------------
- (2/3) Profiling moe_1.3B with batch size: 512...
------------------------------------------------------------------
[TMP] Existed profiling results in `./jaxpr/prof_log/optimal/moe_1.3B_512.pkl`, updating/rewriting it...
[I] Ray Cluster & Alpa backend initialization is completed.
[I] Device Info:
    - Devices num per node: 2
    - Nodes num: 4
[I] Loading flax model....
[I] Model 'moe' loads sucessfully. Model Info: 

FlaxMoEForLMModule(
    # attributes
    config = <model.moe_model.MoEConfig object at 0x7f05d7459cd0>
    dtype = float16
    bias_init = zeros
) 

[I] Manually constructing dummy batch...
[I] Initialize training state...
[I] Training state initialization is completed.
[I] Constructing Alpa parallelized train step func...
[I] Alpa parallelized train step func construction is completed.
-------------------- Automatic stage clustering --------------------
submesh_choices: ((1, 1), (1, 2), (2, 2), (4, 2))
- Profiling for submesh 3 (4, 2):
- Generate all stage infos (Jaxpr -> HLO)
- Compile all stages
- Profile all stages
result[(0, 7, 3, 0), 0] = ModuleProfileResult(compute_cost=0.033, peak_memory=2.494 GB, invar_size=2.201 GB, outvar_size=0.041 GB, temp_buffer_size=0.252 GB, available_memory=17.402 GB)
result[(0, 7, 3, 1), 0] = ModuleProfileResult(compute_cost=0.054, peak_memory=1.531 GB, invar_size=1.101 GB, outvar_size=0.041 GB, temp_buffer_size=0.389 GB, available_memory=17.402 GB)
result[(0, 7, 3, 2), 0] = ModuleProfileResult(compute_cost=0.071, peak_memory=0.771 GB, invar_size=0.478 GB, outvar_size=0.041 GB, temp_buffer_size=0.252 GB, available_memory=17.402 GB)
result[(0, 7, 3, 0), 1] = ModuleProfileResult(compute_cost=0.275, peak_memory=7.705 GB, invar_size=5.150 GB, outvar_size=2.554 GB, temp_buffer_size=2.555 GB, available_memory=17.402 GB)
result[(0, 7, 3, 1), 1] = ModuleProfileResult(compute_cost=0.350, peak_memory=4.284 GB, invar_size=2.596 GB, outvar_size=1.277 GB, temp_buffer_size=1.688 GB, available_memory=17.402 GB)
result[(0, 7, 3, 2), 1] = ModuleProfileResult(compute_cost=0.221, peak_memory=2.663 GB, invar_size=1.213 GB, outvar_size=0.586 GB, temp_buffer_size=1.450 GB, available_memory=17.402 GB)
Profiling for submesh 3 (4, 2) takes 83.25 seconds
--------------------------------------------------
- Profiling for submesh 2 (2, 2):
- Generate all stage infos (Jaxpr -> HLO)
- Compile all stages
- Profile all stages
result[(0, 3, 2, 0), 0] = ModuleProfileResult(compute_cost=0.037, peak_memory=1.811 GB, invar_size=1.260 GB, outvar_size=0.047 GB, temp_buffer_size=0.504 GB, available_memory=17.580 GB)
result[(1, 4, 2, 2), 0] = ModuleProfileResult(compute_cost=0.070, peak_memory=0.850 GB, invar_size=0.416 GB, outvar_size=0.047 GB, temp_buffer_size=0.387 GB, available_memory=17.580 GB)
result[(1, 4, 2, 0), 0] = ModuleProfileResult(compute_cost=0.035, peak_memory=1.694 GB, invar_size=1.260 GB, outvar_size=0.047 GB, temp_buffer_size=0.387 GB, available_memory=17.580 GB)
result[(0, 3, 2, 2), 0] = ModuleProfileResult(compute_cost=0.071, peak_memory=0.967 GB, invar_size=0.417 GB, outvar_size=0.047 GB, temp_buffer_size=0.504 GB, available_memory=17.580 GB)
result[(1, 4, 2, 1), 0] = ModuleProfileResult(compute_cost=0.050, peak_memory=1.168 GB, invar_size=0.652 GB, outvar_size=0.047 GB, temp_buffer_size=0.469 GB, available_memory=17.580 GB)
result[(0, 3, 2, 1), 0] = ModuleProfileResult(compute_cost=0.054, peak_memory=1.209 GB, invar_size=0.635 GB, outvar_size=0.047 GB, temp_buffer_size=0.527 GB, available_memory=17.580 GB)
result[(1, 5, 2, 0), 0] = ModuleProfileResult(compute_cost=0.044, peak_memory=2.013 GB, invar_size=1.568 GB, outvar_size=0.059 GB, temp_buffer_size=0.387 GB, available_memory=17.580 GB)
result[(0, 3, 2, 0), 1] = ModuleProfileResult(compute_cost=0.169, peak_memory=4.832 GB, invar_size=2.568 GB, outvar_size=1.260 GB, temp_buffer_size=2.264 GB, available_memory=17.580 GB)
result[(1, 4, 2, 0), 1] = ModuleProfileResult(compute_cost=0.168, peak_memory=4.772 GB, invar_size=2.555 GB, outvar_size=1.260 GB, temp_buffer_size=2.205 GB, available_memory=17.580 GB)
result[(2, 5, 2, 0), 0] = ModuleProfileResult(compute_cost=0.035, peak_memory=1.694 GB, invar_size=1.260 GB, outvar_size=0.047 GB, temp_buffer_size=0.387 GB, available_memory=17.580 GB)
result[(0, 3, 2, 2), 1] = ModuleProfileResult(compute_cost=0.179, peak_memory=3.144 GB, invar_size=0.880 GB, outvar_size=0.417 GB, temp_buffer_size=2.264 GB, available_memory=17.580 GB)
result[(1, 4, 2, 2), 1] = ModuleProfileResult(compute_cost=0.179, peak_memory=3.132 GB, invar_size=0.903 GB, outvar_size=0.416 GB, temp_buffer_size=2.217 GB, available_memory=17.580 GB)
result[(1, 5, 2, 1), 0] = ModuleProfileResult(compute_cost=0.062, peak_memory=1.359 GB, invar_size=0.807 GB, outvar_size=0.059 GB, temp_buffer_size=0.493 GB, available_memory=17.580 GB)
result[(0, 3, 2, 1), 1] = ModuleProfileResult(compute_cost=0.228, peak_memory=3.974 GB, invar_size=1.316 GB, outvar_size=0.635 GB, temp_buffer_size=2.658 GB, available_memory=17.580 GB)
result[(1, 5, 2, 2), 0] = ModuleProfileResult(compute_cost=0.087, peak_memory=0.959 GB, invar_size=0.513 GB, outvar_size=0.059 GB, temp_buffer_size=0.387 GB, available_memory=17.580 GB)
result[(2, 5, 2, 1), 0] = ModuleProfileResult(compute_cost=0.050, peak_memory=1.168 GB, invar_size=0.652 GB, outvar_size=0.047 GB, temp_buffer_size=0.469 GB, available_memory=17.580 GB)
result[(1, 4, 2, 1), 1] = ModuleProfileResult(compute_cost=0.240, peak_memory=3.658 GB, invar_size=1.339 GB, outvar_size=0.640 GB, temp_buffer_size=2.307 GB, available_memory=17.580 GB)
result[(1, 5, 2, 0), 1] = ModuleProfileResult(compute_cost=0.209, peak_memory=5.411 GB, invar_size=3.182 GB, outvar_size=1.568 GB, temp_buffer_size=2.217 GB, available_memory=17.580 GB)
result[(2, 5, 2, 2), 0] = ModuleProfileResult(compute_cost=0.070, peak_memory=0.850 GB, invar_size=0.416 GB, outvar_size=0.047 GB, temp_buffer_size=0.387 GB, available_memory=17.580 GB)
result[(2, 5, 2, 0), 1] = ModuleProfileResult(compute_cost=0.168, peak_memory=4.784 GB, invar_size=2.555 GB, outvar_size=1.260 GB, temp_buffer_size=2.217 GB, available_memory=17.580 GB)
result[(3, 6, 2, 0), 0] = ModuleProfileResult(compute_cost=0.035, peak_memory=1.694 GB, invar_size=1.260 GB, outvar_size=0.047 GB, temp_buffer_size=0.387 GB, available_memory=17.580 GB)
result[(2, 6, 2, 0), 0] = ModuleProfileResult(compute_cost=0.044, peak_memory=2.013 GB, invar_size=1.568 GB, outvar_size=0.059 GB, temp_buffer_size=0.387 GB, available_memory=17.580 GB)
result[(2, 6, 2, 1), 0] = ModuleProfileResult(compute_cost=0.062, peak_memory=1.359 GB, invar_size=0.807 GB, outvar_size=0.059 GB, temp_buffer_size=0.493 GB, available_memory=17.580 GB)
result[(2, 6, 2, 2), 0] = ModuleProfileResult(compute_cost=0.087, peak_memory=0.959 GB, invar_size=0.513 GB, outvar_size=0.059 GB, temp_buffer_size=0.387 GB, available_memory=17.580 GB)
result[(1, 5, 2, 2), 1] = ModuleProfileResult(compute_cost=0.222, peak_memory=3.302 GB, invar_size=1.073 GB, outvar_size=0.513 GB, temp_buffer_size=2.217 GB, available_memory=17.580 GB)
result[(1, 5, 2, 1), 1] = ModuleProfileResult(compute_cost=0.298, peak_memory=4.201 GB, invar_size=1.661 GB, outvar_size=0.795 GB, temp_buffer_size=2.529 GB, available_memory=17.580 GB)
result[(3, 6, 2, 1), 0] = ModuleProfileResult(compute_cost=0.050, peak_memory=1.168 GB, invar_size=0.652 GB, outvar_size=0.047 GB, temp_buffer_size=0.469 GB, available_memory=17.580 GB)
result[(2, 5, 2, 1), 1] = ModuleProfileResult(compute_cost=0.241, peak_memory=3.739 GB, invar_size=1.339 GB, outvar_size=0.640 GB, temp_buffer_size=2.388 GB, available_memory=17.580 GB)
result[(2, 5, 2, 2), 1] = ModuleProfileResult(compute_cost=0.179, peak_memory=3.097 GB, invar_size=0.868 GB, outvar_size=0.416 GB, temp_buffer_size=2.217 GB, available_memory=17.580 GB)
result[(4, 7, 2, 0), 0] = ModuleProfileResult(compute_cost=0.027, peak_memory=1.375 GB, invar_size=0.952 GB, outvar_size=0.035 GB, temp_buffer_size=0.387 GB, available_memory=17.580 GB)
result[(3, 6, 2, 2), 0] = ModuleProfileResult(compute_cost=0.070, peak_memory=0.850 GB, invar_size=0.416 GB, outvar_size=0.047 GB, temp_buffer_size=0.387 GB, available_memory=17.580 GB)
result[(4, 7, 2, 1), 0] = ModuleProfileResult(compute_cost=0.038, peak_memory=0.979 GB, invar_size=0.497 GB, outvar_size=0.035 GB, temp_buffer_size=0.447 GB, available_memory=17.580 GB)
result[(3, 6, 2, 0), 1] = ModuleProfileResult(compute_cost=0.168, peak_memory=4.784 GB, invar_size=2.555 GB, outvar_size=1.260 GB, temp_buffer_size=2.217 GB, available_memory=17.580 GB)
result[(2, 6, 2, 0), 1] = ModuleProfileResult(compute_cost=0.209, peak_memory=5.411 GB, invar_size=3.182 GB, outvar_size=1.568 GB, temp_buffer_size=2.217 GB, available_memory=17.580 GB)
result[(4, 7, 2, 2), 0] = ModuleProfileResult(compute_cost=0.053, peak_memory=0.742 GB, invar_size=0.320 GB, outvar_size=0.035 GB, temp_buffer_size=0.387 GB, available_memory=17.580 GB)
result[(2, 6, 2, 2), 1] = ModuleProfileResult(compute_cost=0.222, peak_memory=3.302 GB, invar_size=1.073 GB, outvar_size=0.513 GB, temp_buffer_size=2.217 GB, available_memory=17.580 GB)
result[(2, 6, 2, 1), 1] = ModuleProfileResult(compute_cost=0.300, peak_memory=4.222 GB, invar_size=1.661 GB, outvar_size=0.795 GB, temp_buffer_size=2.549 GB, available_memory=17.580 GB)
result[(3, 6, 2, 2), 1] = ModuleProfileResult(compute_cost=0.179, peak_memory=3.097 GB, invar_size=0.868 GB, outvar_size=0.416 GB, temp_buffer_size=2.217 GB, available_memory=17.580 GB)
result[(3, 6, 2, 1), 1] = ModuleProfileResult(compute_cost=0.242, peak_memory=3.759 GB, invar_size=1.339 GB, outvar_size=0.640 GB, temp_buffer_size=2.408 GB, available_memory=17.580 GB)
result[(4, 7, 2, 0), 1] = ModuleProfileResult(compute_cost=0.184, peak_memory=5.536 GB, invar_size=2.635 GB, outvar_size=1.306 GB, temp_buffer_size=2.889 GB, available_memory=17.580 GB)
result[(4, 7, 2, 2), 1] = ModuleProfileResult(compute_cost=0.195, peak_memory=3.848 GB, invar_size=0.948 GB, outvar_size=0.462 GB, temp_buffer_size=2.889 GB, available_memory=17.580 GB)
result[(4, 7, 2, 1), 1] = ModuleProfileResult(compute_cost=0.262, peak_memory=4.337 GB, invar_size=1.362 GB, outvar_size=0.663 GB, temp_buffer_size=2.963 GB, available_memory=17.580 GB)
Profiling for submesh 2 (2, 2) takes 78.85 seconds
--------------------------------------------------
- Profiling for submesh 1 (1, 2):
- Generate all stage infos (Jaxpr -> HLO)
- Compile all stages
- Profile all stages
result[(0, 1, 1, 0), 0] = ModuleProfileResult(compute_cost=0.037, peak_memory=1.700 GB, invar_size=0.645 GB, outvar_size=0.047 GB, temp_buffer_size=1.008 GB, available_memory=17.580 GB)
result[(2, 3, 1, 0), 0] = ModuleProfileResult(compute_cost=0.032, peak_memory=1.460 GB, invar_size=0.639 GB, outvar_size=0.047 GB, temp_buffer_size=0.774 GB, available_memory=17.580 GB)
result[(1, 2, 1, 2), 0] = ModuleProfileResult(compute_cost=0.041, peak_memory=1.178 GB, invar_size=0.358 GB, outvar_size=0.047 GB, temp_buffer_size=0.774 GB, available_memory=17.580 GB)
result[(1, 2, 1, 0), 0] = ModuleProfileResult(compute_cost=0.032, peak_memory=1.460 GB, invar_size=0.639 GB, outvar_size=0.047 GB, temp_buffer_size=0.774 GB, available_memory=17.580 GB)
result[(0, 1, 1, 2), 0] = ModuleProfileResult(compute_cost=0.047, peak_memory=1.419 GB, invar_size=0.364 GB, outvar_size=0.047 GB, temp_buffer_size=1.008 GB, available_memory=17.580 GB)
result[(1, 2, 1, 1), 0] = ModuleProfileResult(compute_cost=0.082, peak_memory=1.223 GB, invar_size=0.355 GB, outvar_size=0.070 GB, temp_buffer_size=0.798 GB, available_memory=17.580 GB)
result[(0, 1, 1, 1), 0] = ModuleProfileResult(compute_cost=0.087, peak_memory=1.401 GB, invar_size=0.323 GB, outvar_size=0.070 GB, temp_buffer_size=1.008 GB, available_memory=17.580 GB)
result[(0, 1, 1, 0), 1] = ModuleProfileResult(compute_cost=0.107, peak_memory=5.865 GB, invar_size=1.337 GB, outvar_size=0.645 GB, temp_buffer_size=4.528 GB, available_memory=17.580 GB)
result[(2, 3, 1, 0), 1] = ModuleProfileResult(compute_cost=0.099, peak_memory=5.195 GB, invar_size=1.301 GB, outvar_size=0.639 GB, temp_buffer_size=3.870 GB, available_memory=17.580 GB)
result[(1, 2, 1, 2), 1] = ModuleProfileResult(compute_cost=0.113, peak_memory=4.634 GB, invar_size=0.739 GB, outvar_size=0.358 GB, temp_buffer_size=3.872 GB, available_memory=17.580 GB)
result[(1, 2, 1, 1), 1] = ModuleProfileResult(compute_cost=0.208, peak_memory=5.269 GB, invar_size=0.756 GB, outvar_size=0.355 GB, temp_buffer_size=4.466 GB, available_memory=17.580 GB)
result[(0, 1, 1, 1), 1] = ModuleProfileResult(compute_cost=0.208, peak_memory=5.648 GB, invar_size=0.739 GB, outvar_size=0.323 GB, temp_buffer_size=4.909 GB, available_memory=17.580 GB)
result[(2, 3, 1, 1), 0] = ModuleProfileResult(compute_cost=0.082, peak_memory=1.223 GB, invar_size=0.355 GB, outvar_size=0.070 GB, temp_buffer_size=0.798 GB, available_memory=17.580 GB)
result[(1, 2, 1, 0), 1] = ModuleProfileResult(compute_cost=0.099, peak_memory=5.195 GB, invar_size=1.301 GB, outvar_size=0.639 GB, temp_buffer_size=3.870 GB, available_memory=17.580 GB)
result[(2, 3, 1, 2), 0] = ModuleProfileResult(compute_cost=0.041, peak_memory=1.178 GB, invar_size=0.358 GB, outvar_size=0.047 GB, temp_buffer_size=0.774 GB, available_memory=17.580 GB)
result[(0, 1, 1, 2), 1] = ModuleProfileResult(compute_cost=0.120, peak_memory=5.303 GB, invar_size=0.775 GB, outvar_size=0.364 GB, temp_buffer_size=4.528 GB, available_memory=17.580 GB)
result[(3, 4, 1, 0), 0] = ModuleProfileResult(compute_cost=0.035, peak_memory=1.477 GB, invar_size=0.656 GB, outvar_size=0.047 GB, temp_buffer_size=0.774 GB, available_memory=17.580 GB)
result[(3, 4, 1, 1), 0] = ModuleProfileResult(compute_cost=0.099, peak_memory=1.255 GB, invar_size=0.363 GB, outvar_size=0.094 GB, temp_buffer_size=0.798 GB, available_memory=17.580 GB)
result[(2, 3, 1, 1), 1] = ModuleProfileResult(compute_cost=0.208, peak_memory=5.269 GB, invar_size=0.756 GB, outvar_size=0.355 GB, temp_buffer_size=4.466 GB, available_memory=17.580 GB)
result[(4, 5, 1, 0), 0] = ModuleProfileResult(compute_cost=0.035, peak_memory=1.477 GB, invar_size=0.656 GB, outvar_size=0.047 GB, temp_buffer_size=0.774 GB, available_memory=17.580 GB)
result[(2, 3, 1, 2), 1] = ModuleProfileResult(compute_cost=0.113, peak_memory=4.634 GB, invar_size=0.739 GB, outvar_size=0.358 GB, temp_buffer_size=3.872 GB, available_memory=17.580 GB)
result[(3, 4, 1, 2), 0] = ModuleProfileResult(compute_cost=0.045, peak_memory=1.196 GB, invar_size=0.375 GB, outvar_size=0.047 GB, temp_buffer_size=0.774 GB, available_memory=17.580 GB)
result[(4, 5, 1, 1), 0] = ModuleProfileResult(compute_cost=0.099, peak_memory=1.255 GB, invar_size=0.363 GB, outvar_size=0.094 GB, temp_buffer_size=0.798 GB, available_memory=17.580 GB)
result[(4, 5, 1, 2), 0] = ModuleProfileResult(compute_cost=0.045, peak_memory=1.196 GB, invar_size=0.375 GB, outvar_size=0.047 GB, temp_buffer_size=0.774 GB, available_memory=17.580 GB)
result[(3, 4, 1, 0), 1] = ModuleProfileResult(compute_cost=0.108, peak_memory=5.770 GB, invar_size=1.336 GB, outvar_size=0.656 GB, temp_buffer_size=4.411 GB, available_memory=17.580 GB)
result[(5, 6, 1, 0), 0] = ModuleProfileResult(compute_cost=0.032, peak_memory=1.460 GB, invar_size=0.639 GB, outvar_size=0.047 GB, temp_buffer_size=0.774 GB, available_memory=17.580 GB)
result[(3, 4, 1, 1), 1] = ModuleProfileResult(compute_cost=0.224, peak_memory=5.471 GB, invar_size=0.774 GB, outvar_size=0.363 GB, temp_buffer_size=4.651 GB, available_memory=17.580 GB)
result[(6, 7, 1, 0), 0] = ModuleProfileResult(compute_cost=0.016, peak_memory=1.129 GB, invar_size=0.331 GB, outvar_size=0.023 GB, temp_buffer_size=0.774 GB, available_memory=17.580 GB)
result[(5, 6, 1, 1), 0] = ModuleProfileResult(compute_cost=0.089, peak_memory=1.246 GB, invar_size=0.355 GB, outvar_size=0.094 GB, temp_buffer_size=0.798 GB, available_memory=17.580 GB)
result[(6, 7, 1, 1), 0] = ModuleProfileResult(compute_cost=0.044, peak_memory=1.046 GB, invar_size=0.201 GB, outvar_size=0.047 GB, temp_buffer_size=0.798 GB, available_memory=17.580 GB)
result[(3, 4, 1, 2), 1] = ModuleProfileResult(compute_cost=0.122, peak_memory=5.255 GB, invar_size=0.797 GB, outvar_size=0.375 GB, temp_buffer_size=4.434 GB, available_memory=17.580 GB)
result[(4, 5, 1, 1), 1] = ModuleProfileResult(compute_cost=0.224, peak_memory=5.800 GB, invar_size=0.774 GB, outvar_size=0.363 GB, temp_buffer_size=4.979 GB, available_memory=17.580 GB)
result[(5, 6, 1, 2), 0] = ModuleProfileResult(compute_cost=0.041, peak_memory=1.178 GB, invar_size=0.358 GB, outvar_size=0.047 GB, temp_buffer_size=0.774 GB, available_memory=17.580 GB)
result[(4, 5, 1, 0), 1] = ModuleProfileResult(compute_cost=0.108, peak_memory=5.794 GB, invar_size=1.336 GB, outvar_size=0.656 GB, temp_buffer_size=4.434 GB, available_memory=17.580 GB)
result[(4, 5, 1, 2), 1] = ModuleProfileResult(compute_cost=0.122, peak_memory=5.231 GB, invar_size=0.774 GB, outvar_size=0.375 GB, temp_buffer_size=4.434 GB, available_memory=17.580 GB)
result[(6, 7, 1, 2), 0] = ModuleProfileResult(compute_cost=0.021, peak_memory=0.988 GB, invar_size=0.191 GB, outvar_size=0.023 GB, temp_buffer_size=0.774 GB, available_memory=17.580 GB)
result[(5, 6, 1, 0), 1] = ModuleProfileResult(compute_cost=0.099, peak_memory=5.360 GB, invar_size=1.301 GB, outvar_size=0.639 GB, temp_buffer_size=4.036 GB, available_memory=17.580 GB)
result[(5, 6, 1, 1), 1] = ModuleProfileResult(compute_cost=0.208, peak_memory=5.410 GB, invar_size=0.756 GB, outvar_size=0.355 GB, temp_buffer_size=4.607 GB, available_memory=17.580 GB)
result[(6, 7, 1, 0), 1] = ModuleProfileResult(compute_cost=0.126, peak_memory=7.171 GB, invar_size=1.369 GB, outvar_size=0.685 GB, temp_buffer_size=5.778 GB, available_memory=17.580 GB)
result[(5, 6, 1, 2), 1] = ModuleProfileResult(compute_cost=0.113, peak_memory=4.798 GB, invar_size=0.739 GB, outvar_size=0.358 GB, temp_buffer_size=4.036 GB, available_memory=17.580 GB)
result[(6, 7, 1, 1), 1] = ModuleProfileResult(compute_cost=0.241, peak_memory=6.793 GB, invar_size=0.755 GB, outvar_size=0.377 GB, temp_buffer_size=5.991 GB, available_memory=17.580 GB)
result[(6, 7, 1, 2), 1] = ModuleProfileResult(compute_cost=0.139, peak_memory=6.577 GB, invar_size=0.807 GB, outvar_size=0.403 GB, temp_buffer_size=5.747 GB, available_memory=17.580 GB)
Profiling for submesh 1 (1, 2) takes 33.71 seconds
--------------------------------------------------
- Profiling for submesh 0 (1, 1):
- Generate all stage infos (Jaxpr -> HLO)
- Compile all stages
- Profile all stages
result[(3, 3, 0, 0), 0] = ModuleProfileResult(compute_cost=0.031, peak_memory=1.949 GB, invar_size=0.355 GB, outvar_size=0.047 GB, temp_buffer_size=1.548 GB, available_memory=17.580 GB)
result[(0, 0, 0, 1), 0] = ModuleProfileResult(compute_cost=0.042, peak_memory=2.400 GB, invar_size=0.338 GB, outvar_size=0.047 GB, temp_buffer_size=2.016 GB, available_memory=17.580 GB)
result[(2, 2, 0, 1), 0] = ModuleProfileResult(compute_cost=0.031, peak_memory=1.949 GB, invar_size=0.355 GB, outvar_size=0.047 GB, temp_buffer_size=1.548 GB, available_memory=17.580 GB)
result[(2, 2, 0, 0), 0] = ModuleProfileResult(compute_cost=0.031, peak_memory=1.949 GB, invar_size=0.355 GB, outvar_size=0.047 GB, temp_buffer_size=1.548 GB, available_memory=17.580 GB)
result[(1, 1, 0, 0), 0] = ModuleProfileResult(compute_cost=0.031, peak_memory=1.949 GB, invar_size=0.355 GB, outvar_size=0.047 GB, temp_buffer_size=1.548 GB, available_memory=17.580 GB)
result[(1, 1, 0, 1), 0] = ModuleProfileResult(compute_cost=0.031, peak_memory=1.949 GB, invar_size=0.355 GB, outvar_size=0.047 GB, temp_buffer_size=1.548 GB, available_memory=17.580 GB)
result[(0, 0, 0, 0), 0] = ModuleProfileResult(compute_cost=0.042, peak_memory=2.400 GB, invar_size=0.338 GB, outvar_size=0.047 GB, temp_buffer_size=2.016 GB, available_memory=17.580 GB)
result[(0, 0, 0, 1), 1] = ModuleProfileResult(compute_cost=0.105, peak_memory=9.732 GB, invar_size=0.722 GB, outvar_size=0.337 GB, temp_buffer_size=9.010 GB, available_memory=17.580 GB)
result[(3, 3, 0, 0), 1] = ModuleProfileResult(compute_cost=0.090, peak_memory=8.453 GB, invar_size=0.709 GB, outvar_size=0.355 GB, temp_buffer_size=7.697 GB, available_memory=17.580 GB)
result[(2, 2, 0, 1), 1] = ModuleProfileResult(compute_cost=0.090, peak_memory=8.453 GB, invar_size=0.709 GB, outvar_size=0.355 GB, temp_buffer_size=7.697 GB, available_memory=17.580 GB)
result[(1, 1, 0, 1), 1] = ModuleProfileResult(compute_cost=0.090, peak_memory=8.453 GB, invar_size=0.709 GB, outvar_size=0.355 GB, temp_buffer_size=7.697 GB, available_memory=17.580 GB)
result[(2, 2, 0, 0), 1] = ModuleProfileResult(compute_cost=0.090, peak_memory=8.453 GB, invar_size=0.709 GB, outvar_size=0.355 GB, temp_buffer_size=7.697 GB, available_memory=17.580 GB)
result[(1, 1, 0, 0), 1] = ModuleProfileResult(compute_cost=0.090, peak_memory=8.453 GB, invar_size=0.709 GB, outvar_size=0.355 GB, temp_buffer_size=7.697 GB, available_memory=17.580 GB)
result[(0, 0, 0, 0), 1] = ModuleProfileResult(compute_cost=0.105, peak_memory=9.732 GB, invar_size=0.722 GB, outvar_size=0.337 GB, temp_buffer_size=9.010 GB, available_memory=17.580 GB)
result[(3, 3, 0, 1), 0] = ModuleProfileResult(compute_cost=0.031, peak_memory=1.949 GB, invar_size=0.355 GB, outvar_size=0.047 GB, temp_buffer_size=1.548 GB, available_memory=17.580 GB)
result[(7, 7, 0, 0), 0] = ModuleProfileResult(compute_cost=0.000, peak_memory=0.000 GB, invar_size=0.000 GB, outvar_size=0.000 GB, temp_buffer_size=0.000 GB, available_memory=17.580 GB)
result[(4, 4, 0, 0), 0] = ModuleProfileResult(compute_cost=0.038, peak_memory=1.967 GB, invar_size=0.372 GB, outvar_size=0.047 GB, temp_buffer_size=1.548 GB, available_memory=17.580 GB)
result[(7, 7, 0, 1), 0] = ModuleProfileResult(compute_cost=0.000, peak_memory=0.000 GB, invar_size=0.000 GB, outvar_size=0.000 GB, temp_buffer_size=0.000 GB, available_memory=17.580 GB)
result[(4, 4, 0, 1), 0] = ModuleProfileResult(compute_cost=0.038, peak_memory=1.967 GB, invar_size=0.372 GB, outvar_size=0.047 GB, temp_buffer_size=1.548 GB, available_memory=17.580 GB)
result[(5, 5, 0, 0), 0] = ModuleProfileResult(compute_cost=0.031, peak_memory=1.949 GB, invar_size=0.355 GB, outvar_size=0.047 GB, temp_buffer_size=1.548 GB, available_memory=17.580 GB)
result[(5, 5, 0, 1), 0] = ModuleProfileResult(compute_cost=0.031, peak_memory=1.949 GB, invar_size=0.355 GB, outvar_size=0.047 GB, temp_buffer_size=1.548 GB, available_memory=17.580 GB)
result[(3, 3, 0, 1), 1] = ModuleProfileResult(compute_cost=0.090, peak_memory=8.453 GB, invar_size=0.709 GB, outvar_size=0.355 GB, temp_buffer_size=7.697 GB, available_memory=17.580 GB)
result[(6, 6, 0, 0), 0] = ModuleProfileResult(compute_cost=0.031, peak_memory=1.949 GB, invar_size=0.355 GB, outvar_size=0.047 GB, temp_buffer_size=1.548 GB, available_memory=17.580 GB)
result[(6, 6, 0, 1), 0] = ModuleProfileResult(compute_cost=0.031, peak_memory=1.949 GB, invar_size=0.355 GB, outvar_size=0.047 GB, temp_buffer_size=1.548 GB, available_memory=17.580 GB)
result[(4, 4, 0, 0), 1] = ModuleProfileResult(compute_cost=0.108, peak_memory=9.597 GB, invar_size=0.744 GB, outvar_size=0.372 GB, temp_buffer_size=8.806 GB, available_memory=17.580 GB)
result[(4, 4, 0, 1), 1] = ModuleProfileResult(compute_cost=0.108, peak_memory=9.597 GB, invar_size=0.744 GB, outvar_size=0.372 GB, temp_buffer_size=8.806 GB, available_memory=17.580 GB)
result[(6, 6, 0, 0), 1] = ModuleProfileResult(compute_cost=0.090, peak_memory=8.781 GB, invar_size=0.709 GB, outvar_size=0.355 GB, temp_buffer_size=8.025 GB, available_memory=17.580 GB)
result[(5, 5, 0, 0), 1] = ModuleProfileResult(compute_cost=0.090, peak_memory=8.875 GB, invar_size=0.709 GB, outvar_size=0.355 GB, temp_buffer_size=8.119 GB, available_memory=17.580 GB)
result[(5, 5, 0, 1), 1] = ModuleProfileResult(compute_cost=0.090, peak_memory=8.875 GB, invar_size=0.709 GB, outvar_size=0.355 GB, temp_buffer_size=8.119 GB, available_memory=17.580 GB)
result[(6, 6, 0, 1), 1] = ModuleProfileResult(compute_cost=0.090, peak_memory=8.781 GB, invar_size=0.709 GB, outvar_size=0.355 GB, temp_buffer_size=8.025 GB, available_memory=17.580 GB)
result[(7, 7, 0, 0), 1] = ModuleProfileResult(compute_cost=0.142, peak_memory=12.857 GB, invar_size=0.754 GB, outvar_size=0.400 GB, temp_buffer_size=12.056 GB, available_memory=17.580 GB)
result[(7, 7, 0, 1), 1] = ModuleProfileResult(compute_cost=0.142, peak_memory=12.857 GB, invar_size=0.754 GB, outvar_size=0.400 GB, temp_buffer_size=12.056 GB, available_memory=17.580 GB)
Profiling for submesh 0 (1, 1) takes 15.31 seconds
--------------------------------------------------
Profile result saved to: profile-results-2023-11-18-17-03-37.npy
----------------------------------------------------------------------
Result forward_stage_layer_ids: [[0, 1], [2, 3], [4, 5], [6, 7]]
Result mesh_shapes: [(1, 2), (1, 2), (1, 2), (1, 2)]
Result logical_mesh_shapes: [(2, 1), (2, 1), (2, 1), (2, 1)]
Result autosharding_option_dicts: [{'force_batch_dim_to_mesh_dim': 0}, {'force_batch_dim_to_mesh_dim': 0}, {'force_batch_dim_to_mesh_dim': 0}, {'force_batch_dim_to_mesh_dim': 0}]
 - Compile (driver): 256.57 s
compilation time breakdown: {'stage-construction': '214.49', 'stage-construction-dp': '1.14', 'stage-construction-compilation': '112.10', 'stage-construction-profiling': '47.69'}
 - Compile (worker): 7.69 s
[I] Training process warmup (2 rounds) with dummy input batch...
    - Warmup iteration: 1/2
    - Warmup iteration: 2/2
[I] Ready to perform training process.
[I] Benchmark the training process with entire dataset and profile with driver overhead...
    - Iteration 1 / 5 is performed...
    - Iteration 2 / 5 is performed...
    - Iteration 3 / 5 is performed...
    - Iteration 4 / 5 is performed...
 - Benchmark: 60.29 s

[13.603015661239624, 6.966668367385864, 7.225783348083496, 7.213683605194092, 7.20501446723938, 7.175284385681152, 7.242536783218384]


[I] Performance metrics:
 - Iteration count: 5.
 - Total e2e training time : 38.13 s.
 - Average e2e iteration time: 7.62600040435791 s.
 - Total local training time: 36.0620002746582 s.
 - Average local iteration time: 7.212000370025635 s.
 - Max allocated memory among devices: 8.539 GB.
 - Compilation times:  {'stage-construction': 214.49355030059814, 'stage-construction-dp': 1.143622636795044, 'stage-construction-compilation': 112.0971245765686, 'stage-construction-profiling': 47.68781876564026}
 - Metadata:  []
 - Is need save result:  True

[TMP] Current profiling results of key `4_a10_4_n_2_d`: 7.212460517883301
[TMP] Updated profiling results stored in `./jaxpr/prof_log/optimal/moe_1.3B_512.pkl`...

------------------------------------------------------------------
- (3/3) Profiling moe_1.3B with batch size: 1024...
------------------------------------------------------------------
[TMP] Existed profiling results in `./jaxpr/prof_log/optimal/moe_1.3B_1024.pkl`, updating/rewriting it...
[I] Ray Cluster & Alpa backend initialization is completed.
[I] Device Info:
    - Devices num per node: 2
    - Nodes num: 4
[I] Loading flax model....
[I] Model 'moe' loads sucessfully. Model Info: 

FlaxMoEForLMModule(
    # attributes
    config = <model.moe_model.MoEConfig object at 0x7fa304274a00>
    dtype = float16
    bias_init = zeros
) 

[I] Manually constructing dummy batch...
[I] Initialize training state...
[I] Training state initialization is completed.
[I] Constructing Alpa parallelized train step func...
[I] Alpa parallelized train step func construction is completed.
-------------------- Automatic stage clustering --------------------
submesh_choices: ((1, 1), (1, 2), (2, 2), (4, 2))
- Profiling for submesh 3 (4, 2):
- Generate all stage infos (Jaxpr -> HLO)
- Compile all stages
- Profile all stages
result[(0, 7, 3, 0), 0] = ModuleProfileResult(compute_cost=0.064, peak_memory=2.787 GB, invar_size=2.201 GB, outvar_size=0.082 GB, temp_buffer_size=0.504 GB, available_memory=17.402 GB)
result[(0, 7, 3, 1), 0] = ModuleProfileResult(compute_cost=0.092, peak_memory=1.720 GB, invar_size=1.109 GB, outvar_size=0.082 GB, temp_buffer_size=0.529 GB, available_memory=17.402 GB)
result[(0, 7, 3, 2), 0] = ModuleProfileResult(compute_cost=0.117, peak_memory=1.064 GB, invar_size=0.478 GB, outvar_size=0.082 GB, temp_buffer_size=0.504 GB, available_memory=17.402 GB)
result[(0, 7, 3, 0), 1] = ModuleProfileResult(compute_cost=0.379, peak_memory=8.092 GB, invar_size=5.191 GB, outvar_size=2.554 GB, temp_buffer_size=2.901 GB, available_memory=17.402 GB)
result[(0, 7, 3, 1), 1] = ModuleProfileResult(compute_cost=0.520, peak_memory=6.414 GB, invar_size=2.655 GB, outvar_size=1.286 GB, temp_buffer_size=3.759 GB, available_memory=17.402 GB)
result[(0, 7, 3, 2), 1] = ModuleProfileResult(compute_cost=0.360, peak_memory=4.155 GB, invar_size=1.254 GB, outvar_size=0.586 GB, temp_buffer_size=2.901 GB, available_memory=17.402 GB)
Profiling for submesh 3 (4, 2) takes 81.80 seconds
--------------------------------------------------
- Profiling for submesh 2 (2, 2):
- Generate all stage infos (Jaxpr -> HLO)
- Compile all stages
- Profile all stages
result[(0, 3, 2, 0), 0] = ModuleProfileResult(compute_cost=0.069, peak_memory=2.362 GB, invar_size=1.261 GB, outvar_size=0.094 GB, temp_buffer_size=1.008 GB, available_memory=17.580 GB)
result[(0, 3, 2, 1), 0] = ModuleProfileResult(compute_cost=0.095, peak_memory=1.823 GB, invar_size=0.675 GB, outvar_size=0.094 GB, temp_buffer_size=1.055 GB, available_memory=17.580 GB)
result[(1, 4, 2, 2), 0] = ModuleProfileResult(compute_cost=0.126, peak_memory=1.296 GB, invar_size=0.428 GB, outvar_size=0.094 GB, temp_buffer_size=0.774 GB, available_memory=17.580 GB)
result[(1, 4, 2, 0), 0] = ModuleProfileResult(compute_cost=0.067, peak_memory=2.140 GB, invar_size=1.272 GB, outvar_size=0.094 GB, temp_buffer_size=0.774 GB, available_memory=17.580 GB)
result[(0, 3, 2, 2), 0] = ModuleProfileResult(compute_cost=0.128, peak_memory=1.518 GB, invar_size=0.417 GB, outvar_size=0.094 GB, temp_buffer_size=1.008 GB, available_memory=17.580 GB)
result[(1, 4, 2, 1), 0] = ModuleProfileResult(compute_cost=0.087, peak_memory=1.568 GB, invar_size=0.701 GB, outvar_size=0.094 GB, temp_buffer_size=0.774 GB, available_memory=17.580 GB)
result[(1, 5, 2, 0), 0] = ModuleProfileResult(compute_cost=0.083, peak_memory=2.471 GB, invar_size=1.579 GB, outvar_size=0.117 GB, temp_buffer_size=0.774 GB, available_memory=17.580 GB)
result[(0, 3, 2, 0), 1] = ModuleProfileResult(compute_cost=0.260, peak_memory=7.143 GB, invar_size=2.615 GB, outvar_size=1.260 GB, temp_buffer_size=4.528 GB, available_memory=17.580 GB)
result[(2, 5, 2, 0), 0] = ModuleProfileResult(compute_cost=0.067, peak_memory=2.140 GB, invar_size=1.272 GB, outvar_size=0.094 GB, temp_buffer_size=0.774 GB, available_memory=17.580 GB)
result[(1, 4, 2, 0), 1] = ModuleProfileResult(compute_cost=0.261, peak_memory=7.048 GB, invar_size=2.614 GB, outvar_size=1.272 GB, temp_buffer_size=4.411 GB, available_memory=17.580 GB)
result[(1, 5, 2, 1), 0] = ModuleProfileResult(compute_cost=0.107, peak_memory=1.759 GB, invar_size=0.868 GB, outvar_size=0.117 GB, temp_buffer_size=0.774 GB, available_memory=17.580 GB)
result[(0, 3, 2, 2), 1] = ModuleProfileResult(compute_cost=0.320, peak_memory=5.455 GB, invar_size=0.927 GB, outvar_size=0.417 GB, temp_buffer_size=4.528 GB, available_memory=17.580 GB)
result[(0, 3, 2, 1), 1] = ModuleProfileResult(compute_cost=0.285, peak_memory=5.970 GB, invar_size=1.443 GB, outvar_size=0.674 GB, temp_buffer_size=4.528 GB, available_memory=17.580 GB)
result[(1, 4, 2, 2), 1] = ModuleProfileResult(compute_cost=0.320, peak_memory=5.454 GB, invar_size=0.997 GB, outvar_size=0.428 GB, temp_buffer_size=4.434 GB, available_memory=17.580 GB)
result[(1, 4, 2, 1), 1] = ModuleProfileResult(compute_cost=0.289, peak_memory=5.961 GB, invar_size=1.495 GB, outvar_size=0.700 GB, temp_buffer_size=4.443 GB, available_memory=17.580 GB)
result[(1, 5, 2, 2), 0] = ModuleProfileResult(compute_cost=0.157, peak_memory=1.416 GB, invar_size=0.525 GB, outvar_size=0.117 GB, temp_buffer_size=0.774 GB, available_memory=17.580 GB)
result[(2, 5, 2, 1), 0] = ModuleProfileResult(compute_cost=0.087, peak_memory=1.568 GB, invar_size=0.701 GB, outvar_size=0.094 GB, temp_buffer_size=0.774 GB, available_memory=17.580 GB)
result[(1, 5, 2, 0), 1] = ModuleProfileResult(compute_cost=0.324, peak_memory=7.710 GB, invar_size=3.253 GB, outvar_size=1.579 GB, temp_buffer_size=4.434 GB, available_memory=17.580 GB)
result[(2, 5, 2, 2), 0] = ModuleProfileResult(compute_cost=0.126, peak_memory=1.296 GB, invar_size=0.428 GB, outvar_size=0.094 GB, temp_buffer_size=0.774 GB, available_memory=17.580 GB)
result[(2, 5, 2, 0), 1] = ModuleProfileResult(compute_cost=0.261, peak_memory=7.071 GB, invar_size=2.614 GB, outvar_size=1.272 GB, temp_buffer_size=4.434 GB, available_memory=17.580 GB)
result[(2, 6, 2, 0), 0] = ModuleProfileResult(compute_cost=0.083, peak_memory=2.471 GB, invar_size=1.579 GB, outvar_size=0.117 GB, temp_buffer_size=0.774 GB, available_memory=17.580 GB)
result[(3, 6, 2, 0), 0] = ModuleProfileResult(compute_cost=0.067, peak_memory=2.140 GB, invar_size=1.272 GB, outvar_size=0.094 GB, temp_buffer_size=0.774 GB, available_memory=17.580 GB)
result[(2, 6, 2, 1), 0] = ModuleProfileResult(compute_cost=0.107, peak_memory=1.759 GB, invar_size=0.868 GB, outvar_size=0.117 GB, temp_buffer_size=0.774 GB, available_memory=17.580 GB)
result[(2, 6, 2, 2), 0] = ModuleProfileResult(compute_cost=0.157, peak_memory=1.416 GB, invar_size=0.525 GB, outvar_size=0.117 GB, temp_buffer_size=0.774 GB, available_memory=17.580 GB)
result[(1, 5, 2, 1), 1] = ModuleProfileResult(compute_cost=0.360, peak_memory=6.333 GB, invar_size=1.829 GB, outvar_size=0.867 GB, temp_buffer_size=4.481 GB, available_memory=17.580 GB)
result[(1, 5, 2, 2), 1] = ModuleProfileResult(compute_cost=0.398, peak_memory=5.601 GB, invar_size=1.143 GB, outvar_size=0.525 GB, temp_buffer_size=4.434 GB, available_memory=17.580 GB)
result[(3, 6, 2, 1), 0] = ModuleProfileResult(compute_cost=0.087, peak_memory=1.568 GB, invar_size=0.701 GB, outvar_size=0.094 GB, temp_buffer_size=0.774 GB, available_memory=17.580 GB)
result[(4, 7, 2, 0), 0] = ModuleProfileResult(compute_cost=0.051, peak_memory=1.808 GB, invar_size=0.964 GB, outvar_size=0.070 GB, temp_buffer_size=0.774 GB, available_memory=17.580 GB)
result[(2, 5, 2, 2), 1] = ModuleProfileResult(compute_cost=0.320, peak_memory=5.384 GB, invar_size=0.926 GB, outvar_size=0.428 GB, temp_buffer_size=4.434 GB, available_memory=17.580 GB)
result[(3, 6, 2, 2), 0] = ModuleProfileResult(compute_cost=0.126, peak_memory=1.296 GB, invar_size=0.428 GB, outvar_size=0.094 GB, temp_buffer_size=0.774 GB, available_memory=17.580 GB)
result[(2, 5, 2, 1), 1] = ModuleProfileResult(compute_cost=0.293, peak_memory=5.976 GB, invar_size=1.471 GB, outvar_size=0.700 GB, temp_buffer_size=4.481 GB, available_memory=17.580 GB)
result[(4, 7, 2, 1), 0] = ModuleProfileResult(compute_cost=0.066, peak_memory=1.378 GB, invar_size=0.533 GB, outvar_size=0.070 GB, temp_buffer_size=0.774 GB, available_memory=17.580 GB)
result[(2, 6, 2, 0), 1] = ModuleProfileResult(compute_cost=0.324, peak_memory=7.710 GB, invar_size=3.253 GB, outvar_size=1.579 GB, temp_buffer_size=4.434 GB, available_memory=17.580 GB)
result[(3, 6, 2, 0), 1] = ModuleProfileResult(compute_cost=0.261, peak_memory=7.072 GB, invar_size=2.614 GB, outvar_size=1.272 GB, temp_buffer_size=4.434 GB, available_memory=17.580 GB)
result[(4, 7, 2, 2), 0] = ModuleProfileResult(compute_cost=0.096, peak_memory=1.176 GB, invar_size=0.331 GB, outvar_size=0.070 GB, temp_buffer_size=0.774 GB, available_memory=17.580 GB)
result[(2, 6, 2, 2), 1] = ModuleProfileResult(compute_cost=0.398, peak_memory=5.601 GB, invar_size=1.143 GB, outvar_size=0.525 GB, temp_buffer_size=4.434 GB, available_memory=17.580 GB)
result[(2, 6, 2, 1), 1] = ModuleProfileResult(compute_cost=0.360, peak_memory=6.333 GB, invar_size=1.829 GB, outvar_size=0.867 GB, temp_buffer_size=4.481 GB, available_memory=17.580 GB)
result[(3, 6, 2, 1), 1] = ModuleProfileResult(compute_cost=0.293, peak_memory=5.976 GB, invar_size=1.471 GB, outvar_size=0.700 GB, temp_buffer_size=4.481 GB, available_memory=17.580 GB)
result[(4, 7, 2, 0), 1] = ModuleProfileResult(compute_cost=0.290, peak_memory=8.484 GB, invar_size=2.682 GB, outvar_size=1.318 GB, temp_buffer_size=5.778 GB, available_memory=17.580 GB)
result[(3, 6, 2, 2), 1] = ModuleProfileResult(compute_cost=0.320, peak_memory=5.384 GB, invar_size=0.926 GB, outvar_size=0.428 GB, temp_buffer_size=4.434 GB, available_memory=17.580 GB)
result[(4, 7, 2, 1), 1] = ModuleProfileResult(compute_cost=0.330, peak_memory=7.319 GB, invar_size=1.494 GB, outvar_size=0.723 GB, temp_buffer_size=5.802 GB, available_memory=17.580 GB)
result[(4, 7, 2, 2), 1] = ModuleProfileResult(compute_cost=0.349, peak_memory=6.796 GB, invar_size=0.995 GB, outvar_size=0.474 GB, temp_buffer_size=5.778 GB, available_memory=17.580 GB)
Profiling for submesh 2 (2, 2) takes 79.96 seconds
--------------------------------------------------
- Profiling for submesh 1 (1, 2):
- Generate all stage infos (Jaxpr -> HLO)
- Compile all stages
- Profile all stages
result[(0, 1, 1, 0), 0] = ModuleProfileResult(compute_cost=0.072, peak_memory=2.755 GB, invar_size=0.645 GB, outvar_size=0.094 GB, temp_buffer_size=2.016 GB, available_memory=17.580 GB)
result[(2, 3, 1, 0), 0] = ModuleProfileResult(compute_cost=0.062, peak_memory=2.304 GB, invar_size=0.662 GB, outvar_size=0.094 GB, temp_buffer_size=1.548 GB, available_memory=17.580 GB)
result[(1, 2, 1, 2), 0] = ModuleProfileResult(compute_cost=0.080, peak_memory=2.023 GB, invar_size=0.381 GB, outvar_size=0.094 GB, temp_buffer_size=1.548 GB, available_memory=17.580 GB)
result[(1, 2, 1, 0), 0] = ModuleProfileResult(compute_cost=0.062, peak_memory=2.304 GB, invar_size=0.662 GB, outvar_size=0.094 GB, temp_buffer_size=1.548 GB, available_memory=17.580 GB)
result[(0, 1, 1, 2), 0] = ModuleProfileResult(compute_cost=0.091, peak_memory=2.473 GB, invar_size=0.364 GB, outvar_size=0.094 GB, temp_buffer_size=2.016 GB, available_memory=17.580 GB)
result[(0, 1, 1, 1), 0] = ModuleProfileResult(compute_cost=0.171, peak_memory=2.480 GB, invar_size=0.323 GB, outvar_size=0.141 GB, temp_buffer_size=2.016 GB, available_memory=17.580 GB)
result[(1, 2, 1, 1), 0] = ModuleProfileResult(compute_cost=0.160, peak_memory=2.138 GB, invar_size=0.402 GB, outvar_size=0.141 GB, temp_buffer_size=1.596 GB, available_memory=17.580 GB)
result[(0, 1, 1, 0), 1] = ModuleProfileResult(compute_cost=0.201, peak_memory=10.440 GB, invar_size=1.384 GB, outvar_size=0.645 GB, temp_buffer_size=9.056 GB, available_memory=17.580 GB)
result[(2, 3, 1, 0), 1] = ModuleProfileResult(compute_cost=0.186, peak_memory=9.158 GB, invar_size=1.371 GB, outvar_size=0.662 GB, temp_buffer_size=7.740 GB, available_memory=17.580 GB)
result[(2, 3, 1, 2), 0] = ModuleProfileResult(compute_cost=0.080, peak_memory=2.023 GB, invar_size=0.381 GB, outvar_size=0.094 GB, temp_buffer_size=1.548 GB, available_memory=17.580 GB)
result[(1, 2, 1, 2), 1] = ModuleProfileResult(compute_cost=0.218, peak_memory=8.599 GB, invar_size=0.809 GB, outvar_size=0.381 GB, temp_buffer_size=7.743 GB, available_memory=17.580 GB)
result[(0, 1, 1, 1), 1] = ModuleProfileResult(compute_cost=0.409, peak_memory=10.649 GB, invar_size=0.833 GB, outvar_size=0.323 GB, temp_buffer_size=9.815 GB, available_memory=17.580 GB)
result[(1, 2, 1, 1), 1] = ModuleProfileResult(compute_cost=0.408, peak_memory=9.919 GB, invar_size=0.897 GB, outvar_size=0.401 GB, temp_buffer_size=8.928 GB, available_memory=17.580 GB)
result[(1, 2, 1, 0), 1] = ModuleProfileResult(compute_cost=0.186, peak_memory=9.158 GB, invar_size=1.371 GB, outvar_size=0.662 GB, temp_buffer_size=7.740 GB, available_memory=17.580 GB)
result[(0, 1, 1, 2), 1] = ModuleProfileResult(compute_cost=0.233, peak_memory=9.877 GB, invar_size=0.822 GB, outvar_size=0.364 GB, temp_buffer_size=9.056 GB, available_memory=17.580 GB)
result[(2, 3, 1, 1), 0] = ModuleProfileResult(compute_cost=0.160, peak_memory=2.138 GB, invar_size=0.402 GB, outvar_size=0.141 GB, temp_buffer_size=1.596 GB, available_memory=17.580 GB)
result[(3, 4, 1, 0), 0] = ModuleProfileResult(compute_cost=0.069, peak_memory=2.322 GB, invar_size=0.680 GB, outvar_size=0.094 GB, temp_buffer_size=1.548 GB, available_memory=17.580 GB)
result[(3, 4, 1, 1), 0] = ModuleProfileResult(compute_cost=0.195, peak_memory=2.194 GB, invar_size=0.410 GB, outvar_size=0.188 GB, temp_buffer_size=1.596 GB, available_memory=17.580 GB)
result[(2, 3, 1, 1), 1] = ModuleProfileResult(compute_cost=0.408, peak_memory=9.919 GB, invar_size=0.897 GB, outvar_size=0.401 GB, temp_buffer_size=8.928 GB, available_memory=17.580 GB)
result[(4, 5, 1, 0), 0] = ModuleProfileResult(compute_cost=0.069, peak_memory=2.322 GB, invar_size=0.680 GB, outvar_size=0.094 GB, temp_buffer_size=1.548 GB, available_memory=17.580 GB)
result[(2, 3, 1, 2), 1] = ModuleProfileResult(compute_cost=0.218, peak_memory=8.599 GB, invar_size=0.809 GB, outvar_size=0.381 GB, temp_buffer_size=7.743 GB, available_memory=17.580 GB)
result[(3, 4, 1, 2), 0] = ModuleProfileResult(compute_cost=0.087, peak_memory=2.040 GB, invar_size=0.399 GB, outvar_size=0.094 GB, temp_buffer_size=1.548 GB, available_memory=17.580 GB)
result[(4, 5, 1, 2), 0] = ModuleProfileResult(compute_cost=0.087, peak_memory=2.040 GB, invar_size=0.399 GB, outvar_size=0.094 GB, temp_buffer_size=1.548 GB, available_memory=17.580 GB)
result[(4, 5, 1, 1), 0] = ModuleProfileResult(compute_cost=0.195, peak_memory=2.194 GB, invar_size=0.410 GB, outvar_size=0.188 GB, temp_buffer_size=1.596 GB, available_memory=17.580 GB)
result[(3, 4, 1, 0), 1] = ModuleProfileResult(compute_cost=0.204, peak_memory=10.275 GB, invar_size=1.407 GB, outvar_size=0.680 GB, temp_buffer_size=8.821 GB, available_memory=17.580 GB)
result[(5, 6, 1, 0), 0] = ModuleProfileResult(compute_cost=0.062, peak_memory=2.304 GB, invar_size=0.662 GB, outvar_size=0.094 GB, temp_buffer_size=1.548 GB, available_memory=17.580 GB)
result[(3, 4, 1, 1), 1] = ModuleProfileResult(compute_cost=0.440, peak_memory=10.308 GB, invar_size=0.914 GB, outvar_size=0.410 GB, temp_buffer_size=9.300 GB, available_memory=17.580 GB)
result[(6, 7, 1, 0), 0] = ModuleProfileResult(compute_cost=0.031, peak_memory=1.949 GB, invar_size=0.355 GB, outvar_size=0.047 GB, temp_buffer_size=1.548 GB, available_memory=17.580 GB)
result[(5, 6, 1, 1), 0] = ModuleProfileResult(compute_cost=0.174, peak_memory=2.185 GB, invar_size=0.402 GB, outvar_size=0.188 GB, temp_buffer_size=1.596 GB, available_memory=17.580 GB)
result[(3, 4, 1, 2), 1] = ModuleProfileResult(compute_cost=0.236, peak_memory=9.806 GB, invar_size=0.891 GB, outvar_size=0.399 GB, temp_buffer_size=8.868 GB, available_memory=17.580 GB)
result[(6, 7, 1, 1), 0] = ModuleProfileResult(compute_cost=0.087, peak_memory=1.937 GB, invar_size=0.248 GB, outvar_size=0.094 GB, temp_buffer_size=1.596 GB, available_memory=17.580 GB)
result[(4, 5, 1, 1), 1] = ModuleProfileResult(compute_cost=0.440, peak_memory=10.964 GB, invar_size=0.914 GB, outvar_size=0.410 GB, temp_buffer_size=9.956 GB, available_memory=17.580 GB)
result[(4, 5, 1, 0), 1] = ModuleProfileResult(compute_cost=0.204, peak_memory=10.322 GB, invar_size=1.407 GB, outvar_size=0.680 GB, temp_buffer_size=8.868 GB, available_memory=17.580 GB)
result[(4, 5, 1, 2), 1] = ModuleProfileResult(compute_cost=0.236, peak_memory=9.759 GB, invar_size=0.844 GB, outvar_size=0.399 GB, temp_buffer_size=8.868 GB, available_memory=17.580 GB)
result[(5, 6, 1, 2), 0] = ModuleProfileResult(compute_cost=0.080, peak_memory=2.023 GB, invar_size=0.381 GB, outvar_size=0.094 GB, temp_buffer_size=1.548 GB, available_memory=17.580 GB)
result[(5, 6, 1, 0), 1] = ModuleProfileResult(compute_cost=0.186, peak_memory=9.490 GB, invar_size=1.371 GB, outvar_size=0.662 GB, temp_buffer_size=8.071 GB, available_memory=17.580 GB)
result[(6, 7, 1, 2), 0] = ModuleProfileResult(compute_cost=0.040, peak_memory=1.809 GB, invar_size=0.214 GB, outvar_size=0.047 GB, temp_buffer_size=1.548 GB, available_memory=17.580 GB)
result[(5, 6, 1, 1), 1] = ModuleProfileResult(compute_cost=0.408, peak_memory=10.200 GB, invar_size=0.897 GB, outvar_size=0.401 GB, temp_buffer_size=9.210 GB, available_memory=17.580 GB)
result[(6, 7, 1, 0), 1] = ModuleProfileResult(compute_cost=0.238, peak_memory=13.019 GB, invar_size=1.416 GB, outvar_size=0.708 GB, temp_buffer_size=11.556 GB, available_memory=17.580 GB)
result[(5, 6, 1, 2), 1] = ModuleProfileResult(compute_cost=0.218, peak_memory=8.927 GB, invar_size=0.809 GB, outvar_size=0.381 GB, temp_buffer_size=8.071 GB, available_memory=17.580 GB)
result[(6, 7, 1, 1), 1] = ModuleProfileResult(compute_cost=0.474, peak_memory=12.925 GB, invar_size=0.849 GB, outvar_size=0.424 GB, temp_buffer_size=11.982 GB, available_memory=17.580 GB)
result[(6, 7, 1, 2), 1] = ModuleProfileResult(compute_cost=0.270, peak_memory=12.394 GB, invar_size=0.854 GB, outvar_size=0.427 GB, temp_buffer_size=11.494 GB, available_memory=17.580 GB)
Profiling for submesh 1 (1, 2) takes 33.32 seconds
--------------------------------------------------
- Profiling for submesh 0 (1, 1):
- Generate all stage infos (Jaxpr -> HLO)
- Compile all stages
- Profile all stages
result[(0, 0, 0, 0), 0] = ModuleProfileResult(compute_cost=0.083, peak_memory=4.463 GB, invar_size=0.338 GB, outvar_size=0.094 GB, temp_buffer_size=4.031 GB, available_memory=17.580 GB)
result[(2, 2, 0, 1), 0] = ModuleProfileResult(compute_cost=0.061, peak_memory=3.591 GB, invar_size=0.402 GB, outvar_size=0.094 GB, temp_buffer_size=3.096 GB, available_memory=17.580 GB)
result[(3, 3, 0, 0), 0] = ModuleProfileResult(compute_cost=0.061, peak_memory=3.591 GB, invar_size=0.402 GB, outvar_size=0.094 GB, temp_buffer_size=3.096 GB, available_memory=17.580 GB)
result[(0, 0, 0, 1), 0] = ModuleProfileResult(compute_cost=0.083, peak_memory=4.463 GB, invar_size=0.338 GB, outvar_size=0.094 GB, temp_buffer_size=4.031 GB, available_memory=17.580 GB)
result[(2, 2, 0, 0), 0] = ModuleProfileResult(compute_cost=0.061, peak_memory=3.591 GB, invar_size=0.402 GB, outvar_size=0.094 GB, temp_buffer_size=3.096 GB, available_memory=17.580 GB)
result[(1, 1, 0, 1), 0] = ModuleProfileResult(compute_cost=0.061, peak_memory=3.591 GB, invar_size=0.402 GB, outvar_size=0.094 GB, temp_buffer_size=3.096 GB, available_memory=17.580 GB)
result[(0, 0, 0, 0), 1] = ModuleProfileResult(compute_cost=0.208, peak_memory=18.788 GB, invar_size=0.769 GB, outvar_size=0.337 GB, temp_buffer_size=18.019 GB, available_memory=17.580 GB)
result[(1, 1, 0, 0), 0] = ModuleProfileResult(compute_cost=0.061, peak_memory=3.591 GB, invar_size=0.402 GB, outvar_size=0.094 GB, temp_buffer_size=3.096 GB, available_memory=17.580 GB)
result[(3, 3, 0, 0), 1] = ModuleProfileResult(compute_cost=0.177, peak_memory=16.291 GB, invar_size=0.803 GB, outvar_size=0.401 GB, temp_buffer_size=15.394 GB, available_memory=17.580 GB)
result[(2, 2, 0, 1), 1] = ModuleProfileResult(compute_cost=0.177, peak_memory=16.291 GB, invar_size=0.803 GB, outvar_size=0.401 GB, temp_buffer_size=15.394 GB, available_memory=17.580 GB)
result[(0, 0, 0, 1), 1] = ModuleProfileResult(compute_cost=0.208, peak_memory=18.788 GB, invar_size=0.769 GB, outvar_size=0.337 GB, temp_buffer_size=18.019 GB, available_memory=17.580 GB)
result[(2, 2, 0, 0), 1] = ModuleProfileResult(compute_cost=0.177, peak_memory=16.291 GB, invar_size=0.803 GB, outvar_size=0.401 GB, temp_buffer_size=15.394 GB, available_memory=17.580 GB)
result[(1, 1, 0, 1), 1] = ModuleProfileResult(compute_cost=0.177, peak_memory=16.291 GB, invar_size=0.803 GB, outvar_size=0.401 GB, temp_buffer_size=15.394 GB, available_memory=17.580 GB)
result[(3, 3, 0, 1), 0] = ModuleProfileResult(compute_cost=0.061, peak_memory=3.591 GB, invar_size=0.402 GB, outvar_size=0.094 GB, temp_buffer_size=3.096 GB, available_memory=17.580 GB)
result[(1, 1, 0, 0), 1] = ModuleProfileResult(compute_cost=0.177, peak_memory=16.291 GB, invar_size=0.803 GB, outvar_size=0.401 GB, temp_buffer_size=15.394 GB, available_memory=17.580 GB)
result[(7, 7, 0, 0), 0] = ModuleProfileResult(compute_cost=0.000, peak_memory=0.000 GB, invar_size=0.000 GB, outvar_size=0.000 GB, temp_buffer_size=0.000 GB, available_memory=17.580 GB)
result[(4, 4, 0, 0), 0] = ModuleProfileResult(compute_cost=0.074, peak_memory=3.609 GB, invar_size=0.419 GB, outvar_size=0.094 GB, temp_buffer_size=3.096 GB, available_memory=17.580 GB)
result[(7, 7, 0, 1), 0] = ModuleProfileResult(compute_cost=0.000, peak_memory=0.000 GB, invar_size=0.000 GB, outvar_size=0.000 GB, temp_buffer_size=0.000 GB, available_memory=17.580 GB)
result[(4, 4, 0, 1), 0] = ModuleProfileResult(compute_cost=0.074, peak_memory=3.609 GB, invar_size=0.419 GB, outvar_size=0.094 GB, temp_buffer_size=3.096 GB, available_memory=17.580 GB)
result[(5, 5, 0, 0), 0] = ModuleProfileResult(compute_cost=0.061, peak_memory=3.591 GB, invar_size=0.402 GB, outvar_size=0.094 GB, temp_buffer_size=3.096 GB, available_memory=17.580 GB)
result[(5, 5, 0, 1), 0] = ModuleProfileResult(compute_cost=0.061, peak_memory=3.591 GB, invar_size=0.402 GB, outvar_size=0.094 GB, temp_buffer_size=3.096 GB, available_memory=17.580 GB)
result[(3, 3, 0, 1), 1] = ModuleProfileResult(compute_cost=0.177, peak_memory=16.291 GB, invar_size=0.803 GB, outvar_size=0.401 GB, temp_buffer_size=15.394 GB, available_memory=17.580 GB)
result[(6, 6, 0, 0), 0] = ModuleProfileResult(compute_cost=0.061, peak_memory=3.591 GB, invar_size=0.402 GB, outvar_size=0.094 GB, temp_buffer_size=3.096 GB, available_memory=17.580 GB)
result[(6, 6, 0, 1), 0] = ModuleProfileResult(compute_cost=0.061, peak_memory=3.591 GB, invar_size=0.402 GB, outvar_size=0.094 GB, temp_buffer_size=3.096 GB, available_memory=17.580 GB)
result[(4, 4, 0, 0), 1] = ModuleProfileResult(compute_cost=0.210, peak_memory=18.544 GB, invar_size=0.838 GB, outvar_size=0.419 GB, temp_buffer_size=17.612 GB, available_memory=17.580 GB)
result[(5, 5, 0, 0), 1] = ModuleProfileResult(compute_cost=0.177, peak_memory=17.134 GB, invar_size=0.803 GB, outvar_size=0.401 GB, temp_buffer_size=16.237 GB, available_memory=17.580 GB)
result[(4, 4, 0, 1), 1] = ModuleProfileResult(compute_cost=0.210, peak_memory=18.544 GB, invar_size=0.838 GB, outvar_size=0.419 GB, temp_buffer_size=17.612 GB, available_memory=17.580 GB)
result[(5, 5, 0, 1), 1] = ModuleProfileResult(compute_cost=0.177, peak_memory=17.134 GB, invar_size=0.803 GB, outvar_size=0.401 GB, temp_buffer_size=16.237 GB, available_memory=17.580 GB)
result[(6, 6, 0, 0), 1] = ModuleProfileResult(compute_cost=0.177, peak_memory=16.947 GB, invar_size=0.803 GB, outvar_size=0.401 GB, temp_buffer_size=16.050 GB, available_memory=17.580 GB)
result[(6, 6, 0, 1), 1] = ModuleProfileResult(compute_cost=0.177, peak_memory=16.947 GB, invar_size=0.803 GB, outvar_size=0.401 GB, temp_buffer_size=16.050 GB, available_memory=17.580 GB)
result[(7, 7, 0, 0), 1] = ModuleProfileResult(compute_cost=0.279, peak_memory=25.007 GB, invar_size=0.801 GB, outvar_size=0.447 GB, temp_buffer_size=24.112 GB, available_memory=17.580 GB)
result[(7, 7, 0, 1), 1] = ModuleProfileResult(compute_cost=0.279, peak_memory=25.007 GB, invar_size=0.801 GB, outvar_size=0.447 GB, temp_buffer_size=24.112 GB, available_memory=17.580 GB)
Profiling for submesh 0 (1, 1) takes 15.20 seconds
--------------------------------------------------
Profile result saved to: profile-results-2023-11-18-17-09-11.npy
----------------------------------------------------------------------
Result forward_stage_layer_ids: [[0, 1], [2, 3], [4, 5], [6, 7]]
Result mesh_shapes: [(1, 2), (1, 2), (1, 2), (1, 2)]
Result logical_mesh_shapes: [(2, 1), (2, 1), (2, 1), (2, 1)]
Result autosharding_option_dicts: [{'force_batch_dim_to_mesh_dim': 0}, {'force_batch_dim_to_mesh_dim': 0}, {'force_batch_dim_to_mesh_dim': 0}, {'force_batch_dim_to_mesh_dim': 0}]
 - Compile (driver): 256.51 s
compilation time breakdown: {'stage-construction': '213.68', 'stage-construction-dp': '1.14', 'stage-construction-compilation': '110.25', 'stage-construction-profiling': '48.81'}
 - Compile (worker): 7.54 s
[I] Training process warmup (2 rounds) with dummy input batch...
    - Warmup iteration: 1/2
    - Warmup iteration: 2/2
[I] Ready to perform training process.
[I] Benchmark the training process with entire dataset and profile with driver overhead...
    - Iteration 1 / 5 is performed...
    - Iteration 2 / 5 is performed...
    - Iteration 3 / 5 is performed...
    - Iteration 4 / 5 is performed...
 - Benchmark: 108.24 s

[20.403980493545532, 13.74077033996582, 13.77196717262268, 13.808230876922607, 14.067401647567749, 13.762308120727539, 13.834904670715332]


[I] Performance metrics:
 - Iteration count: 5.
 - Total e2e training time : 72.159 s.
 - Average e2e iteration time: 14.432001113891602 s.
 - Total local training time: 69.24500274658203 s.
 - Average local iteration time: 13.849000930786133 s.
 - Max allocated memory among devices: 15.093 GB.
 - Compilation times:  {'stage-construction': 213.68279886245728, 'stage-construction-dp': 1.1398181915283203, 'stage-construction-compilation': 110.25241494178772, 'stage-construction-profiling': 48.806723833084106}
 - Metadata:  []
 - Is need save result:  True

[TMP] Current profiling results of key `4_a10_4_n_2_d`: 13.848962783813477
[TMP] Updated profiling results stored in `./jaxpr/prof_log/optimal/moe_1.3B_1024.pkl`...
