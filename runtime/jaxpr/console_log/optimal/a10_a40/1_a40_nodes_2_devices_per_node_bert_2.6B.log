
------------------------------------------------------------------
- (1/3) Profiling bert_2.6B with batch size: 128...
------------------------------------------------------------------
[TMP] Existed profiling results in `./jaxpr/prof_log/optimal/bert_2.6B_128.pkl`, updating/rewriting it...
[I] Ray Cluster & Alpa backend initialization is completed.
[I] Device Info:
    - Devices num per node: 2
    - Nodes num: 1
[I] Loading flax model....
[I] Model 'bert' loads sucessfully. Model Info: 

FlaxBertForMaskedLMModule(
    # attributes
    config = <model.bert_model.BertConfig object at 0x7f468d745cd0>
    dtype = float16
) 

[I] Manually constructing dummy batch...
[I] Initialize training state...
[I] Training state initialization is completed.
[I] Constructing Alpa parallelized train step func...
[I] Alpa parallelized train step func construction is completed.
-------------------- Automatic stage clustering --------------------
submesh_choices: ((1, 1), (1, 2))
- Profiling for submesh 1 (1, 2):
- Generate all stage infos (Jaxpr -> HLO)
- Compile all stages
- Profile all stages
result[(0, 5, 1, 0), 0] = ModuleProfileResult(compute_cost=0.148, peak_memory=4.692 GB, invar_size=4.203 GB, outvar_size=0.098 GB, temp_buffer_size=0.391 GB, available_memory=35.242 GB)
result[(0, 5, 1, 1), 0] = ModuleProfileResult(compute_cost=0.474, peak_memory=2.688 GB, invar_size=2.102 GB, outvar_size=0.195 GB, temp_buffer_size=0.391 GB, available_memory=35.242 GB)
result[(0, 5, 1, 2), 0] = ModuleProfileResult(compute_cost=0.154, peak_memory=4.607 GB, invar_size=4.080 GB, outvar_size=0.098 GB, temp_buffer_size=0.430 GB, available_memory=35.242 GB)
result[(0, 5, 1, 0), 1] = ModuleProfileResult(compute_cost=0.585, peak_memory=15.676 GB, invar_size=10.483 GB, outvar_size=5.193 GB, temp_buffer_size=5.193 GB, available_memory=35.242 GB)
result[(0, 5, 1, 1), 1] = ModuleProfileResult(compute_cost=1.303, peak_memory=11.397 GB, invar_size=5.389 GB, outvar_size=2.597 GB, temp_buffer_size=6.008 GB, available_memory=35.242 GB)
result[(0, 5, 1, 2), 1] = ModuleProfileResult(compute_cost=0.596, peak_memory=15.108 GB, invar_size=9.992 GB, outvar_size=4.947 GB, temp_buffer_size=5.116 GB, available_memory=35.242 GB)
Profiling for submesh 1 (1, 2) takes 76.16 seconds
--------------------------------------------------
- Profiling for submesh 0 (1, 1):
- Generate all stage infos (Jaxpr -> HLO)
- Compile all stages
- Profile all stages
result[(0, 2, 0, 0), 0] = ModuleProfileResult(compute_cost=0.177, peak_memory=3.490 GB, invar_size=2.591 GB, outvar_size=0.117 GB, temp_buffer_size=0.781 GB, available_memory=35.242 GB)
result[(0, 2, 0, 1), 0] = ModuleProfileResult(compute_cost=0.177, peak_memory=3.490 GB, invar_size=2.591 GB, outvar_size=0.117 GB, temp_buffer_size=0.781 GB, available_memory=35.242 GB)
result[(1, 3, 0, 1), 0] = ModuleProfileResult(compute_cost=0.166, peak_memory=3.167 GB, invar_size=2.433 GB, outvar_size=0.117 GB, temp_buffer_size=0.617 GB, available_memory=35.242 GB)
result[(1, 3, 0, 0), 0] = ModuleProfileResult(compute_cost=0.166, peak_memory=3.167 GB, invar_size=2.433 GB, outvar_size=0.117 GB, temp_buffer_size=0.617 GB, available_memory=35.242 GB)
result[(2, 4, 0, 0), 0] = ModuleProfileResult(compute_cost=0.168, peak_memory=3.216 GB, invar_size=2.482 GB, outvar_size=0.117 GB, temp_buffer_size=0.617 GB, available_memory=35.242 GB)
result[(2, 4, 0, 1), 0] = ModuleProfileResult(compute_cost=0.168, peak_memory=3.216 GB, invar_size=2.482 GB, outvar_size=0.117 GB, temp_buffer_size=0.617 GB, available_memory=35.242 GB)
result[(3, 5, 0, 0), 0] = ModuleProfileResult(compute_cost=0.111, peak_memory=2.346 GB, invar_size=1.651 GB, outvar_size=0.078 GB, temp_buffer_size=0.617 GB, available_memory=35.242 GB)
result[(0, 2, 0, 1), 1] = ModuleProfileResult(compute_cost=0.516, peak_memory=18.341 GB, invar_size=5.300 GB, outvar_size=2.591 GB, temp_buffer_size=13.041 GB, available_memory=35.242 GB)
result[(1, 3, 0, 0), 1] = ModuleProfileResult(compute_cost=0.496, peak_memory=17.375 GB, invar_size=4.943 GB, outvar_size=2.433 GB, temp_buffer_size=12.393 GB, available_memory=35.242 GB)
result[(0, 2, 0, 0), 1] = ModuleProfileResult(compute_cost=0.516, peak_memory=18.341 GB, invar_size=5.300 GB, outvar_size=2.591 GB, temp_buffer_size=13.041 GB, available_memory=35.242 GB)
result[(3, 5, 0, 1), 0] = ModuleProfileResult(compute_cost=0.111, peak_memory=2.346 GB, invar_size=1.651 GB, outvar_size=0.078 GB, temp_buffer_size=0.617 GB, available_memory=35.242 GB)
result[(1, 3, 0, 1), 1] = ModuleProfileResult(compute_cost=0.496, peak_memory=17.375 GB, invar_size=4.943 GB, outvar_size=2.433 GB, temp_buffer_size=12.393 GB, available_memory=35.242 GB)
result[(2, 4, 0, 0), 1] = ModuleProfileResult(compute_cost=0.504, peak_memory=17.339 GB, invar_size=5.041 GB, outvar_size=2.482 GB, temp_buffer_size=12.259 GB, available_memory=35.242 GB)
result[(2, 4, 0, 1), 1] = ModuleProfileResult(compute_cost=0.504, peak_memory=17.339 GB, invar_size=5.041 GB, outvar_size=2.482 GB, temp_buffer_size=12.259 GB, available_memory=35.242 GB)
result[(3, 5, 0, 0), 1] = ModuleProfileResult(compute_cost=0.533, peak_memory=18.469 GB, invar_size=5.320 GB, outvar_size=2.640 GB, temp_buffer_size=13.110 GB, available_memory=35.242 GB)
result[(3, 5, 0, 1), 1] = ModuleProfileResult(compute_cost=0.533, peak_memory=18.469 GB, invar_size=5.320 GB, outvar_size=2.640 GB, temp_buffer_size=13.110 GB, available_memory=35.242 GB)
Profiling for submesh 0 (1, 1) takes 39.87 seconds
--------------------------------------------------
[E] Meet unexpected error in compiling executables...

[E] Unexpected error occurred in compiling or profiling executables...
[TMP] Current profiling results of key `1_a40_1_n_2_d`: none
[TMP] Updated profiling results stored in `./jaxpr/prof_log/optimal/bert_2.6B_128.pkl`...

------------------------------------------------------------------
- (2/3) Profiling bert_2.6B with batch size: 256...
------------------------------------------------------------------
[TMP] Existed profiling results in `./jaxpr/prof_log/optimal/bert_2.6B_256.pkl`, updating/rewriting it...
[I] Ray Cluster & Alpa backend initialization is completed.
[I] Device Info:
    - Devices num per node: 2
    - Nodes num: 1
[I] Loading flax model....
[I] Model 'bert' loads sucessfully. Model Info: 

FlaxBertForMaskedLMModule(
    # attributes
    config = <model.bert_model.BertConfig object at 0x7f1960ff9c70>
    dtype = float16
) 

[I] Manually constructing dummy batch...
[I] Initialize training state...
[I] Training state initialization is completed.
[I] Constructing Alpa parallelized train step func...
[I] Alpa parallelized train step func construction is completed.
-------------------- Automatic stage clustering --------------------
submesh_choices: ((1, 1), (1, 2))
- Profiling for submesh 1 (1, 2):
- Generate all stage infos (Jaxpr -> HLO)
- Compile all stages
- Profile all stages
result[(0, 5, 1, 0), 0] = ModuleProfileResult(compute_cost=0.289, peak_memory=5.180 GB, invar_size=4.203 GB, outvar_size=0.195 GB, temp_buffer_size=0.781 GB, available_memory=35.242 GB)
result[(0, 5, 1, 1), 0] = ModuleProfileResult(compute_cost=0.939, peak_memory=3.274 GB, invar_size=2.102 GB, outvar_size=0.391 GB, temp_buffer_size=0.781 GB, available_memory=35.242 GB)
result[(0, 5, 1, 2), 0] = ModuleProfileResult(compute_cost=0.301, peak_memory=5.135 GB, invar_size=4.080 GB, outvar_size=0.195 GB, temp_buffer_size=0.859 GB, available_memory=35.242 GB)
result[(0, 5, 1, 0), 1] = ModuleProfileResult(compute_cost=1.098, peak_memory=20.354 GB, invar_size=10.580 GB, outvar_size=5.193 GB, temp_buffer_size=9.774 GB, available_memory=35.242 GB)
result[(0, 5, 1, 1), 1] = ModuleProfileResult(compute_cost=2.577, peak_memory=17.575 GB, invar_size=5.584 GB, outvar_size=2.597 GB, temp_buffer_size=11.991 GB, available_memory=35.242 GB)
result[(0, 5, 1, 2), 1] = ModuleProfileResult(compute_cost=1.124, peak_memory=19.903 GB, invar_size=10.090 GB, outvar_size=4.947 GB, temp_buffer_size=9.813 GB, available_memory=35.242 GB)
Profiling for submesh 1 (1, 2) takes 72.47 seconds
--------------------------------------------------
- Profiling for submesh 0 (1, 1):
- Generate all stage infos (Jaxpr -> HLO)
- Compile all stages
- Profile all stages
result[(0, 2, 0, 0), 0] = ModuleProfileResult(compute_cost=0.344, peak_memory=4.388 GB, invar_size=2.592 GB, outvar_size=0.234 GB, temp_buffer_size=1.563 GB, available_memory=35.242 GB)
result[(1, 3, 0, 1), 0] = ModuleProfileResult(compute_cost=0.320, peak_memory=3.941 GB, invar_size=2.472 GB, outvar_size=0.234 GB, temp_buffer_size=1.234 GB, available_memory=35.242 GB)
result[(0, 2, 0, 1), 0] = ModuleProfileResult(compute_cost=0.344, peak_memory=4.388 GB, invar_size=2.592 GB, outvar_size=0.234 GB, temp_buffer_size=1.563 GB, available_memory=35.242 GB)
result[(1, 3, 0, 0), 0] = ModuleProfileResult(compute_cost=0.320, peak_memory=3.941 GB, invar_size=2.472 GB, outvar_size=0.234 GB, temp_buffer_size=1.234 GB, available_memory=35.242 GB)
result[(2, 4, 0, 0), 0] = ModuleProfileResult(compute_cost=0.325, peak_memory=3.989 GB, invar_size=2.521 GB, outvar_size=0.234 GB, temp_buffer_size=1.234 GB, available_memory=35.242 GB)
result[(2, 4, 0, 1), 0] = ModuleProfileResult(compute_cost=0.325, peak_memory=3.989 GB, invar_size=2.521 GB, outvar_size=0.234 GB, temp_buffer_size=1.234 GB, available_memory=35.242 GB)
result[(3, 5, 0, 0), 0] = ModuleProfileResult(compute_cost=0.215, peak_memory=3.081 GB, invar_size=1.690 GB, outvar_size=0.156 GB, temp_buffer_size=1.234 GB, available_memory=35.242 GB)
result[(1, 3, 0, 0), 1] = ModuleProfileResult(compute_cost=0.958, peak_memory=29.953 GB, invar_size=5.100 GB, outvar_size=2.472 GB, temp_buffer_size=24.775 GB, available_memory=35.242 GB)
result[(0, 2, 0, 1), 1] = ModuleProfileResult(compute_cost=0.999, peak_memory=31.491 GB, invar_size=5.417 GB, outvar_size=2.591 GB, temp_buffer_size=26.073 GB, available_memory=35.242 GB)
result[(0, 2, 0, 0), 1] = ModuleProfileResult(compute_cost=0.999, peak_memory=31.491 GB, invar_size=5.417 GB, outvar_size=2.591 GB, temp_buffer_size=26.073 GB, available_memory=35.242 GB)
result[(3, 5, 0, 1), 0] = ModuleProfileResult(compute_cost=0.215, peak_memory=3.081 GB, invar_size=1.690 GB, outvar_size=0.156 GB, temp_buffer_size=1.234 GB, available_memory=35.242 GB)
result[(1, 3, 0, 1), 1] = ModuleProfileResult(compute_cost=0.958, peak_memory=29.953 GB, invar_size=5.100 GB, outvar_size=2.472 GB, temp_buffer_size=24.775 GB, available_memory=35.242 GB)
result[(2, 4, 0, 0), 1] = ModuleProfileResult(compute_cost=0.974, peak_memory=29.784 GB, invar_size=5.197 GB, outvar_size=2.521 GB, temp_buffer_size=24.509 GB, available_memory=35.242 GB)
result[(2, 4, 0, 1), 1] = ModuleProfileResult(compute_cost=0.974, peak_memory=29.784 GB, invar_size=5.197 GB, outvar_size=2.521 GB, temp_buffer_size=24.509 GB, available_memory=35.242 GB)
result[(3, 5, 0, 0), 1] = ModuleProfileResult(compute_cost=1.033, peak_memory=31.719 GB, invar_size=5.437 GB, outvar_size=2.679 GB, temp_buffer_size=26.204 GB, available_memory=35.242 GB)
result[(3, 5, 0, 1), 1] = ModuleProfileResult(compute_cost=1.033, peak_memory=31.719 GB, invar_size=5.437 GB, outvar_size=2.679 GB, temp_buffer_size=26.204 GB, available_memory=35.242 GB)
Profiling for submesh 0 (1, 1) takes 40.57 seconds
--------------------------------------------------
[E] Meet unexpected error in compiling executables...

[E] Unexpected error occurred in compiling or profiling executables...
[TMP] Current profiling results of key `1_a40_1_n_2_d`: none
[TMP] Updated profiling results stored in `./jaxpr/prof_log/optimal/bert_2.6B_256.pkl`...

------------------------------------------------------------------
- (3/3) Profiling bert_2.6B with batch size: 512...
------------------------------------------------------------------
[TMP] Existed profiling results in `./jaxpr/prof_log/optimal/bert_2.6B_512.pkl`, updating/rewriting it...
[I] Ray Cluster & Alpa backend initialization is completed.
[I] Device Info:
    - Devices num per node: 2
    - Nodes num: 1
[I] Loading flax model....
[I] Model 'bert' loads sucessfully. Model Info: 

FlaxBertForMaskedLMModule(
    # attributes
    config = <model.bert_model.BertConfig object at 0x7f458545cbb0>
    dtype = float16
) 

[I] Manually constructing dummy batch...
[I] Initialize training state...
[I] Training state initialization is completed.
[I] Constructing Alpa parallelized train step func...
[I] Alpa parallelized train step func construction is completed.
-------------------- Automatic stage clustering --------------------
submesh_choices: ((1, 1), (1, 2))
- Profiling for submesh 1 (1, 2):
- Generate all stage infos (Jaxpr -> HLO)
- Compile all stages
- Profile all stages
result[(0, 5, 1, 0), 0] = ModuleProfileResult(compute_cost=0.559, peak_memory=6.157 GB, invar_size=4.204 GB, outvar_size=0.391 GB, temp_buffer_size=1.563 GB, available_memory=35.242 GB)
result[(0, 5, 1, 1), 0] = ModuleProfileResult(compute_cost=1.855, peak_memory=4.446 GB, invar_size=2.102 GB, outvar_size=0.781 GB, temp_buffer_size=1.563 GB, available_memory=35.242 GB)
result[(0, 5, 1, 2), 0] = ModuleProfileResult(compute_cost=0.559, peak_memory=6.157 GB, invar_size=4.204 GB, outvar_size=0.391 GB, temp_buffer_size=1.563 GB, available_memory=35.242 GB)
result[(0, 5, 1, 0), 1] = ModuleProfileResult(compute_cost=2.080, peak_memory=30.323 GB, invar_size=10.776 GB, outvar_size=5.193 GB, temp_buffer_size=19.547 GB, available_memory=35.242 GB)
result[(0, 5, 1, 1), 1] = ModuleProfileResult(compute_cost=5.080, peak_memory=29.926 GB, invar_size=5.975 GB, outvar_size=2.597 GB, temp_buffer_size=23.951 GB, available_memory=35.242 GB)
result[(0, 5, 1, 2), 1] = ModuleProfileResult(compute_cost=2.080, peak_memory=30.323 GB, invar_size=10.776 GB, outvar_size=5.193 GB, temp_buffer_size=19.547 GB, available_memory=35.242 GB)
Profiling for submesh 1 (1, 2) takes 73.46 seconds
--------------------------------------------------
- Profiling for submesh 0 (1, 1):
- Generate all stage infos (Jaxpr -> HLO)
- Compile all stages
- Profile all stages
result[(1, 3, 0, 1), 0] = ModuleProfileResult(compute_cost=0.638, peak_memory=5.488 GB, invar_size=2.550 GB, outvar_size=0.469 GB, temp_buffer_size=2.469 GB, available_memory=35.242 GB)
result[(0, 2, 0, 1), 0] = ModuleProfileResult(compute_cost=0.685, peak_memory=6.185 GB, invar_size=2.592 GB, outvar_size=0.469 GB, temp_buffer_size=3.125 GB, available_memory=35.242 GB)
result[(0, 2, 0, 0), 0] = ModuleProfileResult(compute_cost=0.685, peak_memory=6.185 GB, invar_size=2.592 GB, outvar_size=0.469 GB, temp_buffer_size=3.125 GB, available_memory=35.242 GB)
result[(1, 3, 0, 0), 0] = ModuleProfileResult(compute_cost=0.638, peak_memory=5.488 GB, invar_size=2.550 GB, outvar_size=0.469 GB, temp_buffer_size=2.469 GB, available_memory=35.242 GB)
result[(2, 4, 0, 0), 0] = ModuleProfileResult(compute_cost=0.648, peak_memory=5.536 GB, invar_size=2.599 GB, outvar_size=0.469 GB, temp_buffer_size=2.469 GB, available_memory=35.242 GB)
result[(2, 4, 0, 1), 0] = ModuleProfileResult(compute_cost=0.648, peak_memory=5.536 GB, invar_size=2.599 GB, outvar_size=0.469 GB, temp_buffer_size=2.469 GB, available_memory=35.242 GB)
result[(3, 5, 0, 0), 0] = ModuleProfileResult(compute_cost=0.429, peak_memory=4.550 GB, invar_size=1.768 GB, outvar_size=0.312 GB, temp_buffer_size=2.469 GB, available_memory=35.242 GB)
result[(0, 2, 0, 0), 1] = ModuleProfileResult(compute_cost=1.990, peak_memory=57.786 GB, invar_size=5.652 GB, outvar_size=2.591 GB, temp_buffer_size=52.134 GB, available_memory=35.242 GB)
result[(0, 2, 0, 1), 1] = ModuleProfileResult(compute_cost=1.990, peak_memory=57.786 GB, invar_size=5.652 GB, outvar_size=2.591 GB, temp_buffer_size=52.134 GB, available_memory=35.242 GB)
result[(1, 3, 0, 0), 1] = ModuleProfileResult(compute_cost=1.909, peak_memory=55.104 GB, invar_size=5.412 GB, outvar_size=2.550 GB, temp_buffer_size=49.536 GB, available_memory=35.242 GB)
result[(3, 5, 0, 1), 0] = ModuleProfileResult(compute_cost=0.429, peak_memory=4.550 GB, invar_size=1.768 GB, outvar_size=0.312 GB, temp_buffer_size=2.469 GB, available_memory=35.242 GB)
result[(1, 3, 0, 1), 1] = ModuleProfileResult(compute_cost=1.909, peak_memory=55.104 GB, invar_size=5.412 GB, outvar_size=2.550 GB, temp_buffer_size=49.536 GB, available_memory=35.242 GB)
result[(2, 4, 0, 0), 1] = ModuleProfileResult(compute_cost=1.941, peak_memory=54.679 GB, invar_size=5.510 GB, outvar_size=2.599 GB, temp_buffer_size=49.012 GB, available_memory=35.242 GB)
result[(2, 4, 0, 1), 1] = ModuleProfileResult(compute_cost=1.941, peak_memory=54.679 GB, invar_size=5.510 GB, outvar_size=2.599 GB, temp_buffer_size=49.012 GB, available_memory=35.242 GB)
result[(3, 5, 0, 0), 1] = ModuleProfileResult(compute_cost=2.059, peak_memory=58.206 GB, invar_size=5.671 GB, outvar_size=2.757 GB, temp_buffer_size=52.379 GB, available_memory=35.242 GB)
result[(3, 5, 0, 1), 1] = ModuleProfileResult(compute_cost=2.059, peak_memory=58.206 GB, invar_size=5.671 GB, outvar_size=2.757 GB, temp_buffer_size=52.379 GB, available_memory=35.242 GB)
Profiling for submesh 0 (1, 1) takes 41.01 seconds
--------------------------------------------------
[E] Meet unexpected error in compiling executables...

[E] Unexpected error occurred in compiling or profiling executables...
[TMP] Current profiling results of key `1_a40_1_n_2_d`: none
[TMP] Updated profiling results stored in `./jaxpr/prof_log/optimal/bert_2.6B_512.pkl`...
