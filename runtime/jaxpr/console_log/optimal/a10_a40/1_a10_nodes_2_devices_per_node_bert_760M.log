
------------------------------------------------------------------
- (1/3) Profiling bert_760M with batch size: 128...
------------------------------------------------------------------
[TMP] Existed profiling results in `./jaxpr/prof_log/optimal/bert_760M_128.pkl`, updating/rewriting it...
[TMP] Key `1_a10_1_n_2_d` has been profiled in `./jaxpr/prof_log/optimal/bert_760M_128.pkl` when optimizing with alpa, loading cache...

------------------------------------------------------------------
- (2/3) Profiling bert_760M with batch size: 256...
------------------------------------------------------------------
[TMP] Existed profiling results in `./jaxpr/prof_log/optimal/bert_760M_256.pkl`, updating/rewriting it...
[TMP] Key `1_a10_1_n_2_d` has been profiled in `./jaxpr/prof_log/optimal/bert_760M_256.pkl` when optimizing with alpa, loading cache...

------------------------------------------------------------------
- (3/3) Profiling bert_760M with batch size: 512...
------------------------------------------------------------------
[TMP] Existed profiling results in `./jaxpr/prof_log/optimal/bert_760M_512.pkl`, updating/rewriting it...
[I] Ray Cluster & Alpa backend initialization is completed.
[I] Device Info:
    - Devices num per node: 2
    - Nodes num: 1
[I] Loading flax model....
[I] Model 'bert' loads sucessfully. Model Info: 

FlaxBertForMaskedLMModule(
    # attributes
    config = <model.bert_model.BertConfig object at 0x7fb88e1ffcd0>
    dtype = float16
) 

[I] Manually constructing dummy batch...
[I] Initialize training state...
[I] Training state initialization is completed.
[I] Constructing Alpa parallelized train step func...
[I] Alpa parallelized train step func construction is completed.
-------------------- Automatic stage clustering --------------------
submesh_choices: ((1, 1), (1, 2))
- Profiling for submesh 1 (1, 2):
- Generate all stage infos (Jaxpr -> HLO)
- Compile all stages
- Profile all stages
result[(0, 5, 1, 0), 0] = ModuleProfileResult(compute_cost=0.262, peak_memory=3.018 GB, invar_size=1.221 GB, outvar_size=0.234 GB, temp_buffer_size=1.563 GB, available_memory=19.578 GB)
result[(0, 5, 1, 1), 0] = ModuleProfileResult(compute_cost=0.858, peak_memory=2.642 GB, invar_size=0.611 GB, outvar_size=0.469 GB, temp_buffer_size=1.563 GB, available_memory=19.578 GB)
result[(0, 5, 1, 2), 0] = ModuleProfileResult(compute_cost=0.262, peak_memory=3.018 GB, invar_size=1.221 GB, outvar_size=0.234 GB, temp_buffer_size=1.563 GB, available_memory=19.578 GB)
result[(0, 5, 1, 0), 1] = ModuleProfileResult(compute_cost=0.978, peak_memory=12.309 GB, invar_size=3.366 GB, outvar_size=1.565 GB, temp_buffer_size=8.943 GB, available_memory=19.578 GB)
result[(0, 5, 1, 1), 1] = ModuleProfileResult(compute_cost=2.343, peak_memory=13.501 GB, invar_size=2.035 GB, outvar_size=0.783 GB, temp_buffer_size=11.465 GB, available_memory=19.578 GB)
result[(0, 5, 1, 2), 1] = ModuleProfileResult(compute_cost=0.978, peak_memory=12.309 GB, invar_size=3.366 GB, outvar_size=1.565 GB, temp_buffer_size=8.943 GB, available_memory=19.578 GB)
Profiling for submesh 1 (1, 2) takes 46.25 seconds
--------------------------------------------------
- Profiling for submesh 0 (1, 1):
- Generate all stage infos (Jaxpr -> HLO)
- Compile all stages
- Profile all stages
result[(1, 3, 0, 0), 0] = ModuleProfileResult(compute_cost=0.275, peak_memory=2.307 GB, invar_size=0.745 GB, outvar_size=0.281 GB, temp_buffer_size=1.281 GB, available_memory=19.578 GB)
result[(0, 2, 0, 0), 0] = ModuleProfileResult(compute_cost=0.330, peak_memory=4.205 GB, invar_size=0.799 GB, outvar_size=0.281 GB, temp_buffer_size=3.125 GB, available_memory=19.578 GB)
result[(1, 3, 0, 1), 0] = ModuleProfileResult(compute_cost=0.275, peak_memory=2.307 GB, invar_size=0.745 GB, outvar_size=0.281 GB, temp_buffer_size=1.281 GB, available_memory=19.578 GB)
result[(0, 2, 0, 1), 0] = ModuleProfileResult(compute_cost=0.330, peak_memory=4.205 GB, invar_size=0.799 GB, outvar_size=0.281 GB, temp_buffer_size=3.125 GB, available_memory=19.578 GB)
result[(1, 4, 0, 0), 0] = ModuleProfileResult(compute_cost=0.364, peak_memory=2.612 GB, invar_size=0.956 GB, outvar_size=0.375 GB, temp_buffer_size=1.281 GB, available_memory=19.578 GB)
result[(2, 4, 0, 0), 0] = ModuleProfileResult(compute_cost=0.275, peak_memory=2.307 GB, invar_size=0.745 GB, outvar_size=0.281 GB, temp_buffer_size=1.281 GB, available_memory=19.578 GB)
result[(1, 4, 0, 1), 0] = ModuleProfileResult(compute_cost=0.364, peak_memory=2.612 GB, invar_size=0.956 GB, outvar_size=0.375 GB, temp_buffer_size=1.281 GB, available_memory=19.578 GB)
result[(2, 4, 0, 1), 0] = ModuleProfileResult(compute_cost=0.275, peak_memory=2.307 GB, invar_size=0.745 GB, outvar_size=0.281 GB, temp_buffer_size=1.281 GB, available_memory=19.578 GB)
result[(3, 5, 0, 0), 0] = ModuleProfileResult(compute_cost=0.177, peak_memory=1.985 GB, invar_size=0.516 GB, outvar_size=0.188 GB, temp_buffer_size=1.281 GB, available_memory=19.578 GB)
result[(0, 2, 0, 1), 1] = ModuleProfileResult(compute_cost=0.926, peak_memory=23.283 GB, invar_size=1.879 GB, outvar_size=0.799 GB, temp_buffer_size=21.404 GB, available_memory=19.578 GB)
result[(1, 3, 0, 1), 1] = ModuleProfileResult(compute_cost=0.823, peak_memory=23.111 GB, invar_size=1.677 GB, outvar_size=0.745 GB, temp_buffer_size=21.340 GB, available_memory=19.578 GB)
result[(1, 3, 0, 0), 1] = ModuleProfileResult(compute_cost=0.823, peak_memory=23.111 GB, invar_size=1.677 GB, outvar_size=0.745 GB, temp_buffer_size=21.340 GB, available_memory=19.578 GB)
result[(0, 2, 0, 0), 1] = ModuleProfileResult(compute_cost=0.926, peak_memory=23.283 GB, invar_size=1.879 GB, outvar_size=0.799 GB, temp_buffer_size=21.404 GB, available_memory=19.578 GB)
result[(3, 5, 0, 1), 0] = ModuleProfileResult(compute_cost=0.177, peak_memory=1.985 GB, invar_size=0.516 GB, outvar_size=0.188 GB, temp_buffer_size=1.281 GB, available_memory=19.578 GB)
result[(1, 4, 0, 0), 1] = ModuleProfileResult(compute_cost=1.089, peak_memory=26.086 GB, invar_size=2.193 GB, outvar_size=0.956 GB, temp_buffer_size=23.800 GB, available_memory=19.578 GB)
result[(2, 4, 0, 0), 1] = ModuleProfileResult(compute_cost=0.823, peak_memory=24.174 GB, invar_size=1.677 GB, outvar_size=0.745 GB, temp_buffer_size=22.404 GB, available_memory=19.578 GB)
result[(2, 4, 0, 1), 1] = ModuleProfileResult(compute_cost=0.823, peak_memory=24.174 GB, invar_size=1.677 GB, outvar_size=0.745 GB, temp_buffer_size=22.404 GB, available_memory=19.578 GB)
result[(1, 4, 0, 1), 1] = ModuleProfileResult(compute_cost=1.089, peak_memory=26.086 GB, invar_size=2.193 GB, outvar_size=0.956 GB, temp_buffer_size=23.800 GB, available_memory=19.578 GB)
result[(3, 5, 0, 0), 1] = ModuleProfileResult(compute_cost=0.937, peak_memory=19.701 GB, invar_size=1.815 GB, outvar_size=0.860 GB, temp_buffer_size=17.792 GB, available_memory=19.578 GB)
result[(3, 5, 0, 1), 1] = ModuleProfileResult(compute_cost=0.937, peak_memory=19.701 GB, invar_size=1.815 GB, outvar_size=0.860 GB, temp_buffer_size=17.792 GB, available_memory=19.578 GB)
Profiling for submesh 0 (1, 1) takes 34.43 seconds
--------------------------------------------------
Profile result saved to: profile-results-2023-11-15-20-32-14.npy
----------------------------------------------------------------------
Result forward_stage_layer_ids: [[0, 1, 2, 3, 4, 5]]
Result mesh_shapes: [(1, 2)]
Result logical_mesh_shapes: [(2, 1)]
Result autosharding_option_dicts: [{'force_batch_dim_to_mesh_dim': 0}]
 - Compile (driver): 123.17 s
compilation time breakdown: {'stage-construction': '84.01', 'stage-construction-dp': '1.15', 'stage-construction-compilation': '28.89', 'stage-construction-profiling': '26.45'}
 - Compile (worker): 17.02 s
[I] Training process warmup (2 rounds) with dummy input batch...
    - Warmup iteration: 1/2
[E] Meet unexpected error in profiling executables...

[E] Unexpected error occurred in compiling or profiling executables...
[E] Meet unexpected error in compiling and executing model...
[TMP] Current profiling results of key `1_a10_1_n_2_d`: none
[TMP] Updated profiling results stored in `./jaxpr/prof_log/optimal/bert_760M_512.pkl`...
